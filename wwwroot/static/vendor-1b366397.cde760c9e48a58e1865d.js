"use strict";(self.webpackChunkui_react=self.webpackChunkui_react||[]).push([[142],{29368:(e,t,i)=>{i.d(t,{c:()=>re,v:()=>se});var o=i(32429),r=i(5976),n=i(16830),s=i(11640),a=i(50187),d=i(24314),l=i(29102),c=i(9488),h=i(4669),u=i(91741),g=i(97295),_=i(70666),p=i(65026),m=i(72065),f=i(98674),v=i(33108),w=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},y=function(e,t){return function(i,o){t(i,o,e)}};class C{constructor(e,t,i){this.marker=e,this.index=t,this.total=i}}let b=class{constructor(e,t,i){this._markerService=t,this._configService=i,this._onDidChange=new h.Q5,this.onDidChange=this._onDidChange.event,this._dispoables=new r.SL,this._markers=[],this._nextIdx=-1,_.o.isUri(e)?this._resourceFilter=t=>t.toString()===e.toString():e&&(this._resourceFilter=e);const o=this._configService.getValue("problems.sortOrder"),n=(e,t)=>{let i=(0,g.qu)(e.resource.toString(),t.resource.toString());return 0===i&&(i="position"===o?d.e.compareRangesUsingStarts(e,t)||f.ZL.compare(e.severity,t.severity):f.ZL.compare(e.severity,t.severity)||d.e.compareRangesUsingStarts(e,t)),i},s=()=>{this._markers=this._markerService.read({resource:_.o.isUri(e)?e:void 0,severities:f.ZL.Error|f.ZL.Warning|f.ZL.Info}),"function"==typeof e&&(this._markers=this._markers.filter((e=>this._resourceFilter(e.resource)))),this._markers.sort(n)};s(),this._dispoables.add(t.onMarkerChanged((e=>{this._resourceFilter&&!e.some((e=>this._resourceFilter(e)))||(s(),this._nextIdx=-1,this._onDidChange.fire())})))}dispose(){this._dispoables.dispose(),this._onDidChange.dispose()}matches(e){return!this._resourceFilter&&!e||!(!this._resourceFilter||!e)&&this._resourceFilter(e)}get selected(){const e=this._markers[this._nextIdx];return e&&new C(e,this._nextIdx+1,this._markers.length)}_initIdx(e,t,i){let o=!1,r=this._markers.findIndex((t=>t.resource.toString()===e.uri.toString()));r<0&&(r=(0,c.ry)(this._markers,{resource:e.uri},((e,t)=>(0,g.qu)(e.resource.toString(),t.resource.toString()))),r<0&&(r=~r));for(let i=r;i<this._markers.length;i++){let r=d.e.lift(this._markers[i]);if(r.isEmpty()){const t=e.getWordAtPosition(r.getStartPosition());t&&(r=new d.e(r.startLineNumber,t.startColumn,r.startLineNumber,t.endColumn))}if(t&&(r.containsPosition(t)||t.isBeforeOrEqual(r.getStartPosition()))){this._nextIdx=i,o=!0;break}if(this._markers[i].resource.toString()!==e.uri.toString())break}o||(this._nextIdx=i?0:this._markers.length-1),this._nextIdx<0&&(this._nextIdx=this._markers.length-1)}resetIndex(){this._nextIdx=-1}move(e,t,i){if(0===this._markers.length)return!1;const o=this._nextIdx;return-1===this._nextIdx?this._initIdx(t,i,e):e?this._nextIdx=(this._nextIdx+1)%this._markers.length:e||(this._nextIdx=(this._nextIdx-1+this._markers.length)%this._markers.length),o!==this._nextIdx}find(e,t){let i=this._markers.findIndex((t=>t.resource.toString()===e.toString()));if(!(i<0))for(;i<this._markers.length;i++)if(d.e.containsPosition(this._markers[i],t))return new C(this._markers[i],i+1,this._markers.length)}};b=w([y(1,f.lT),y(2,v.Ui)],b);const k=(0,m.yh)("IMarkerNavigationService");let M=class{constructor(e,t){this._markerService=e,this._configService=t,this._provider=new u.S}getMarkerList(e){for(const t of this._provider){const i=t.getMarkerList(e);if(i)return i}return new b(e,this._markerService,this._configService)}};M=w([y(0,f.lT),y(1,v.Ui)],M),(0,p.z)(k,M,1);var S,D=i(63580),P=i(84144),R=i(93983),N=i(59554),x=i(65321),I=i(59538),E=i(41264),L=i(95935),T=i(3600),O=i(27628),A=i(44349),F=i(50988),W=i(78544),B=i(82992),K=i(97781),H=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},G=function(e,t){return function(i,o){t(i,o,e)}};class U{constructor(e,t,i,o,n){this._openerService=o,this._labelService=n,this._lines=0,this._longestLineLength=0,this._relatedDiagnostics=new WeakMap,this._disposables=new r.SL,this._editor=t;const s=document.createElement("div");s.className="descriptioncontainer",this._messageBlock=document.createElement("div"),this._messageBlock.classList.add("message"),this._messageBlock.setAttribute("aria-live","assertive"),this._messageBlock.setAttribute("role","alert"),s.appendChild(this._messageBlock),this._relatedBlock=document.createElement("div"),s.appendChild(this._relatedBlock),this._disposables.add(x.mu(this._relatedBlock,"click",(e=>{e.preventDefault();const t=this._relatedDiagnostics.get(e.target);t&&i(t)}))),this._scrollable=new I.NB(s,{horizontal:1,vertical:1,useShadows:!1,horizontalScrollbarSize:6,verticalScrollbarSize:6}),e.appendChild(this._scrollable.getDomNode()),this._disposables.add(this._scrollable.onScroll((e=>{s.style.left=`-${e.scrollLeft}px`,s.style.top=`-${e.scrollTop}px`}))),this._disposables.add(this._scrollable)}dispose(){(0,r.B9)(this._disposables)}update(e){const{source:t,message:i,relatedInformation:o,code:r}=e;let n=((null==t?void 0:t.length)||0)+2;r&&(n+="string"==typeof r?r.length:r.value.length);const s=(0,g.uq)(i);this._lines=s.length,this._longestLineLength=0;for(const e of s)this._longestLineLength=Math.max(e.length+n,this._longestLineLength);x.PO(this._messageBlock),this._messageBlock.setAttribute("aria-label",this.getAriaLabel(e)),this._editor.applyFontInfo(this._messageBlock);let a=this._messageBlock;for(const e of s)a=document.createElement("div"),a.innerText=e,""===e&&(a.style.height=this._messageBlock.style.lineHeight),this._messageBlock.appendChild(a);if(t||r){const e=document.createElement("span");if(e.classList.add("details"),a.appendChild(e),t){const i=document.createElement("span");i.innerText=t,i.classList.add("source"),e.appendChild(i)}if(r)if("string"==typeof r){const t=document.createElement("span");t.innerText=`(${r})`,t.classList.add("code"),e.appendChild(t)}else{this._codeLink=x.$("a.code-link"),this._codeLink.setAttribute("href",`${r.target.toString()}`),this._codeLink.onclick=e=>{this._openerService.open(r.target,{allowCommands:!0}),e.preventDefault(),e.stopPropagation()};x.R3(this._codeLink,x.$("span")).innerText=r.value,e.appendChild(this._codeLink)}}if(x.PO(this._relatedBlock),this._editor.applyFontInfo(this._relatedBlock),(0,c.Of)(o)){const e=this._relatedBlock.appendChild(document.createElement("div"));e.style.paddingTop=`${Math.floor(.66*this._editor.getOption(67))}px`,this._lines+=1;for(const t of o){const i=document.createElement("div"),o=document.createElement("a");o.classList.add("filename"),o.innerText=`${this._labelService.getUriBasenameLabel(t.resource)}(${t.startLineNumber}, ${t.startColumn}): `,o.title=this._labelService.getUriLabel(t.resource),this._relatedDiagnostics.set(o,t);const r=document.createElement("span");r.innerText=t.message,i.appendChild(o),i.appendChild(r),this._lines+=1,e.appendChild(i)}}const d=this._editor.getOption(50),l=Math.ceil(d.typicalFullwidthCharacterWidth*this._longestLineLength*.75),h=d.lineHeight*this._lines;this._scrollable.setScrollDimensions({scrollWidth:l,scrollHeight:h})}layout(e,t){this._scrollable.getDomNode().style.height=`${e}px`,this._scrollable.getDomNode().style.width=`${t}px`,this._scrollable.setScrollDimensions({width:t,height:e})}getHeightInLines(){return Math.min(17,this._lines)}getAriaLabel(e){let t="";switch(e.severity){case f.ZL.Error:t=D.NC("Error","Error");break;case f.ZL.Warning:t=D.NC("Warning","Warning");break;case f.ZL.Info:t=D.NC("Info","Info");break;case f.ZL.Hint:t=D.NC("Hint","Hint")}let i=D.NC("marker aria","{0} at {1}. ",t,e.startLineNumber+":"+e.startColumn);const o=this._editor.getModel();if(o&&e.startLineNumber<=o.getLineCount()&&e.startLineNumber>=1){i=`${o.getLineContent(e.startLineNumber)}, ${i}`}return i}}let V=S=class extends T.vk{constructor(e,t,i,o,n,s,a){super(e,{showArrow:!0,showFrame:!0,isAccessible:!0,frameWidth:1},n),this._themeService=t,this._openerService=i,this._menuService=o,this._contextKeyService=s,this._labelService=a,this._callOnDispose=new r.SL,this._onDidSelectRelatedInformation=new h.Q5,this.onDidSelectRelatedInformation=this._onDidSelectRelatedInformation.event,this._severity=f.ZL.Warning,this._backgroundColor=E.Il.white,this._applyTheme(t.getColorTheme()),this._callOnDispose.add(t.onDidColorThemeChange(this._applyTheme.bind(this))),this.create()}_applyTheme(e){this._backgroundColor=e.getColor(ee);let t=X,i=J;this._severity===f.ZL.Warning?(t=Q,i=q):this._severity===f.ZL.Info&&(t=z,i=Y);const o=e.getColor(t),r=e.getColor(i);this.style({arrowColor:o,frameColor:o,headerBackgroundColor:r,primaryHeadingColor:e.getColor(T.IH),secondaryHeadingColor:e.getColor(T.R7)})}_applyStyles(){this._parentContainer&&(this._parentContainer.style.backgroundColor=this._backgroundColor?this._backgroundColor.toString():""),super._applyStyles()}dispose(){this._callOnDispose.dispose(),super.dispose()}_fillHead(e){super._fillHead(e),this._disposables.add(this._actionbarWidget.actionRunner.onWillRun((e=>this.editor.focus())));const t=[],i=this._menuService.createMenu(S.TitleMenu,this._contextKeyService);(0,O.vr)(i,void 0,t),this._actionbarWidget.push(t,{label:!1,icon:!0,index:0}),i.dispose()}_fillTitleIcon(e){this._icon=x.R3(e,x.$(""))}_fillBody(e){this._parentContainer=e,e.classList.add("marker-widget"),this._parentContainer.tabIndex=0,this._parentContainer.setAttribute("role","tooltip"),this._container=document.createElement("div"),e.appendChild(this._container),this._message=new U(this._container,this.editor,(e=>this._onDidSelectRelatedInformation.fire(e)),this._openerService,this._labelService),this._disposables.add(this._message)}show(){throw new Error("call showAtMarker")}showAtMarker(e,t,i){this._container.classList.remove("stale"),this._message.update(e),this._severity=e.severity,this._applyTheme(this._themeService.getColorTheme());const o=d.e.lift(e),r=this.editor.getPosition(),n=r&&o.containsPosition(r)?r:o.getStartPosition();super.show(n,this.computeRequiredHeight());const s=this.editor.getModel();if(s){const e=i>1?D.NC("problems","{0} of {1} problems",t,i):D.NC("change","{0} of {1} problem",t,i);this.setTitle((0,L.EZ)(s.uri),e)}this._icon.className=`codicon ${W.j.className(f.ZL.toSeverity(this._severity))}`,this.editor.revealPositionNearTop(n,0),this.editor.focus()}updateMarker(e){this._container.classList.remove("stale"),this._message.update(e)}showStale(){this._container.classList.add("stale"),this._relayout()}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._heightInPixel=e,this._message.layout(e,t),this._container.style.height=`${e}px`}_onWidth(e){this._message.layout(this._heightInPixel,e)}_relayout(){super._relayout(this.computeRequiredHeight())}computeRequiredHeight(){return 3+this._message.getHeightInLines()}};V.TitleMenu=new P.eH("gotoErrorTitleMenu"),V=S=H([G(1,K.XE),G(2,F.v),G(3,P.co),G(4,m.TG),G(5,R.i6),G(6,A.e)],V);const $=(0,B.kwl)(B.lXJ,B.b6y),j=(0,B.kwl)(B.uoC,B.pW3),Z=(0,B.kwl)(B.c63,B.T83),X=(0,B.P6G)("editorMarkerNavigationError.background",{dark:$,light:$,hcDark:B.lRK,hcLight:B.lRK},D.NC("editorMarkerNavigationError","Editor marker navigation widget error color.")),J=(0,B.P6G)("editorMarkerNavigationError.headerBackground",{dark:(0,B.ZnX)(X,.1),light:(0,B.ZnX)(X,.1),hcDark:null,hcLight:null},D.NC("editorMarkerNavigationErrorHeaderBackground","Editor marker navigation widget error heading background.")),Q=(0,B.P6G)("editorMarkerNavigationWarning.background",{dark:j,light:j,hcDark:B.lRK,hcLight:B.lRK},D.NC("editorMarkerNavigationWarning","Editor marker navigation widget warning color.")),q=(0,B.P6G)("editorMarkerNavigationWarning.headerBackground",{dark:(0,B.ZnX)(Q,.1),light:(0,B.ZnX)(Q,.1),hcDark:"#0C141F",hcLight:(0,B.ZnX)(Q,.2)},D.NC("editorMarkerNavigationWarningBackground","Editor marker navigation widget warning heading background.")),z=(0,B.P6G)("editorMarkerNavigationInfo.background",{dark:Z,light:Z,hcDark:B.lRK,hcLight:B.lRK},D.NC("editorMarkerNavigationInfo","Editor marker navigation widget info color.")),Y=(0,B.P6G)("editorMarkerNavigationInfo.headerBackground",{dark:(0,B.ZnX)(z,.1),light:(0,B.ZnX)(z,.1),hcDark:null,hcLight:null},D.NC("editorMarkerNavigationInfoHeaderBackground","Editor marker navigation widget info heading background.")),ee=(0,B.P6G)("editorMarkerNavigation.background",{dark:B.cvW,light:B.cvW,hcDark:B.cvW,hcLight:B.cvW},D.NC("editorMarkerNavigationBackground","Editor marker navigation widget background."));var te,ie=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},oe=function(e,t){return function(i,o){t(i,o,e)}};let re=te=class{static get(e){return e.getContribution(te.ID)}constructor(e,t,i,o,n){this._markerNavigationService=t,this._contextKeyService=i,this._editorService=o,this._instantiationService=n,this._sessionDispoables=new r.SL,this._editor=e,this._widgetVisible=de.bindTo(this._contextKeyService)}dispose(){this._cleanUp(),this._sessionDispoables.dispose()}_cleanUp(){this._widgetVisible.reset(),this._sessionDispoables.clear(),this._widget=void 0,this._model=void 0}_getOrCreateModel(e){if(this._model&&this._model.matches(e))return this._model;let t=!1;return this._model&&(t=!0,this._cleanUp()),this._model=this._markerNavigationService.getMarkerList(e),t&&this._model.move(!0,this._editor.getModel(),this._editor.getPosition()),this._widget=this._instantiationService.createInstance(V,this._editor),this._widget.onDidClose((()=>this.close()),this,this._sessionDispoables),this._widgetVisible.set(!0),this._sessionDispoables.add(this._model),this._sessionDispoables.add(this._widget),this._sessionDispoables.add(this._editor.onDidChangeCursorPosition((e=>{var t,i,o;(null===(t=this._model)||void 0===t?void 0:t.selected)&&d.e.containsPosition(null===(i=this._model)||void 0===i?void 0:i.selected.marker,e.position)||null===(o=this._model)||void 0===o||o.resetIndex()}))),this._sessionDispoables.add(this._model.onDidChange((()=>{if(!this._widget||!this._widget.position||!this._model)return;const e=this._model.find(this._editor.getModel().uri,this._widget.position);e?this._widget.updateMarker(e.marker):this._widget.showStale()}))),this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation((e=>{this._editorService.openCodeEditor({resource:e.resource,options:{pinned:!0,revealIfOpened:!0,selection:d.e.lift(e).collapseToStart()}},this._editor),this.close(!1)}))),this._sessionDispoables.add(this._editor.onDidChangeModel((()=>this._cleanUp()))),this._model}close(e=!0){this._cleanUp(),e&&this._editor.focus()}showAtMarker(e){if(this._editor.hasModel()){const t=this._getOrCreateModel(this._editor.getModel().uri);t.resetIndex(),t.move(!0,this._editor.getModel(),new a.L(e.startLineNumber,e.startColumn)),t.selected&&this._widget.showAtMarker(t.selected.marker,t.selected.index,t.selected.total)}}async nagivate(e,t){var i,o;if(this._editor.hasModel()){const r=this._getOrCreateModel(t?void 0:this._editor.getModel().uri);if(r.move(e,this._editor.getModel(),this._editor.getPosition()),!r.selected)return;if(r.selected.marker.resource.toString()!==this._editor.getModel().uri.toString()){this._cleanUp();const n=await this._editorService.openCodeEditor({resource:r.selected.marker.resource,options:{pinned:!1,revealIfOpened:!0,selectionRevealType:2,selection:r.selected.marker}},this._editor);n&&(null===(i=te.get(n))||void 0===i||i.close(),null===(o=te.get(n))||void 0===o||o.nagivate(e,t))}else this._widget.showAtMarker(r.selected.marker,r.selected.index,r.selected.total)}}};re.ID="editor.contrib.markerController",re=te=ie([oe(1,k),oe(2,R.i6),oe(3,s.$),oe(4,m.TG)],re);class ne extends n.R6{constructor(e,t,i){super(i),this._next=e,this._multiFile=t}async run(e,t){var i;t.hasModel()&&(null===(i=re.get(t))||void 0===i||i.nagivate(this._next,this._multiFile))}}class se extends ne{constructor(){super(!0,!1,{id:se.ID,label:se.LABEL,alias:"Go to Next Problem (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:l.u.focus,primary:578,weight:100},menuOpts:{menuId:V.TitleMenu,title:se.LABEL,icon:(0,N.q5)("marker-navigation-next",o.l.arrowDown,D.NC("nextMarkerIcon","Icon for goto next marker.")),group:"navigation",order:1}})}}se.ID="editor.action.marker.next",se.LABEL=D.NC("markerAction.next.label","Go to Next Problem (Error, Warning, Info)");class ae extends ne{constructor(){super(!1,!1,{id:ae.ID,label:ae.LABEL,alias:"Go to Previous Problem (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:l.u.focus,primary:1602,weight:100},menuOpts:{menuId:V.TitleMenu,title:ae.LABEL,icon:(0,N.q5)("marker-navigation-previous",o.l.arrowUp,D.NC("previousMarkerIcon","Icon for goto previous marker.")),group:"navigation",order:2}})}}ae.ID="editor.action.marker.prev",ae.LABEL=D.NC("markerAction.previous.label","Go to Previous Problem (Error, Warning, Info)");(0,n._K)(re.ID,re,4),(0,n.Qr)(se),(0,n.Qr)(ae),(0,n.Qr)(class extends ne{constructor(){super(!0,!0,{id:"editor.action.marker.nextInFiles",label:D.NC("markerAction.nextInFiles.label","Go to Next Problem in Files (Error, Warning, Info)"),alias:"Go to Next Problem in Files (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:l.u.focus,primary:66,weight:100},menuOpts:{menuId:P.eH.MenubarGoMenu,title:D.NC({key:"miGotoNextProblem",comment:["&& denotes a mnemonic"]},"Next &&Problem"),group:"6_problem_nav",order:1}})}}),(0,n.Qr)(class extends ne{constructor(){super(!1,!0,{id:"editor.action.marker.prevInFiles",label:D.NC("markerAction.previousInFiles.label","Go to Previous Problem in Files (Error, Warning, Info)"),alias:"Go to Previous Problem in Files (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:l.u.focus,primary:1090,weight:100},menuOpts:{menuId:P.eH.MenubarGoMenu,title:D.NC({key:"miGotoPreviousProblem",comment:["&& denotes a mnemonic"]},"Previous &&Problem"),group:"6_problem_nav",order:2}})}});const de=new R.uy("markersNavigationVisible",!1),le=n._l.bindToContribution(re.get);(0,n.fK)(new le({id:"closeMarkersNavigation",precondition:de,handler:e=>e.close(),kbOpts:{weight:150,kbExpr:l.u.focus,primary:9,secondary:[1033]}}))},60628:(e,t,i)=>{i.d(t,{BT:()=>ee,Bj:()=>Y,_k:()=>z});var o=i(85152),r=i(15393),n=i(22258),s=i(98401),a=i(70666),d=i(16467),l=i(65520),c=i(16830),h=i(11640),u=i(22874),g=i(50187),_=i(24314),p=i(29102),m=i(71204),f=i(27376),v=i(1293),w=i(4669),y=i(5976),C=i(95935),b=i(63580),k=i(93983),M=i(65026),S=i(72065),D=i(91847),P=i(49989),R=i(59422),N=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},x=function(e,t){return function(i,o){t(i,o,e)}};const I=new k.uy("hasSymbols",!1,(0,b.NC)("hasSymbols","Whether there are symbol locations that can be navigated via keyboard-only.")),E=(0,S.yh)("ISymbolNavigationService");let L=class{constructor(e,t,i,o){this._editorService=t,this._notificationService=i,this._keybindingService=o,this._currentModel=void 0,this._currentIdx=-1,this._ignoreEditorChange=!1,this._ctxHasSymbols=I.bindTo(e)}reset(){var e,t;this._ctxHasSymbols.reset(),null===(e=this._currentState)||void 0===e||e.dispose(),null===(t=this._currentMessage)||void 0===t||t.dispose(),this._currentModel=void 0,this._currentIdx=-1}put(e){const t=e.parent.parent;if(t.references.length<=1)return void this.reset();this._currentModel=t,this._currentIdx=t.references.indexOf(e),this._ctxHasSymbols.set(!0),this._showMessage();const i=new T(this._editorService),o=i.onDidChange((e=>{if(this._ignoreEditorChange)return;const i=this._editorService.getActiveCodeEditor();if(!i)return;const o=i.getModel(),r=i.getPosition();if(!o||!r)return;let n=!1,s=!1;for(const e of t.references)if((0,C.Xy)(e.uri,o.uri))n=!0,s=s||_.e.containsPosition(e.range,r);else if(n)break;n&&s||this.reset()}));this._currentState=(0,y.F8)(i,o)}revealNext(e){if(!this._currentModel)return Promise.resolve();this._currentIdx+=1,this._currentIdx%=this._currentModel.references.length;const t=this._currentModel.references[this._currentIdx];return this._showMessage(),this._ignoreEditorChange=!0,this._editorService.openCodeEditor({resource:t.uri,options:{selection:_.e.collapseToStart(t.range),selectionRevealType:3}},e).finally((()=>{this._ignoreEditorChange=!1}))}_showMessage(){var e;null===(e=this._currentMessage)||void 0===e||e.dispose();const t=this._keybindingService.lookupKeybinding("editor.gotoNextSymbolFromResult"),i=t?(0,b.NC)("location.kb","Symbol {0} of {1}, {2} for next",this._currentIdx+1,this._currentModel.references.length,t.getLabel()):(0,b.NC)("location","Symbol {0} of {1}",this._currentIdx+1,this._currentModel.references.length);this._currentMessage=this._notificationService.status(i)}};L=N([x(0,k.i6),x(1,h.$),x(2,R.lT),x(3,D.d)],L),(0,M.z)(E,L,1),(0,c.fK)(new class extends c._l{constructor(){super({id:"editor.gotoNextSymbolFromResult",precondition:I,kbOpts:{weight:100,primary:70}})}runEditorCommand(e,t){return e.get(E).revealNext(t)}}),P.W.registerCommandAndKeybindingRule({id:"editor.gotoNextSymbolFromResult.cancel",weight:100,when:I,primary:9,handler(e){e.get(E).reset()}});let T=class{constructor(e){this._listener=new Map,this._disposables=new y.SL,this._onDidChange=new w.Q5,this.onDidChange=this._onDidChange.event,this._disposables.add(e.onCodeEditorRemove(this._onDidRemoveEditor,this)),this._disposables.add(e.onCodeEditorAdd(this._onDidAddEditor,this)),e.listCodeEditors().forEach(this._onDidAddEditor,this)}dispose(){this._disposables.dispose(),this._onDidChange.dispose(),(0,y.B9)(this._listener.values())}_onDidAddEditor(e){this._listener.set(e,(0,y.F8)(e.onDidChangeCursorPosition((t=>this._onDidChange.fire({editor:e}))),e.onDidChangeModelContent((t=>this._onDidChange.fire({editor:e})))))}_onDidRemoveEditor(e){var t;null===(t=this._listener.get(e))||void 0===t||t.dispose(),this._listener.delete(e)}};T=N([x(0,h.$)],T);var O,A,F,W,B,K,H,G,U=i(27753),V=i(3600),$=i(84144),j=i(94565),Z=i(90535),X=i(40184),J=i(71922),Q=i(53725),q=i(39282);$.BH.appendMenuItem($.eH.EditorContext,{submenu:$.eH.EditorContextPeek,title:b.NC("peek.submenu","Peek"),group:"navigation",order:100});class z{static is(e){return!(!e||"object"!=typeof e)&&(e instanceof z||!(!g.L.isIPosition(e.position)||!e.model))}constructor(e,t){this.model=e,this.position=t}}class Y extends c.x1{static all(){return Y._allSymbolNavigationCommands.values()}static _patchConfig(e){const t={...e,f1:!0};if(t.menu)for(const i of Q.$.wrap(t.menu))i.id!==$.eH.EditorContext&&i.id!==$.eH.EditorContextPeek||(i.when=k.Ao.and(e.precondition,i.when));return t}constructor(e,t){super(Y._patchConfig(t)),this.configuration=e,Y._allSymbolNavigationCommands.set(t.id,this)}runEditorCommand(e,t,i,n){if(!t.hasModel())return Promise.resolve(void 0);const s=e.get(R.lT),a=e.get(h.$),l=e.get(Z.ek),c=e.get(E),u=e.get(J.p),g=e.get(S.TG),_=t.getModel(),p=t.getPosition(),m=z.is(i)?i:new z(_,p),f=new d.Dl(t,5),v=(0,r.eP)(this._getLocationModel(u,m.model,m.position,f.token),f.token).then((async e=>{var r;if(!e||f.token.isCancellationRequested)return;let s;if((0,o.Z9)(e.ariaMessage),e.referenceAt(_.uri,p)){const e=this._getAlternativeCommand(t);!Y._activeAlternativeCommands.has(e)&&Y._allSymbolNavigationCommands.has(e)&&(s=Y._allSymbolNavigationCommands.get(e))}const d=e.references.length;if(0===d){if(!this.configuration.muteMessage){const e=_.getWordAtPosition(p);null===(r=U.O.get(t))||void 0===r||r.showMessage(this._getNoResultFoundMessage(e),p)}}else{if(1!==d||!s)return this._onResult(a,c,t,e,n);Y._activeAlternativeCommands.add(this.desc.id),g.invokeFunction((e=>s.runEditorCommand(e,t,i,n).finally((()=>{Y._activeAlternativeCommands.delete(this.desc.id)}))))}}),(e=>{s.error(e)})).finally((()=>{f.dispose()}));return l.showWhile(v,250),v}async _onResult(e,t,i,o,r){const n=this._getGoToPreference(i);if(i instanceof u.H||!(this.configuration.openInPeek||"peek"===n&&o.references.length>1)){const s=o.firstReference(),a=o.references.length>1&&"gotoAndPeek"===n,d=await this._openReference(i,e,s,this.configuration.openToSide,!a);a&&d?this._openInPeek(d,o,r):o.dispose(),"goto"===n&&t.put(s)}else this._openInPeek(i,o,r)}async _openReference(e,t,i,o,r){let n;if((0,m.vx)(i)&&(n=i.targetSelectionRange),n||(n=i.range),!n)return;const s=await t.openCodeEditor({resource:i.uri,options:{selection:_.e.collapseToStart(n),selectionRevealType:3,selectionSource:"code.jump"}},e,o);if(s){if(r){const e=s.getModel(),t=s.createDecorationsCollection([{range:n,options:{description:"symbol-navigate-action-highlight",className:"symbolHighlight"}}]);setTimeout((()=>{s.getModel()===e&&t.clear()}),350)}return s}}_openInPeek(e,t,i){const o=f.J.get(e);o&&e.hasModel()?o.toggleWidget(null!=i?i:e.getSelection(),(0,r.PG)((e=>Promise.resolve(t))),this.configuration.openInPeek):t.dispose()}}Y._allSymbolNavigationCommands=new Map,Y._activeAlternativeCommands=new Set;class ee extends Y{async _getLocationModel(e,t,i,o){return new v.oQ(await(0,X.nD)(e.definitionProvider,t,i,o),b.NC("def.title","Definitions"))}_getNoResultFoundMessage(e){return e&&e.word?b.NC("noResultWord","No definition found for '{0}'",e.word):b.NC("generic.noResults","No definition found")}_getAlternativeCommand(e){return e.getOption(58).alternativeDefinitionCommand}_getGoToPreference(e){return e.getOption(58).multipleDefinitions}}(0,$.r1)(((O=class extends ee{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:O.id,title:{...b.vv("actions.goToDecl.label","Go to Definition"),mnemonicTitle:b.NC({key:"miGotoDefinition",comment:["&& denotes a mnemonic"]},"Go to &&Definition")},precondition:p.u.hasDefinitionProvider,keybinding:[{when:p.u.editorTextFocus,primary:70,weight:100},{when:k.Ao.and(p.u.editorTextFocus,q.Pf),primary:2118,weight:100}],menu:[{id:$.eH.EditorContext,group:"navigation",order:1.1},{id:$.eH.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:2}]}),j.P.registerCommandAlias("editor.action.goToDeclaration",O.id)}}).id="editor.action.revealDefinition",O)),(0,$.r1)(((A=class extends ee{constructor(){super({openToSide:!0,openInPeek:!1,muteMessage:!1},{id:A.id,title:b.vv("actions.goToDeclToSide.label","Open Definition to the Side"),precondition:k.Ao.and(p.u.hasDefinitionProvider,p.u.isInEmbeddedEditor.toNegated()),keybinding:[{when:p.u.editorTextFocus,primary:(0,n.gx)(2089,70),weight:100},{when:k.Ao.and(p.u.editorTextFocus,q.Pf),primary:(0,n.gx)(2089,2118),weight:100}]}),j.P.registerCommandAlias("editor.action.openDeclarationToTheSide",A.id)}}).id="editor.action.revealDefinitionAside",A)),(0,$.r1)(((F=class extends ee{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:F.id,title:b.vv("actions.previewDecl.label","Peek Definition"),precondition:k.Ao.and(p.u.hasDefinitionProvider,V.Jy.notInPeekEditor,p.u.isInEmbeddedEditor.toNegated()),keybinding:{when:p.u.editorTextFocus,primary:582,linux:{primary:3140},weight:100},menu:{id:$.eH.EditorContextPeek,group:"peek",order:2}}),j.P.registerCommandAlias("editor.action.previewDeclaration",F.id)}}).id="editor.action.peekDefinition",F));class te extends Y{async _getLocationModel(e,t,i,o){return new v.oQ(await(0,X.zq)(e.declarationProvider,t,i,o),b.NC("decl.title","Declarations"))}_getNoResultFoundMessage(e){return e&&e.word?b.NC("decl.noResultWord","No declaration found for '{0}'",e.word):b.NC("decl.generic.noResults","No declaration found")}_getAlternativeCommand(e){return e.getOption(58).alternativeDeclarationCommand}_getGoToPreference(e){return e.getOption(58).multipleDeclarations}}(0,$.r1)(((W=class extends te{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:W.id,title:{...b.vv("actions.goToDeclaration.label","Go to Declaration"),mnemonicTitle:b.NC({key:"miGotoDeclaration",comment:["&& denotes a mnemonic"]},"Go to &&Declaration")},precondition:k.Ao.and(p.u.hasDeclarationProvider,p.u.isInEmbeddedEditor.toNegated()),menu:[{id:$.eH.EditorContext,group:"navigation",order:1.3},{id:$.eH.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}_getNoResultFoundMessage(e){return e&&e.word?b.NC("decl.noResultWord","No declaration found for '{0}'",e.word):b.NC("decl.generic.noResults","No declaration found")}}).id="editor.action.revealDeclaration",W)),(0,$.r1)(class extends te{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.peekDeclaration",title:b.vv("actions.peekDecl.label","Peek Declaration"),precondition:k.Ao.and(p.u.hasDeclarationProvider,V.Jy.notInPeekEditor,p.u.isInEmbeddedEditor.toNegated()),menu:{id:$.eH.EditorContextPeek,group:"peek",order:3}})}});class ie extends Y{async _getLocationModel(e,t,i,o){return new v.oQ(await(0,X.L3)(e.typeDefinitionProvider,t,i,o),b.NC("typedef.title","Type Definitions"))}_getNoResultFoundMessage(e){return e&&e.word?b.NC("goToTypeDefinition.noResultWord","No type definition found for '{0}'",e.word):b.NC("goToTypeDefinition.generic.noResults","No type definition found")}_getAlternativeCommand(e){return e.getOption(58).alternativeTypeDefinitionCommand}_getGoToPreference(e){return e.getOption(58).multipleTypeDefinitions}}(0,$.r1)(((B=class extends ie{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:B.ID,title:{...b.vv("actions.goToTypeDefinition.label","Go to Type Definition"),mnemonicTitle:b.NC({key:"miGotoTypeDefinition",comment:["&& denotes a mnemonic"]},"Go to &&Type Definition")},precondition:p.u.hasTypeDefinitionProvider,keybinding:{when:p.u.editorTextFocus,primary:0,weight:100},menu:[{id:$.eH.EditorContext,group:"navigation",order:1.4},{id:$.eH.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}}).ID="editor.action.goToTypeDefinition",B)),(0,$.r1)(((K=class extends ie{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:K.ID,title:b.vv("actions.peekTypeDefinition.label","Peek Type Definition"),precondition:k.Ao.and(p.u.hasTypeDefinitionProvider,V.Jy.notInPeekEditor,p.u.isInEmbeddedEditor.toNegated()),menu:{id:$.eH.EditorContextPeek,group:"peek",order:4}})}}).ID="editor.action.peekTypeDefinition",K));class oe extends Y{async _getLocationModel(e,t,i,o){return new v.oQ(await(0,X.f4)(e.implementationProvider,t,i,o),b.NC("impl.title","Implementations"))}_getNoResultFoundMessage(e){return e&&e.word?b.NC("goToImplementation.noResultWord","No implementation found for '{0}'",e.word):b.NC("goToImplementation.generic.noResults","No implementation found")}_getAlternativeCommand(e){return e.getOption(58).alternativeImplementationCommand}_getGoToPreference(e){return e.getOption(58).multipleImplementations}}(0,$.r1)(((H=class extends oe{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:H.ID,title:{...b.vv("actions.goToImplementation.label","Go to Implementations"),mnemonicTitle:b.NC({key:"miGotoImplementation",comment:["&& denotes a mnemonic"]},"Go to &&Implementations")},precondition:p.u.hasImplementationProvider,keybinding:{when:p.u.editorTextFocus,primary:2118,weight:100},menu:[{id:$.eH.EditorContext,group:"navigation",order:1.45},{id:$.eH.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:4}]})}}).ID="editor.action.goToImplementation",H)),(0,$.r1)(((G=class extends oe{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:G.ID,title:b.vv("actions.peekImplementation.label","Peek Implementations"),precondition:k.Ao.and(p.u.hasImplementationProvider,V.Jy.notInPeekEditor,p.u.isInEmbeddedEditor.toNegated()),keybinding:{when:p.u.editorTextFocus,primary:3142,weight:100},menu:{id:$.eH.EditorContextPeek,group:"peek",order:5}})}}).ID="editor.action.peekImplementation",G));class re extends Y{_getNoResultFoundMessage(e){return e?b.NC("references.no","No references found for '{0}'",e.word):b.NC("references.noGeneric","No references found")}_getAlternativeCommand(e){return e.getOption(58).alternativeReferenceCommand}_getGoToPreference(e){return e.getOption(58).multipleReferences}}(0,$.r1)(class extends re{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:"editor.action.goToReferences",title:{...b.vv("goToReferences.label","Go to References"),mnemonicTitle:b.NC({key:"miGotoReference",comment:["&& denotes a mnemonic"]},"Go to &&References")},precondition:k.Ao.and(p.u.hasReferenceProvider,V.Jy.notInPeekEditor,p.u.isInEmbeddedEditor.toNegated()),keybinding:{when:p.u.editorTextFocus,primary:1094,weight:100},menu:[{id:$.eH.EditorContext,group:"navigation",order:1.45},{id:$.eH.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:5}]})}async _getLocationModel(e,t,i,o){return new v.oQ(await(0,X.aA)(e.referenceProvider,t,i,!0,o),b.NC("ref.title","References"))}}),(0,$.r1)(class extends re{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.referenceSearch.trigger",title:b.vv("references.action.label","Peek References"),precondition:k.Ao.and(p.u.hasReferenceProvider,V.Jy.notInPeekEditor,p.u.isInEmbeddedEditor.toNegated()),menu:{id:$.eH.EditorContextPeek,group:"peek",order:6}})}async _getLocationModel(e,t,i,o){return new v.oQ(await(0,X.aA)(e.referenceProvider,t,i,!1,o),b.NC("ref.title","References"))}});class ne extends Y{constructor(e,t,i){super(e,{id:"editor.action.goToLocation",title:b.vv("label.generic","Go to Any Symbol"),precondition:k.Ao.and(V.Jy.notInPeekEditor,p.u.isInEmbeddedEditor.toNegated())}),this._references=t,this._gotoMultipleBehaviour=i}async _getLocationModel(e,t,i,o){return new v.oQ(this._references,b.NC("generic.title","Locations"))}_getNoResultFoundMessage(e){return e&&b.NC("generic.noResult","No results for '{0}'",e.word)||""}_getGoToPreference(e){var t;return null!==(t=this._gotoMultipleBehaviour)&&void 0!==t?t:e.getOption(58).multipleReferences}_getAlternativeCommand(){return""}}j.P.registerCommand({id:"editor.action.goToLocations",metadata:{description:"Go to locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:a.o},{name:"position",description:"The position at which to start",constraint:g.L.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"},{name:"noResultsMessage",description:"Human readable message that shows when locations is empty."}]},handler:async(e,t,i,o,r,n,d)=>{(0,s.p_)(a.o.isUri(t)),(0,s.p_)(g.L.isIPosition(i)),(0,s.p_)(Array.isArray(o)),(0,s.p_)(void 0===r||"string"==typeof r),(0,s.p_)(void 0===d||"boolean"==typeof d);const c=e.get(h.$),u=await c.openCodeEditor({resource:t},c.getFocusedCodeEditor());if((0,l.CL)(u))return u.setPosition(i),u.revealPositionInCenterIfOutsideViewport(i,0),u.invokeWithinContext((e=>{const t=new class extends ne{_getNoResultFoundMessage(e){return n||super._getNoResultFoundMessage(e)}}({muteMessage:!Boolean(n),openInPeek:Boolean(d),openToSide:!1},o,r);e.get(S.TG).invokeFunction(t.run.bind(t),u)}))}}),j.P.registerCommand({id:"editor.action.peekLocations",metadata:{description:"Peek locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:a.o},{name:"position",description:"The position at which to start",constraint:g.L.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"}]},handler:async(e,t,i,o,r)=>{e.get(j.H).executeCommand("editor.action.goToLocations",t,i,o,r,void 0,!0)}}),j.P.registerCommand({id:"editor.action.findReferences",handler:(e,t,i)=>{(0,s.p_)(a.o.isUri(t)),(0,s.p_)(g.L.isIPosition(i));const o=e.get(J.p),n=e.get(h.$);return n.openCodeEditor({resource:t},n.getFocusedCodeEditor()).then((e=>{if(!(0,l.CL)(e)||!e.hasModel())return;const t=f.J.get(e);if(!t)return;const n=(0,r.PG)((t=>(0,X.aA)(o.referenceProvider,e.getModel(),g.L.lift(i),!1,t).then((e=>new v.oQ(e,b.NC("ref.title","References")))))),s=new _.e(i.lineNumber,i.column,i.lineNumber,i.column);return Promise.resolve(t.toggleWidget(s,n,!1))}))}}),j.P.registerCommandAlias("editor.action.showReferences","editor.action.peekLocations")},40184:(e,t,i)=>{i.d(t,{L3:()=>p,aA:()=>m,f4:()=>_,nD:()=>u,zq:()=>g});var o=i(9488),r=i(71050),n=i(17301),s=i(66663),a=i(16830),d=i(71922),l=i(1293);function c(e,t){return t.uri.scheme===e.uri.scheme||!(0,s.Gs)(t.uri,s.lg.walkThroughSnippet,s.lg.vscodeChatCodeBlock,s.lg.vscodeChatCodeCompareBlock,s.lg.vscodeCopilotBackingChatCodeBlock)}async function h(e,t,i,r){const s=i.ordered(e).map((i=>Promise.resolve(r(i,e,t)).then(void 0,(e=>{(0,n.Cp)(e)})))),a=await Promise.all(s);return(0,o.kX)(a.flat()).filter((t=>c(e,t)))}function u(e,t,i,o){return h(t,i,e,((e,t,i)=>e.provideDefinition(t,i,o)))}function g(e,t,i,o){return h(t,i,e,((e,t,i)=>e.provideDeclaration(t,i,o)))}function _(e,t,i,o){return h(t,i,e,((e,t,i)=>e.provideImplementation(t,i,o)))}function p(e,t,i,o){return h(t,i,e,((e,t,i)=>e.provideTypeDefinition(t,i,o)))}function m(e,t,i,o,r){return h(t,i,e,(async(e,t,i)=>{var n,s;const a=null===(n=await e.provideReferences(t,i,{includeDeclaration:!0},r))||void 0===n?void 0:n.filter((e=>c(t,e)));if(!o||!a||2!==a.length)return a;const d=null===(s=await e.provideReferences(t,i,{includeDeclaration:!1},r))||void 0===s?void 0:s.filter((e=>c(t,e)));return d&&1===d.length?d:a}))}async function f(e){const t=await e(),i=new l.oQ(t,""),o=i.references.map((e=>e.link));return i.dispose(),o}(0,a.sb)("_executeDefinitionProvider",((e,t,i)=>{const o=u(e.get(d.p).definitionProvider,t,i,r.Ts.None);return f((()=>o))})),(0,a.sb)("_executeTypeDefinitionProvider",((e,t,i)=>{const o=p(e.get(d.p).typeDefinitionProvider,t,i,r.Ts.None);return f((()=>o))})),(0,a.sb)("_executeDeclarationProvider",((e,t,i)=>{const o=g(e.get(d.p).declarationProvider,t,i,r.Ts.None);return f((()=>o))})),(0,a.sb)("_executeReferenceProvider",((e,t,i)=>{const o=m(e.get(d.p).referenceProvider,t,i,!1,r.Ts.None);return f((()=>o))})),(0,a.sb)("_executeImplementationProvider",((e,t,i)=>{const o=_(e.get(d.p).implementationProvider,t,i,r.Ts.None);return f((()=>o))}))},82005:(e,t,i)=>{i.d(t,{yN:()=>h});var o=i(4669),r=i(5976),n=i(1432);function s(e,t){return!!e[t]}class a{constructor(e,t){this.target=e.target,this.isLeftClick=e.event.leftButton,this.isMiddleClick=e.event.middleButton,this.isRightClick=e.event.rightButton,this.hasTriggerModifier=s(e.event,t.triggerModifier),this.hasSideBySideModifier=s(e.event,t.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=e.event.detail<=1}}class d{constructor(e,t){this.keyCodeIsTriggerKey=e.keyCode===t.triggerKey,this.keyCodeIsSideBySideKey=e.keyCode===t.triggerSideBySideKey,this.hasTriggerModifier=s(e,t.triggerModifier)}}class l{constructor(e,t,i,o){this.triggerKey=e,this.triggerModifier=t,this.triggerSideBySideKey=i,this.triggerSideBySideModifier=o}equals(e){return this.triggerKey===e.triggerKey&&this.triggerModifier===e.triggerModifier&&this.triggerSideBySideKey===e.triggerSideBySideKey&&this.triggerSideBySideModifier===e.triggerSideBySideModifier}}function c(e){return"altKey"===e?n.dz?new l(57,"metaKey",6,"altKey"):new l(5,"ctrlKey",6,"altKey"):n.dz?new l(6,"altKey",57,"metaKey"):new l(6,"altKey",5,"ctrlKey")}class h extends r.JT{constructor(e,t){var i;super(),this._onMouseMoveOrRelevantKeyDown=this._register(new o.Q5),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new o.Q5),this.onExecute=this._onExecute.event,this._onCancel=this._register(new o.Q5),this.onCancel=this._onCancel.event,this._editor=e,this._extractLineNumberFromMouseEvent=null!==(i=null==t?void 0:t.extractLineNumberFromMouseEvent)&&void 0!==i?i:e=>e.target.position?e.target.position.lineNumber:0,this._opts=c(this._editor.getOption(78)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration((e=>{if(e.hasChanged(78)){const e=c(this._editor.getOption(78));if(this._opts.equals(e))return;this._opts=e,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}}))),this._register(this._editor.onMouseMove((e=>this._onEditorMouseMove(new a(e,this._opts))))),this._register(this._editor.onMouseDown((e=>this._onEditorMouseDown(new a(e,this._opts))))),this._register(this._editor.onMouseUp((e=>this._onEditorMouseUp(new a(e,this._opts))))),this._register(this._editor.onKeyDown((e=>this._onEditorKeyDown(new d(e,this._opts))))),this._register(this._editor.onKeyUp((e=>this._onEditorKeyUp(new d(e,this._opts))))),this._register(this._editor.onMouseDrag((()=>this._resetHandler()))),this._register(this._editor.onDidChangeCursorSelection((e=>this._onDidChangeCursorSelection(e)))),this._register(this._editor.onDidChangeModel((e=>this._resetHandler()))),this._register(this._editor.onDidChangeModelContent((()=>this._resetHandler()))),this._register(this._editor.onDidScrollChange((e=>{(e.scrollTopChanged||e.scrollLeftChanged)&&this._resetHandler()})))}_onDidChangeCursorSelection(e){e.selection&&e.selection.startColumn!==e.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(e){this._lastMouseMoveEvent=e,this._onMouseMoveOrRelevantKeyDown.fire([e,null])}_onEditorMouseDown(e){this._hasTriggerKeyOnMouseDown=e.hasTriggerModifier,this._lineNumberOnMouseDown=this._extractLineNumberFromMouseEvent(e)}_onEditorMouseUp(e){const t=this._extractLineNumberFromMouseEvent(e);this._hasTriggerKeyOnMouseDown&&this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===t&&this._onExecute.fire(e)}_onEditorKeyDown(e){this._lastMouseMoveEvent&&(e.keyCodeIsTriggerKey||e.keyCodeIsSideBySideKey&&e.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,e]):e.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(e){e.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}}},22470:(e,t,i)=>{i.d(t,{S:()=>k});var o,r=i(15393),n=i(17301),s=i(59365),a=i(5976),d=i(16467),l=i(16830),c=i(24314),h=i(72042),u=i(88216),g=i(82005),_=i(3600),p=i(63580),m=i(93983),f=i(60628),v=i(40184),w=i(71922),y=i(54530),C=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},b=function(e,t){return function(i,o){t(i,o,e)}};let k=o=class{constructor(e,t,i,o){this.textModelResolverService=t,this.languageService=i,this.languageFeaturesService=o,this.toUnhook=new a.SL,this.toUnhookForKeyboard=new a.SL,this.currentWordAtPosition=null,this.previousPromise=null,this.editor=e,this.linkDecorations=this.editor.createDecorationsCollection();const r=new g.yN(e);this.toUnhook.add(r),this.toUnhook.add(r.onMouseMoveOrRelevantKeyDown((([e,t])=>{this.startFindDefinitionFromMouse(e,null!=t?t:void 0)}))),this.toUnhook.add(r.onExecute((e=>{this.isEnabled(e)&&this.gotoDefinition(e.target.position,e.hasSideBySideModifier).catch((e=>{(0,n.dL)(e)})).finally((()=>{this.removeLinkDecorations()}))}))),this.toUnhook.add(r.onCancel((()=>{this.removeLinkDecorations(),this.currentWordAtPosition=null})))}static get(e){return e.getContribution(o.ID)}async startFindDefinitionFromCursor(e){await this.startFindDefinition(e),this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition((()=>{this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear()}))),this.toUnhookForKeyboard.add(this.editor.onKeyDown((e=>{e&&(this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear())})))}startFindDefinitionFromMouse(e,t){if(9===e.target.type&&this.linkDecorations.length>0)return;if(!this.editor.hasModel()||!this.isEnabled(e,t))return this.currentWordAtPosition=null,void this.removeLinkDecorations();const i=e.target.position;this.startFindDefinition(i)}async startFindDefinition(e){var t;this.toUnhookForKeyboard.clear();const i=e?null===(t=this.editor.getModel())||void 0===t?void 0:t.getWordAtPosition(e):null;if(!i)return this.currentWordAtPosition=null,void this.removeLinkDecorations();if(this.currentWordAtPosition&&this.currentWordAtPosition.startColumn===i.startColumn&&this.currentWordAtPosition.endColumn===i.endColumn&&this.currentWordAtPosition.word===i.word)return;this.currentWordAtPosition=i;const o=new d.yy(this.editor,15);let a;this.previousPromise&&(this.previousPromise.cancel(),this.previousPromise=null),this.previousPromise=(0,r.PG)((t=>this.findDefinition(e,t)));try{a=await this.previousPromise}catch(e){return void(0,n.dL)(e)}if(!a||!a.length||!o.validate(this.editor))return void this.removeLinkDecorations();const l=a[0].originSelectionRange?c.e.lift(a[0].originSelectionRange):new c.e(e.lineNumber,i.startColumn,e.lineNumber,i.endColumn);if(a.length>1){let e=l;for(const{originSelectionRange:t}of a)t&&(e=c.e.plusRange(e,t));this.addDecoration(e,(new s.W5).appendText(p.NC("multipleResults","Click to show {0} definitions.",a.length)))}else{const e=a[0];if(!e.uri)return;this.textModelResolverService.createModelReference(e.uri).then((t=>{if(!t.object||!t.object.textEditorModel)return void t.dispose();const{object:{textEditorModel:i}}=t,{startLineNumber:o}=e.range;if(o<1||o>i.getLineCount())return void t.dispose();const r=this.getPreviewValue(i,o,e),n=this.languageService.guessLanguageIdByFilepathOrFirstLine(i.uri);this.addDecoration(l,r?(new s.W5).appendCodeblock(n||"",r):void 0),t.dispose()}))}}getPreviewValue(e,t,i){let r=i.range;r.endLineNumber-r.startLineNumber>=o.MAX_SOURCE_PREVIEW_LINES&&(r=this.getPreviewRangeBasedOnIndentation(e,t));return this.stripIndentationFromPreviewRange(e,t,r)}stripIndentationFromPreviewRange(e,t,i){let o=e.getLineFirstNonWhitespaceColumn(t);for(let r=t+1;r<i.endLineNumber;r++){const t=e.getLineFirstNonWhitespaceColumn(r);o=Math.min(o,t)}return e.getValueInRange(i).replace(new RegExp(`^\\s{${o-1}}`,"gm"),"").trim()}getPreviewRangeBasedOnIndentation(e,t){const i=e.getLineFirstNonWhitespaceColumn(t),r=Math.min(e.getLineCount(),t+o.MAX_SOURCE_PREVIEW_LINES);let n=t+1;for(;n<r;n++){if(i===e.getLineFirstNonWhitespaceColumn(n))break}return new c.e(t,1,n+1,1)}addDecoration(e,t){const i={range:e,options:{description:"goto-definition-link",inlineClassName:"goto-definition-link",hoverMessage:t}};this.linkDecorations.set([i])}removeLinkDecorations(){this.linkDecorations.clear()}isEnabled(e,t){var i;return this.editor.hasModel()&&e.isLeftClick&&e.isNoneOrSingleMouseDown&&6===e.target.type&&!((null===(i=e.target.detail.injectedText)||void 0===i?void 0:i.options)instanceof y.HS)&&(e.hasTriggerModifier||!!t&&t.keyCodeIsTriggerKey)&&this.languageFeaturesService.definitionProvider.has(this.editor.getModel())}findDefinition(e,t){const i=this.editor.getModel();return i?(0,v.nD)(this.languageFeaturesService.definitionProvider,i,e,t):Promise.resolve(null)}gotoDefinition(e,t){return this.editor.setPosition(e),this.editor.invokeWithinContext((e=>{const i=!t&&this.editor.getOption(88)&&!this.isInPeekEditor(e);return new f.BT({openToSide:t,openInPeek:i,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(e)}))}isInPeekEditor(e){const t=e.get(m.i6);return _.Jy.inPeekEditor.getValue(t)}dispose(){this.toUnhook.dispose(),this.toUnhookForKeyboard.dispose()}};k.ID="editor.contrib.gotodefinitionatposition",k.MAX_SOURCE_PREVIEW_LINES=8,k=o=C([b(1,u.S),b(2,h.O),b(3,w.p)],k),(0,l._K)(k.ID,k,2)},27376:(e,t,i)=>{i.d(t,{J:()=>ue});var o,r=i(15393),n=i(17301),s=i(22258),a=i(5976),d=i(11640),l=i(50187),c=i(24314),h=i(3600),u=i(63580),g=i(94565),_=i(33108),p=i(93983),m=i(72065),f=i(49989),v=i(32414),w=i(59422),y=i(52365),C=i(1293),b=i(65321),k=i(23937),M=i(41264),S=i(4669),D=i(66663),P=i(95935),R=i(22874),N=i(54530),x=i(51381),I=i(68801),E=i(72042),L=i(88216),T=i(67488),O=i(34650),A=i(59834),F=i(75392),W=i(91847),B=i(44349),K=i(86253),H=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},G=function(e,t){return function(i,o){t(i,o,e)}};let U=class{constructor(e){this._resolverService=e}hasChildren(e){return e instanceof C.oQ||e instanceof C.F2}getChildren(e){if(e instanceof C.oQ)return e.groups;if(e instanceof C.F2)return e.resolve(this._resolverService).then((e=>e.children));throw new Error("bad tree")}};U=H([G(0,L.S)],U);class V{getHeight(){return 23}getTemplateId(e){return e instanceof C.F2?X.id:Q.id}}let $=class{constructor(e){this._keybindingService=e}getKeyboardNavigationLabel(e){var t;if(e instanceof C.WX){const i=null===(t=e.parent.getPreview(e))||void 0===t?void 0:t.preview(e.range);if(i)return i.value}return(0,P.EZ)(e.uri)}};$=H([G(0,W.d)],$);class j{getId(e){return e instanceof C.WX?e.id:e.uri}}let Z=class extends a.JT{constructor(e,t){super(),this._labelService=t;const i=document.createElement("div");i.classList.add("reference-file"),this.file=this._register(new A.g(i,{supportHighlights:!0})),this.badge=new T.Z(b.R3(i,b.$(".count")),{},K.ku),e.appendChild(i)}set(e,t){const i=(0,P.XX)(e.uri);this.file.setLabel(this._labelService.getUriBasenameLabel(e.uri),this._labelService.getUriLabel(i,{relative:!0}),{title:this._labelService.getUriLabel(e.uri),matches:t});const o=e.children.length;this.badge.setCount(o),o>1?this.badge.setTitleFormat((0,u.NC)("referencesCount","{0} references",o)):this.badge.setTitleFormat((0,u.NC)("referenceCount","{0} reference",o))}};Z=H([G(1,B.e)],Z);let X=o=class{constructor(e){this._instantiationService=e,this.templateId=o.id}renderTemplate(e){return this._instantiationService.createInstance(Z,e)}renderElement(e,t,i){i.set(e.element,(0,F.mB)(e.filterData))}disposeTemplate(e){e.dispose()}};X.id="FileReferencesRenderer",X=o=H([G(0,m.TG)],X);class J extends a.JT{constructor(e){super(),this.label=this._register(new O.q(e))}set(e,t){var i;const o=null===(i=e.parent.getPreview(e))||void 0===i?void 0:i.preview(e.range);if(o&&o.value){const{value:e,highlight:i}=o;t&&!F.CL.isDefault(t)?(this.label.element.classList.toggle("referenceMatch",!1),this.label.set(e,(0,F.mB)(t))):(this.label.element.classList.toggle("referenceMatch",!0),this.label.set(e,[i]))}else this.label.set(`${(0,P.EZ)(e.uri)}:${e.range.startLineNumber+1}:${e.range.startColumn+1}`)}}class Q{constructor(){this.templateId=Q.id}renderTemplate(e){return new J(e)}renderElement(e,t,i){i.set(e.element,e.filterData)}disposeTemplate(e){e.dispose()}}Q.id="OneReferenceRenderer";class q{getWidgetAriaLabel(){return(0,u.NC)("treeAriaLabel","References")}getAriaLabel(e){return e.ariaMessage}}var z=i(97781),Y=i(64862),ee=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},te=function(e,t){return function(i,o){t(i,o,e)}};class ie{constructor(e,t){this._editor=e,this._model=t,this._decorations=new Map,this._decorationIgnoreSet=new Set,this._callOnDispose=new a.SL,this._callOnModelChange=new a.SL,this._callOnDispose.add(this._editor.onDidChangeModel((()=>this._onModelChanged()))),this._onModelChanged()}dispose(){this._callOnModelChange.dispose(),this._callOnDispose.dispose(),this.removeDecorations()}_onModelChanged(){this._callOnModelChange.clear();const e=this._editor.getModel();if(e)for(const t of this._model.references)if(t.uri.toString()===e.uri.toString())return void this._addDecorations(t.parent)}_addDecorations(e){if(!this._editor.hasModel())return;this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations((()=>this._onDecorationChanged())));const t=[],i=[];for(let o=0,r=e.children.length;o<r;o++){const r=e.children[o];this._decorationIgnoreSet.has(r.id)||r.uri.toString()===this._editor.getModel().uri.toString()&&(t.push({range:r.range,options:ie.DecorationOptions}),i.push(o))}this._editor.changeDecorations((o=>{const r=o.deltaDecorations([],t);for(let t=0;t<r.length;t++)this._decorations.set(r[t],e.children[i[t]])}))}_onDecorationChanged(){const e=[],t=this._editor.getModel();if(t){for(const[i,o]of this._decorations){const r=t.getDecorationRange(i);if(!r)continue;let n=!1;if(!c.e.equalsRange(r,o.range)){if(c.e.spansMultipleLines(r))n=!0;else{o.range.endColumn-o.range.startColumn!==r.endColumn-r.startColumn&&(n=!0)}n?(this._decorationIgnoreSet.add(o.id),e.push(i)):o.range=r}}for(let t=0,i=e.length;t<i;t++)this._decorations.delete(e[t]);this._editor.removeDecorations(e)}}removeDecorations(){this._editor.removeDecorations([...this._decorations.keys()]),this._decorations.clear()}}ie.DecorationOptions=N.qx.register({description:"reference-decoration",stickiness:1,className:"reference-decoration"});class oe{constructor(){this.ratio=.7,this.heightInLines=18}static fromJSON(e){let t,i;try{const o=JSON.parse(e);t=o.ratio,i=o.heightInLines}catch(e){}return{ratio:t||.7,heightInLines:i||18}}}class re extends v.ls{}let ne=class extends h.vk{constructor(e,t,i,o,r,n,s,d,l,c,h,u){super(e,{showFrame:!1,showArrow:!0,isResizeable:!0,isAccessible:!0,supportOnTitleClick:!0},n),this._defaultTreeKeyboardSupport=t,this.layoutData=i,this._textModelResolverService=r,this._instantiationService=n,this._peekViewService=s,this._uriLabel=d,this._undoRedoService=l,this._keybindingService=c,this._languageService=h,this._languageConfigurationService=u,this._disposeOnNewModel=new a.SL,this._callOnDispose=new a.SL,this._onDidSelectReference=new S.Q5,this.onDidSelectReference=this._onDidSelectReference.event,this._dim=new b.Ro(0,0),this._applyTheme(o.getColorTheme()),this._callOnDispose.add(o.onDidColorThemeChange(this._applyTheme.bind(this))),this._peekViewService.addExclusiveWidget(e,this),this.create()}dispose(){this.setModel(void 0),this._callOnDispose.dispose(),this._disposeOnNewModel.dispose(),(0,a.B9)(this._preview),(0,a.B9)(this._previewNotAvailableMessage),(0,a.B9)(this._tree),(0,a.B9)(this._previewModelReference),this._splitView.dispose(),super.dispose()}_applyTheme(e){const t=e.getColor(h.SC)||M.Il.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(h.KY)||M.Il.transparent,primaryHeadingColor:e.getColor(h.IH),secondaryHeadingColor:e.getColor(h.R7)})}show(e){super.show(e,this.layoutData.heightInLines||18)}focusOnReferenceTree(){this._tree.domFocus()}focusOnPreviewEditor(){this._preview.focus()}isPreviewEditorFocused(){return this._preview.hasTextFocus()}_onTitleClick(e){this._preview&&this._preview.getModel()&&this._onDidSelectReference.fire({element:this._getFocusedReference(),kind:e.ctrlKey||e.metaKey||e.altKey?"side":"open",source:"title"})}_fillBody(e){this.setCssClass("reference-zone-widget"),this._messageContainer=b.R3(e,b.$("div.messages")),b.Cp(this._messageContainer),this._splitView=new k.z(e,{orientation:1}),this._previewContainer=b.R3(e,b.$("div.preview.inline"));this._preview=this._instantiationService.createInstance(R.H,this._previewContainer,{scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!0},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}},{},this.editor),b.Cp(this._previewContainer),this._previewNotAvailableMessage=new N.yO(u.NC("missingPreviewMessage","no preview available"),I.bd,N.yO.DEFAULT_CREATION_OPTIONS,null,this._undoRedoService,this._languageService,this._languageConfigurationService),this._treeContainer=b.R3(e,b.$("div.ref-tree.inline"));const t={keyboardSupport:this._defaultTreeKeyboardSupport,accessibilityProvider:new q,keyboardNavigationLabelProvider:this._instantiationService.createInstance($),identityProvider:new j,openOnSingleClick:!0,selectionNavigation:!0,overrideStyles:{listBackground:h.M8}};this._defaultTreeKeyboardSupport&&this._callOnDispose.add(b.mu(this._treeContainer,"keydown",(e=>{e.equals(9)&&(this._keybindingService.dispatchEvent(e,e.target),e.stopPropagation())}),!0)),this._tree=this._instantiationService.createInstance(re,"ReferencesWidget",this._treeContainer,new V,[this._instantiationService.createInstance(X),this._instantiationService.createInstance(Q)],this._instantiationService.createInstance(U),t),this._splitView.addView({onDidChange:S.ju.None,element:this._previewContainer,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:e=>{this._preview.layout({height:this._dim.height,width:e})}},k.M.Distribute),this._splitView.addView({onDidChange:S.ju.None,element:this._treeContainer,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:e=>{this._treeContainer.style.height=`${this._dim.height}px`,this._treeContainer.style.width=`${e}px`,this._tree.layout(this._dim.height,e)}},k.M.Distribute),this._disposables.add(this._splitView.onDidSashChange((()=>{this._dim.width&&(this.layoutData.ratio=this._splitView.getViewSize(0)/this._dim.width)}),void 0));const i=(e,t)=>{e instanceof C.WX&&("show"===t&&this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:t,source:"tree"}))};this._tree.onDidOpen((e=>{e.sideBySide?i(e.element,"side"):e.editorOptions.pinned?i(e.element,"goto"):i(e.element,"show")})),b.Cp(this._treeContainer)}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._dim=new b.Ro(t,e),this.layoutData.heightInLines=this._viewZone?this._viewZone.heightInLines:this.layoutData.heightInLines,this._splitView.layout(t),this._splitView.resizeView(0,t*this.layoutData.ratio)}setSelection(e){return this._revealReference(e,!0).then((()=>{this._model&&(this._tree.setSelection([e]),this._tree.setFocus([e]))}))}setModel(e){return this._disposeOnNewModel.clear(),this._model=e,this._model?this._onNewModel():Promise.resolve()}_onNewModel(){return this._model?this._model.isEmpty?(this.setTitle(""),this._messageContainer.innerText=u.NC("noResults","No results"),b.$Z(this._messageContainer),Promise.resolve(void 0)):(b.Cp(this._messageContainer),this._decorationsManager=new ie(this._preview,this._model),this._disposeOnNewModel.add(this._decorationsManager),this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange((e=>this._tree.rerender(e)))),this._disposeOnNewModel.add(this._preview.onMouseDown((e=>{const{event:t,target:i}=e;if(2!==t.detail)return;const o=this._getFocusedReference();o&&this._onDidSelectReference.fire({element:{uri:o.uri,range:i.range},kind:t.ctrlKey||t.metaKey||t.altKey?"side":"open",source:"editor"})}))),this.container.classList.add("results-loaded"),b.$Z(this._treeContainer),b.$Z(this._previewContainer),this._splitView.layout(this._dim.width),this.focusOnReferenceTree(),this._tree.setInput(1===this._model.groups.length?this._model.groups[0]:this._model)):Promise.resolve(void 0)}_getFocusedReference(){const[e]=this._tree.getFocus();return e instanceof C.WX?e:e instanceof C.F2&&e.children.length>0?e.children[0]:void 0}async revealReference(e){await this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:"goto",source:"tree"})}async _revealReference(e,t){if(this._revealedReference===e)return;this._revealedReference=e,e.uri.scheme!==D.lg.inMemory?this.setTitle((0,P.Hx)(e.uri),this._uriLabel.getUriLabel((0,P.XX)(e.uri))):this.setTitle(u.NC("peekView.alternateTitle","References"));const i=this._textModelResolverService.createModelReference(e.uri);this._tree.getInput()===e.parent||(t&&this._tree.reveal(e.parent),await this._tree.expand(e.parent)),this._tree.reveal(e);const o=await i;if(!this._model)return void o.dispose();(0,a.B9)(this._previewModelReference);const r=o.object;if(r){const t=this._preview.getModel()===r.textEditorModel?0:1,i=c.e.lift(e.range).collapseToStart();this._previewModelReference=o,this._preview.setModel(r.textEditorModel),this._preview.setSelection(i),this._preview.revealRangeInCenter(i,t)}else this._preview.setModel(this._previewNotAvailableMessage),o.dispose()}};ne=ee([te(3,z.XE),te(4,L.S),te(5,m.TG),te(6,h.Fw),te(7,B.e),te(8,Y.tJ),te(9,W.d),te(10,E.O),te(11,x.c_)],ne);var se,ae=i(29102),de=i(39282),le=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},ce=function(e,t){return function(i,o){t(i,o,e)}};const he=new p.uy("referenceSearchVisible",!1,u.NC("referenceSearchVisible","Whether reference peek is visible, like 'Peek References' or 'Peek Definition'"));let ue=se=class{static get(e){return e.getContribution(se.ID)}constructor(e,t,i,o,r,n,s,d){this._defaultTreeKeyboardSupport=e,this._editor=t,this._editorService=o,this._notificationService=r,this._instantiationService=n,this._storageService=s,this._configurationService=d,this._disposables=new a.SL,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=he.bindTo(i)}dispose(){var e,t;this._referenceSearchVisible.reset(),this._disposables.dispose(),null===(e=this._widget)||void 0===e||e.dispose(),null===(t=this._model)||void 0===t||t.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(e,t,i){let o;if(this._widget&&(o=this._widget.position),this.closeWidget(),o&&e.containsPosition(o))return;this._peekMode=i,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage((()=>{this.closeWidget()}))),this._disposables.add(this._editor.onDidChangeModel((()=>{this._ignoreModelChangeEvent||this.closeWidget()})));const r="peekViewLayout",n=oe.fromJSON(this._storageService.get(r,0,"{}"));this._widget=this._instantiationService.createInstance(ne,this._editor,this._defaultTreeKeyboardSupport,n),this._widget.setTitle(u.NC("labelLoading","Loading...")),this._widget.show(e),this._disposables.add(this._widget.onDidClose((()=>{t.cancel(),this._widget&&(this._storageService.store(r,JSON.stringify(this._widget.layoutData),0,1),this._widget=void 0),this.closeWidget()}))),this._disposables.add(this._widget.onDidSelectReference((e=>{const{element:t,kind:o}=e;if(t)switch(o){case"open":"editor"===e.source&&this._configurationService.getValue("editor.stablePeek")||this.openReference(t,!1,!1);break;case"side":this.openReference(t,!0,!1);break;case"goto":i?this._gotoReference(t,!0):this.openReference(t,!1,!0)}})));const s=++this._requestIdPool;t.then((t=>{var i;if(s===this._requestIdPool&&this._widget)return null===(i=this._model)||void 0===i||i.dispose(),this._model=t,this._widget.setModel(this._model).then((()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(""):this._widget.setMetaTitle(u.NC("metaTitle.N","{0} ({1})",this._model.title,this._model.references.length));const t=this._editor.getModel().uri,i=new l.L(e.startLineNumber,e.startColumn),o=this._model.nearestReference(t,i);if(o)return this._widget.setSelection(o).then((()=>{this._widget&&"editor"===this._editor.getOption(87)&&this._widget.focusOnPreviewEditor()}))}}));t.dispose()}),(e=>{this._notificationService.error(e)}))}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}async goToNextOrPreviousReference(e){if(!this._editor.hasModel()||!this._model||!this._widget)return;const t=this._widget.position;if(!t)return;const i=this._model.nearestReference(this._editor.getModel().uri,t);if(!i)return;const o=this._model.nextOrPreviousReference(i,e),r=this._editor.hasTextFocus(),n=this._widget.isPreviewEditorFocused();await this._widget.setSelection(o),await this._gotoReference(o,!1),r?this._editor.focus():this._widget&&n&&this._widget.focusOnPreviewEditor()}async revealReference(e){this._editor.hasModel()&&this._model&&this._widget&&await this._widget.revealReference(e)}closeWidget(e=!0){var t,i;null===(t=this._widget)||void 0===t||t.dispose(),null===(i=this._model)||void 0===i||i.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,e&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(e,t){var i;null===(i=this._widget)||void 0===i||i.hide(),this._ignoreModelChangeEvent=!0;const o=c.e.lift(e.range).collapseToStart();return this._editorService.openCodeEditor({resource:e.uri,options:{selection:o,selectionSource:"code.jump",pinned:t}},this._editor).then((e=>{var t;if(this._ignoreModelChangeEvent=!1,e&&this._widget)if(this._editor===e)this._widget.show(o),this._widget.focusOnReferenceTree();else{const i=se.get(e),n=this._model.clone();this.closeWidget(),e.focus(),null==i||i.toggleWidget(o,(0,r.PG)((e=>Promise.resolve(n))),null!==(t=this._peekMode)&&void 0!==t&&t)}else this.closeWidget()}),(e=>{this._ignoreModelChangeEvent=!1,(0,n.dL)(e)}))}openReference(e,t,i){t||this.closeWidget();const{uri:o,range:r}=e;this._editorService.openCodeEditor({resource:o,options:{selection:r,selectionSource:"code.jump",pinned:i}},this._editor,t)}};function ge(e,t){const i=(0,h.rc)(e);if(!i)return;const o=ue.get(i);o&&t(o)}ue.ID="editor.contrib.referencesController",ue=se=le([ce(2,p.i6),ce(3,d.$),ce(4,w.lT),ce(5,m.TG),ce(6,y.Uy),ce(7,_.Ui)],ue),f.W.registerCommandAndKeybindingRule({id:"togglePeekWidgetFocus",weight:100,primary:(0,s.gx)(2089,60),when:p.Ao.or(he,h.Jy.inPeekEditor),handler(e){ge(e,(e=>{e.changeFocusBetweenPreviewAndReferences()}))}}),f.W.registerCommandAndKeybindingRule({id:"goToNextReference",weight:90,primary:62,secondary:[70],when:p.Ao.or(he,h.Jy.inPeekEditor),handler(e){ge(e,(e=>{e.goToNextOrPreviousReference(!0)}))}}),f.W.registerCommandAndKeybindingRule({id:"goToPreviousReference",weight:90,primary:1086,secondary:[1094],when:p.Ao.or(he,h.Jy.inPeekEditor),handler(e){ge(e,(e=>{e.goToNextOrPreviousReference(!1)}))}}),g.P.registerCommandAlias("goToNextReferenceFromEmbeddedEditor","goToNextReference"),g.P.registerCommandAlias("goToPreviousReferenceFromEmbeddedEditor","goToPreviousReference"),g.P.registerCommandAlias("closeReferenceSearchEditor","closeReferenceSearch"),g.P.registerCommand("closeReferenceSearch",(e=>ge(e,(e=>e.closeWidget())))),f.W.registerKeybindingRule({id:"closeReferenceSearch",weight:-1,primary:9,secondary:[1033],when:p.Ao.and(h.Jy.inPeekEditor,p.Ao.not("config.editor.stablePeek"))}),f.W.registerKeybindingRule({id:"closeReferenceSearch",weight:250,primary:9,secondary:[1033],when:p.Ao.and(he,p.Ao.not("config.editor.stablePeek"),p.Ao.or(ae.u.editorTextFocus,de.Ul.negate()))}),f.W.registerCommandAndKeybindingRule({id:"revealReference",weight:200,primary:3,mac:{primary:3,secondary:[2066]},when:p.Ao.and(he,v.CQ,v.PS.negate(),v.uJ.negate()),handler(e){var t;const i=null===(t=e.get(v.Lw).lastFocusedList)||void 0===t?void 0:t.getFocus();Array.isArray(i)&&i[0]instanceof C.WX&&ge(e,(e=>e.revealReference(i[0])))}}),f.W.registerCommandAndKeybindingRule({id:"openReferenceToSide",weight:100,primary:2051,mac:{primary:259},when:p.Ao.and(he,v.CQ,v.PS.negate(),v.uJ.negate()),handler(e){var t;const i=null===(t=e.get(v.Lw).lastFocusedList)||void 0===t?void 0:t.getFocus();Array.isArray(i)&&i[0]instanceof C.WX&&ge(e,(e=>e.openReference(i[0],!0,!0)))}}),g.P.registerCommand("openReference",(e=>{var t;const i=null===(t=e.get(v.Lw).lastFocusedList)||void 0===t?void 0:t.getFocus();Array.isArray(i)&&i[0]instanceof C.WX&&ge(e,(e=>e.openReference(i[0],!1,!0)))}))},1293:(e,t,i)=>{i.d(t,{F2:()=>_,WX:()=>u,oQ:()=>p});var o=i(17301),r=i(4669),n=i(44742),s=i(5976),a=i(43702),d=i(95935),l=i(97295),c=i(24314),h=i(63580);class u{constructor(e,t,i,o){this.isProviderFirst=e,this.parent=t,this.link=i,this._rangeCallback=o,this.id=n.a.nextId()}get uri(){return this.link.uri}get range(){var e,t;return null!==(t=null!==(e=this._range)&&void 0!==e?e:this.link.targetSelectionRange)&&void 0!==t?t:this.link.range}set range(e){this._range=e,this._rangeCallback(this)}get ariaMessage(){var e;const t=null===(e=this.parent.getPreview(this))||void 0===e?void 0:e.preview(this.range);return t?(0,h.NC)({key:"aria.oneReference.preview",comment:["Placeholders are: 0: filename, 1:line number, 2: column number, 3: preview snippet of source code"]},"{0} in {1} on line {2} at column {3}",t.value,(0,d.EZ)(this.uri),this.range.startLineNumber,this.range.startColumn):(0,h.NC)("aria.oneReference","in {0} on line {1} at column {2}",(0,d.EZ)(this.uri),this.range.startLineNumber,this.range.startColumn)}}class g{constructor(e){this._modelReference=e}dispose(){this._modelReference.dispose()}preview(e,t=8){const i=this._modelReference.object.textEditorModel;if(!i)return;const{startLineNumber:o,startColumn:r,endLineNumber:n,endColumn:s}=e,a=i.getWordUntilPosition({lineNumber:o,column:r-t}),d=new c.e(o,a.startColumn,o,r),l=new c.e(n,s,n,1073741824),h=i.getValueInRange(d).replace(/^\s+/,""),u=i.getValueInRange(e);return{value:h+u+i.getValueInRange(l).replace(/\s+$/,""),highlight:{start:h.length,end:h.length+u.length}}}}class _{constructor(e,t){this.parent=e,this.uri=t,this.children=[],this._previews=new a.Y9}dispose(){(0,s.B9)(this._previews.values()),this._previews.clear()}getPreview(e){return this._previews.get(e.uri)}get ariaMessage(){const e=this.children.length;return 1===e?(0,h.NC)("aria.fileReferences.1","1 symbol in {0}, full path {1}",(0,d.EZ)(this.uri),this.uri.fsPath):(0,h.NC)("aria.fileReferences.N","{0} symbols in {1}, full path {2}",e,(0,d.EZ)(this.uri),this.uri.fsPath)}async resolve(e){if(0!==this._previews.size)return this;for(const t of this.children)if(!this._previews.has(t.uri))try{const i=await e.createModelReference(t.uri);this._previews.set(t.uri,new g(i))}catch(e){(0,o.dL)(e)}return this}}class p{constructor(e,t){this.groups=[],this.references=[],this._onDidChangeReferenceRange=new r.Q5,this.onDidChangeReferenceRange=this._onDidChangeReferenceRange.event,this._links=e,this._title=t;const[i]=e;let o;e.sort(p._compareReferences);for(const t of e)if(o&&d.SF.isEqual(o.uri,t.uri,!0)||(o=new _(this,t.uri),this.groups.push(o)),0===o.children.length||0!==p._compareReferences(t,o.children[o.children.length-1])){const e=new u(i===t,o,t,(e=>this._onDidChangeReferenceRange.fire(e)));this.references.push(e),o.children.push(e)}}dispose(){(0,s.B9)(this.groups),this._onDidChangeReferenceRange.dispose(),this.groups.length=0}clone(){return new p(this._links,this._title)}get title(){return this._title}get isEmpty(){return 0===this.groups.length}get ariaMessage(){return this.isEmpty?(0,h.NC)("aria.result.0","No results found"):1===this.references.length?(0,h.NC)("aria.result.1","Found 1 symbol in {0}",this.references[0].uri.fsPath):1===this.groups.length?(0,h.NC)("aria.result.n1","Found {0} symbols in {1}",this.references.length,this.groups[0].uri.fsPath):(0,h.NC)("aria.result.nm","Found {0} symbols in {1} files",this.references.length,this.groups.length)}nextOrPreviousReference(e,t){const{parent:i}=e;let o=i.children.indexOf(e);const r=i.children.length,n=i.parent.groups.length;return 1===n||t&&o+1<r||!t&&o>0?(o=t?(o+1)%r:(o+r-1)%r,i.children[o]):(o=i.parent.groups.indexOf(i),t?(o=(o+1)%n,i.parent.groups[o].children[0]):(o=(o+n-1)%n,i.parent.groups[o].children[i.parent.groups[o].children.length-1]))}nearestReference(e,t){const i=this.references.map(((i,o)=>({idx:o,prefixLen:l.Mh(i.uri.toString(),e.toString()),offsetDist:100*Math.abs(i.range.startLineNumber-t.lineNumber)+Math.abs(i.range.startColumn-t.column)}))).sort(((e,t)=>e.prefixLen>t.prefixLen?-1:e.prefixLen<t.prefixLen?1:e.offsetDist<t.offsetDist?-1:e.offsetDist>t.offsetDist?1:0))[0];if(i)return this.references[i.idx]}referenceAt(e,t){for(const i of this.references)if(i.uri.toString()===e.toString()&&c.e.containsPosition(i.range,t))return i}firstReference(){for(const e of this.references)if(e.isProviderFirst)return e;return this.references[0]}static _compareReferences(e,t){return d.SF.compare(e.uri,t.uri)||c.e.compareRangesUsingStarts(e.range,t.range)}}}}]);