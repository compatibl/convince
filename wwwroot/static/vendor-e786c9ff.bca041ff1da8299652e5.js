"use strict";(self.webpackChunkui_react=self.webpackChunkui_react||[]).push([[5957],{57326:(e,t,i)=>{var s=i(16830),o=i(63580),n=i(8269),r=i(84144),l=i(33108),d=i(93983),c=i(29102),h=i(5976),a=i(71922),u=i(65321),_=i(77514),g=i(9488),m=i(25670),y=i(60571),S=i(22874),f=i(50187),p=i(50072),L=i(92550),k=i(91557),N=i(83973);class v{constructor(e,t,i,s=null){this.startLineNumbers=e,this.endLineNumbers=t,this.lastLineRelativePosition=i,this.showEndForLine=s}equals(e){return!!e&&this.lastLineRelativePosition===e.lastLineRelativePosition&&this.showEndForLine===e.showEndForLine&&(0,g.fS)(this.startLineNumbers,e.startLineNumbers)&&(0,g.fS)(this.endLineNumbers,e.endLineNumbers)}}const b=(0,_.Z)("stickyScrollViewLayer",{createHTML:e=>e}),C="data-sticky-line-index",D="data-sticky-is-line",M="data-sticky-is-folding-icon";class E extends h.JT{constructor(e){super(),this._editor=e,this._foldingIconStore=new h.SL,this._rootDomNode=document.createElement("div"),this._lineNumbersDomNode=document.createElement("div"),this._linesDomNodeScrollable=document.createElement("div"),this._linesDomNode=document.createElement("div"),this._lineHeight=this._editor.getOption(67),this._renderedStickyLines=[],this._lineNumbers=[],this._lastLineRelativePosition=0,this._minContentWidthInPx=0,this._isOnGlyphMargin=!1,this._lineNumbersDomNode.className="sticky-widget-line-numbers",this._lineNumbersDomNode.setAttribute("role","none"),this._linesDomNode.className="sticky-widget-lines",this._linesDomNode.setAttribute("role","list"),this._linesDomNodeScrollable.className="sticky-widget-lines-scrollable",this._linesDomNodeScrollable.appendChild(this._linesDomNode),this._rootDomNode.className="sticky-widget",this._rootDomNode.classList.toggle("peek",e instanceof S.H),this._rootDomNode.appendChild(this._lineNumbersDomNode),this._rootDomNode.appendChild(this._linesDomNodeScrollable);const t=()=>{this._linesDomNode.style.left=this._editor.getOption(115).scrollWithEditor?`-${this._editor.getScrollLeft()}px`:"0px"};this._register(this._editor.onDidChangeConfiguration((e=>{e.hasChanged(115)&&t(),e.hasChanged(67)&&(this._lineHeight=this._editor.getOption(67))}))),this._register(this._editor.onDidScrollChange((e=>{e.scrollLeftChanged&&t(),e.scrollWidthChanged&&this._updateWidgetWidth()}))),this._register(this._editor.onDidChangeModel((()=>{t(),this._updateWidgetWidth()}))),this._register(this._foldingIconStore),t(),this._register(this._editor.onDidLayoutChange((e=>{this._updateWidgetWidth()}))),this._updateWidgetWidth()}get lineNumbers(){return this._lineNumbers}get lineNumberCount(){return this._lineNumbers.length}getRenderedStickyLine(e){return this._renderedStickyLines.find((t=>t.lineNumber===e))}getCurrentLines(){return this._lineNumbers}setState(e,t,i){if(void 0===i&&(!this._previousState&&!e||this._previousState&&this._previousState.equals(e)))return;const s=this._isWidgetHeightZero(e),o=s?void 0:e,n=s?0:this._findLineToRebuildWidgetFrom(e,i);this._renderRootNode(o,t,n),this._previousState=e}_isWidgetHeightZero(e){if(!e)return!0;const t=e.startLineNumbers.length*this._lineHeight+e.lastLineRelativePosition;if(t>0){this._lastLineRelativePosition=e.lastLineRelativePosition;const t=[...e.startLineNumbers];null!==e.showEndForLine&&(t[e.showEndForLine]=e.endLineNumbers[e.showEndForLine]),this._lineNumbers=t}else this._lastLineRelativePosition=0,this._lineNumbers=[];return 0===t}_findLineToRebuildWidgetFrom(e,t){if(!e||!this._previousState)return 0;if(void 0!==t)return t;const i=this._previousState,s=e.startLineNumbers.findIndex((e=>!i.startLineNumbers.includes(e)));return-1===s?0:s}_updateWidgetWidth(){const e=this._editor.getLayoutInfo(),t=e.contentLeft;this._lineNumbersDomNode.style.width=`${t}px`,this._linesDomNodeScrollable.style.setProperty("--vscode-editorStickyScroll-scrollableWidth",this._editor.getScrollWidth()-e.verticalScrollbarWidth+"px"),this._rootDomNode.style.width=e.width-e.verticalScrollbarWidth+"px"}_clearStickyLinesFromLine(e){this._foldingIconStore.clear();for(let t=e;t<this._renderedStickyLines.length;t++){const e=this._renderedStickyLines[t];e.lineNumberDomNode.remove(),e.lineDomNode.remove()}this._renderedStickyLines=this._renderedStickyLines.slice(0,e),this._rootDomNode.style.display="none"}_useFoldingOpacityTransition(e){this._lineNumbersDomNode.style.setProperty("--vscode-editorStickyScroll-foldingOpacityTransition",`opacity ${e?.5:0}s`)}_setFoldingIconsVisibility(e){for(const t of this._renderedStickyLines){const i=t.foldingIcon;i&&i.setVisible(!!e||i.isCollapsed)}}async _renderRootNode(e,t,i){if(this._clearStickyLinesFromLine(i),!e)return;for(const e of this._renderedStickyLines)this._updateTopAndZIndexOfStickyLine(e);const s=this._editor.getLayoutInfo(),o=this._lineNumbers.slice(i);for(const[e,n]of o.entries()){const o=this._renderChildNode(e+i,n,t,s);o&&(this._linesDomNode.appendChild(o.lineDomNode),this._lineNumbersDomNode.appendChild(o.lineNumberDomNode),this._renderedStickyLines.push(o))}t&&(this._setFoldingHoverListeners(),this._useFoldingOpacityTransition(!this._isOnGlyphMargin));const n=this._lineNumbers.length*this._lineHeight+this._lastLineRelativePosition;this._rootDomNode.style.display="block",this._lineNumbersDomNode.style.height=`${n}px`,this._linesDomNodeScrollable.style.height=`${n}px`,this._rootDomNode.style.height=`${n}px`,this._rootDomNode.style.marginLeft="0px",this._minContentWidthInPx=Math.max(...this._renderedStickyLines.map((e=>e.scrollWidth)))+s.verticalScrollbarWidth,this._editor.layoutOverlayWidget(this)}_setFoldingHoverListeners(){"mouseover"===this._editor.getOption(110)&&(this._foldingIconStore.add(u.nm(this._lineNumbersDomNode,u.tw.MOUSE_ENTER,(()=>{this._isOnGlyphMargin=!0,this._setFoldingIconsVisibility(!0)}))),this._foldingIconStore.add(u.nm(this._lineNumbersDomNode,u.tw.MOUSE_LEAVE,(()=>{this._isOnGlyphMargin=!1,this._useFoldingOpacityTransition(!0),this._setFoldingIconsVisibility(!1)}))))}_renderChildNode(e,t,i,s){const o=this._editor._getViewModel();if(!o)return;const n=o.coordinatesConverter.convertModelPositionToViewPosition(new f.L(t,1)).lineNumber,r=o.getViewLineRenderingData(n),l=this._editor.getOption(68);let d;try{d=L.Kp.filter(r.inlineDecorations,n,r.minColumn,r.maxColumn)}catch(e){d=[]}const c=new k.IJ(!0,!0,r.content,r.continuesWithWrappedLine,r.isBasicASCII,r.containsRTL,0,r.tokens,d,r.tabSize,r.startVisibleColumn,1,1,1,500,"none",!0,!0,null),h=new p.HT(2e3),a=(0,k.d1)(c,h);let u;u=b?b.createHTML(h.build()):h.build();const _=document.createElement("span");_.setAttribute(C,String(e)),_.setAttribute(D,""),_.setAttribute("role","listitem"),_.tabIndex=0,_.className="sticky-line-content",_.classList.add(`stickyLine${t}`),_.style.lineHeight=`${this._lineHeight}px`,_.innerHTML=u;const g=document.createElement("span");g.setAttribute(C,String(e)),g.setAttribute("data-sticky-is-line-number",""),g.className="sticky-line-number",g.style.lineHeight=`${this._lineHeight}px`;const m=s.contentLeft;g.style.width=`${m}px`;const y=document.createElement("span");1===l.renderType||3===l.renderType&&t%10==0?y.innerText=t.toString():2===l.renderType&&(y.innerText=Math.abs(t-this._editor.getPosition().lineNumber).toString()),y.className="sticky-line-number-inner",y.style.lineHeight=`${this._lineHeight}px`,y.style.width=`${s.lineNumbersWidth}px`,y.style.paddingLeft=`${s.lineNumbersLeft}px`,g.appendChild(y);const S=this._renderFoldingIconForLine(i,t);S&&g.appendChild(S.domNode),this._editor.applyFontInfo(_),this._editor.applyFontInfo(y),g.style.lineHeight=`${this._lineHeight}px`,_.style.lineHeight=`${this._lineHeight}px`,g.style.height=`${this._lineHeight}px`,_.style.height=`${this._lineHeight}px`;const N=new x(e,t,_,g,S,a.characterMapping,_.scrollWidth);return this._updateTopAndZIndexOfStickyLine(N)}_updateTopAndZIndexOfStickyLine(e){var t;const i=e.index,s=e.lineDomNode,o=e.lineNumberDomNode,n=i===this._lineNumbers.length-1;s.style.zIndex=n?"0":"1",o.style.zIndex=n?"0":"1";const r=`${i*this._lineHeight+this._lastLineRelativePosition+((null===(t=e.foldingIcon)||void 0===t?void 0:t.isCollapsed)?1:0)}px`,l=i*this._lineHeight+"px";return s.style.top=n?r:l,o.style.top=n?r:l,e}_renderFoldingIconForLine(e,t){const i=this._editor.getOption(110);if(!e||"never"===i)return;const s=e.regions,o=s.findRange(t),n=s.getStartLineNumber(o);if(!(t===n))return;const r=s.isCollapsed(o),l=new I(r,n,s.getEndLineNumber(o),this._lineHeight);return l.setVisible(!!this._isOnGlyphMargin||(r||"always"===i)),l.domNode.setAttribute(M,""),l}getId(){return"editor.contrib.stickyScrollWidget"}getDomNode(){return this._rootDomNode}getPosition(){return{preference:2,stackOridinal:10}}getMinContentWidthInPx(){return this._minContentWidthInPx}focusLineWithIndex(e){0<=e&&e<this._renderedStickyLines.length&&this._renderedStickyLines[e].lineDomNode.focus()}getEditorPositionFromNode(e){if(!e||e.children.length>0)return null;const t=this._getRenderedStickyLineFromChildDomNode(e);if(!t)return null;const i=(0,y.dL)(t.characterMapping,e,0);return new f.L(t.lineNumber,i)}getLineNumberFromChildDomNode(e){var t,i;return null!==(i=null===(t=this._getRenderedStickyLineFromChildDomNode(e))||void 0===t?void 0:t.lineNumber)&&void 0!==i?i:null}_getRenderedStickyLineFromChildDomNode(e){const t=this.getLineIndexFromChildDomNode(e);return null===t||t<0||t>=this._renderedStickyLines.length?null:this._renderedStickyLines[t]}getLineIndexFromChildDomNode(e){const t=this._getAttributeValue(e,C);return t?parseInt(t,10):null}isInStickyLine(e){return void 0!==this._getAttributeValue(e,D)}isInFoldingIconDomNode(e){return void 0!==this._getAttributeValue(e,M)}_getAttributeValue(e,t){for(;e&&e!==this._rootDomNode;){const i=e.getAttribute(t);if(null!==i)return i;e=e.parentElement}}}class x{constructor(e,t,i,s,o,n,r){this.index=e,this.lineNumber=t,this.lineDomNode=i,this.lineNumberDomNode=s,this.foldingIcon=o,this.characterMapping=n,this.scrollWidth=r}}class I{constructor(e,t,i,s){this.isCollapsed=e,this.foldingStartLine=t,this.foldingEndLine=i,this.dimension=s,this.domNode=document.createElement("div"),this.domNode.style.width=`${s}px`,this.domNode.style.height=`${s}px`,this.domNode.className=m.k.asClassName(e?N.f5:N.Iy)}setVisible(e){this.domNode.style.cursor=e?"pointer":"default",this.domNode.style.opacity=e?"1":"0"}}var w=i(71050),F=i(15393),P=i(4669),O=i(51381),W=i(30335),R=i(87981),T=i(99155),V=i(84990),A=i(17301);class H{constructor(e,t){this.startLineNumber=e,this.endLineNumber=t}}class ${constructor(e,t,i){this.range=e,this.children=t,this.parent=i}}class K{constructor(e,t,i,s){this.uri=e,this.version=t,this.element=i,this.outlineProviderId=s}}var G,j,U=i(53725),q=i(72065),z=function(e,t,i,s){var o,n=arguments.length,r=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,i,r):o(t,i))||r);return n>3&&r&&Object.defineProperty(t,i,r),r},J=function(e,t){return function(i,s){t(i,s,e)}};!function(e){e.OUTLINE_MODEL="outlineModel",e.FOLDING_PROVIDER_MODEL="foldingProviderModel",e.INDENTATION_MODEL="indentationModel"}(G||(G={})),function(e){e[e.VALID=0]="VALID",e[e.INVALID=1]="INVALID",e[e.CANCELED=2]="CANCELED"}(j||(j={}));let Z=class extends h.JT{constructor(e,t,i,s){switch(super(),this._editor=e,this._modelProviders=[],this._modelPromise=null,this._updateScheduler=this._register(new F.vp(300)),this._updateOperation=this._register(new h.SL),this._editor.getOption(115).defaultModel){case G.OUTLINE_MODEL:this._modelProviders.push(new X(this._editor,s));case G.FOLDING_PROVIDER_MODEL:this._modelProviders.push(new ee(this._editor,t,s));case G.INDENTATION_MODEL:this._modelProviders.push(new Y(this._editor,i))}}dispose(){this._modelProviders.forEach((e=>e.dispose())),this._updateOperation.clear(),this._cancelModelPromise(),super.dispose()}_cancelModelPromise(){this._modelPromise&&(this._modelPromise.cancel(),this._modelPromise=null)}async update(e){return this._updateOperation.clear(),this._updateOperation.add({dispose:()=>{this._cancelModelPromise(),this._updateScheduler.cancel()}}),this._cancelModelPromise(),await this._updateScheduler.trigger((async()=>{for(const t of this._modelProviders){const{statusPromise:i,modelPromise:s}=t.computeStickyModel(e);this._modelPromise=s;const o=await i;if(this._modelPromise!==s)return null;switch(o){case j.CANCELED:return this._updateOperation.clear(),null;case j.VALID:return t.stickyModel}}return null})).catch((e=>((0,A.dL)(e),null)))}};Z=z([J(2,q.TG),J(3,a.p)],Z);class B extends h.JT{constructor(e){super(),this._editor=e,this._stickyModel=null}get stickyModel(){return this._stickyModel}_invalid(){return this._stickyModel=null,j.INVALID}computeStickyModel(e){if(e.isCancellationRequested||!this.isProviderValid())return{statusPromise:this._invalid(),modelPromise:null};const t=(0,F.PG)((e=>this.createModelFromProvider(e)));return{statusPromise:t.then((t=>this.isModelValid(t)?e.isCancellationRequested?j.CANCELED:(this._stickyModel=this.createStickyModel(e,t),j.VALID):this._invalid())).then(void 0,(e=>((0,A.dL)(e),j.CANCELED))),modelPromise:t}}isModelValid(e){return!0}isProviderValid(){return!0}}let X=class extends B{constructor(e,t){super(e),this._languageFeaturesService=t}createModelFromProvider(e){return W.C3.create(this._languageFeaturesService.documentSymbolProvider,this._editor.getModel(),e)}createStickyModel(e,t){var i;const{stickyOutlineElement:s,providerID:o}=this._stickyModelFromOutlineModel(t,null===(i=this._stickyModel)||void 0===i?void 0:i.outlineProviderId),n=this._editor.getModel();return new K(n.uri,n.getVersionId(),s,o)}isModelValid(e){return e&&e.children.size>0}_stickyModelFromOutlineModel(e,t){let i;if(U.$.first(e.children.values())instanceof W.H3){const s=U.$.find(e.children.values(),(e=>e.id===t));if(s)i=s.children;else{let s,o="",n=-1;for(const[t,i]of e.children.entries()){const e=this._findSumOfRangesOfGroup(i);e>n&&(s=i,n=e,o=i.id)}t=o,i=s.children}}else i=e.children;const s=[],o=Array.from(i.values()).sort(((e,t)=>{const i=new H(e.symbol.range.startLineNumber,e.symbol.range.endLineNumber),s=new H(t.symbol.range.startLineNumber,t.symbol.range.endLineNumber);return this._comparator(i,s)}));for(const e of o)s.push(this._stickyModelFromOutlineElement(e,e.symbol.selectionRange.startLineNumber));return{stickyOutlineElement:new $(void 0,s,void 0),providerID:t}}_stickyModelFromOutlineElement(e,t){const i=[];for(const s of e.children.values())if(s.symbol.selectionRange.startLineNumber!==s.symbol.range.endLineNumber)if(s.symbol.selectionRange.startLineNumber!==t)i.push(this._stickyModelFromOutlineElement(s,s.symbol.selectionRange.startLineNumber));else for(const e of s.children.values())i.push(this._stickyModelFromOutlineElement(e,s.symbol.selectionRange.startLineNumber));i.sort(((e,t)=>this._comparator(e.range,t.range)));const s=new H(e.symbol.selectionRange.startLineNumber,e.symbol.range.endLineNumber);return new $(s,i,void 0)}_comparator(e,t){return e.startLineNumber!==t.startLineNumber?e.startLineNumber-t.startLineNumber:t.endLineNumber-e.endLineNumber}_findSumOfRangesOfGroup(e){let t=0;for(const i of e.children.values())t+=this._findSumOfRangesOfGroup(i);return e instanceof W.sT?t+e.symbol.range.endLineNumber-e.symbol.selectionRange.startLineNumber:t}};X=z([J(1,a.p)],X);class Q extends B{constructor(e){super(e),this._foldingLimitReporter=new R.n(e)}createStickyModel(e,t){const i=this._fromFoldingRegions(t),s=this._editor.getModel();return new K(s.uri,s.getVersionId(),i,void 0)}isModelValid(e){return null!==e}_fromFoldingRegions(e){const t=e.length,i=[],s=new $(void 0,[],void 0);for(let o=0;o<t;o++){const t=e.getParentIndex(o);let n;n=-1!==t?i[t]:s;const r=new $(new H(e.getStartLineNumber(o),e.getEndLineNumber(o)+1),[],n);n.children.push(r),i.push(r)}return s}}let Y=class extends Q{constructor(e,t){super(e),this._languageConfigurationService=t,this.provider=this._register(new V.aI(e.getModel(),this._languageConfigurationService,this._foldingLimitReporter))}async createModelFromProvider(e){return this.provider.compute(e)}};Y=z([J(1,O.c_)],Y);let ee=class extends Q{constructor(e,t,i){super(e),this._languageFeaturesService=i;const s=R.f.getFoldingRangeProviders(this._languageFeaturesService,e.getModel());s.length>0&&(this.provider=this._register(new T.e(e.getModel(),s,t,this._foldingLimitReporter,void 0)))}isProviderValid(){return void 0!==this.provider}async createModelFromProvider(e){var t,i;return null!==(i=null===(t=this.provider)||void 0===t?void 0:t.compute(e))&&void 0!==i?i:null}};ee=z([J(2,a.p)],ee);var te=function(e,t,i,s){var o,n=arguments.length,r=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,i,r):o(t,i))||r);return n>3&&r&&Object.defineProperty(t,i,r),r},ie=function(e,t){return function(i,s){t(i,s,e)}};class se{constructor(e,t,i){this.startLineNumber=e,this.endLineNumber=t,this.nestingDepth=i}}let oe=class extends h.JT{constructor(e,t,i){super(),this._languageFeaturesService=t,this._languageConfigurationService=i,this._onDidChangeStickyScroll=this._register(new P.Q5),this.onDidChangeStickyScroll=this._onDidChangeStickyScroll.event,this._model=null,this._cts=null,this._stickyModelProvider=null,this._editor=e,this._sessionStore=this._register(new h.SL),this._updateSoon=this._register(new F.pY((()=>this.update()),50)),this._register(this._editor.onDidChangeConfiguration((e=>{e.hasChanged(115)&&this.readConfiguration()}))),this.readConfiguration()}readConfiguration(){this._sessionStore.clear();this._editor.getOption(115).enabled&&(this._sessionStore.add(this._editor.onDidChangeModel((()=>{this._model=null,this.updateStickyModelProvider(),this._onDidChangeStickyScroll.fire(),this.update()}))),this._sessionStore.add(this._editor.onDidChangeHiddenAreas((()=>this.update()))),this._sessionStore.add(this._editor.onDidChangeModelContent((()=>this._updateSoon.schedule()))),this._sessionStore.add(this._languageFeaturesService.documentSymbolProvider.onDidChange((()=>this.update()))),this._sessionStore.add((0,h.OF)((()=>{var e;null===(e=this._stickyModelProvider)||void 0===e||e.dispose(),this._stickyModelProvider=null}))),this.updateStickyModelProvider(),this.update())}getVersionId(){var e;return null===(e=this._model)||void 0===e?void 0:e.version}updateStickyModelProvider(){var e;null===(e=this._stickyModelProvider)||void 0===e||e.dispose(),this._stickyModelProvider=null;const t=this._editor;t.hasModel()&&(this._stickyModelProvider=new Z(t,(()=>this._updateSoon.schedule()),this._languageConfigurationService,this._languageFeaturesService))}async update(){var e;null===(e=this._cts)||void 0===e||e.dispose(!0),this._cts=new w.AU,await this.updateStickyModel(this._cts.token),this._onDidChangeStickyScroll.fire()}async updateStickyModel(e){if(!this._editor.hasModel()||!this._stickyModelProvider||this._editor.getModel().isTooLargeForTokenization())return void(this._model=null);const t=await this._stickyModelProvider.update(e);e.isCancellationRequested||(this._model=t)}updateIndex(e){return-1===e?e=0:e<0&&(e=-e-2),e}getCandidateStickyLinesIntersectingFromStickyModel(e,t,i,s,o){if(0===t.children.length)return;let n=o;const r=[];for(let e=0;e<t.children.length;e++){const i=t.children[e];i.range&&r.push(i.range.startLineNumber)}const l=this.updateIndex((0,g.ry)(r,e.startLineNumber,((e,t)=>e-t))),d=this.updateIndex((0,g.ry)(r,e.startLineNumber+s,((e,t)=>e-t)));for(let r=l;r<=d;r++){const l=t.children[r];if(!l)return;if(l.range){const t=l.range.startLineNumber,o=l.range.endLineNumber;e.startLineNumber<=o+1&&t-1<=e.endLineNumber&&t!==n&&(n=t,i.push(new se(t,o-1,s+1)),this.getCandidateStickyLinesIntersectingFromStickyModel(e,l,i,s+1,t))}else this.getCandidateStickyLinesIntersectingFromStickyModel(e,l,i,s,o)}}getCandidateStickyLinesIntersecting(e){var t,i;if(!(null===(t=this._model)||void 0===t?void 0:t.element))return[];let s=[];this.getCandidateStickyLinesIntersectingFromStickyModel(e,this._model.element,s,0,-1);const o=null===(i=this._editor._getViewModel())||void 0===i?void 0:i.getHiddenAreas();if(o)for(const e of o)s=s.filter((t=>!(t.startLineNumber>=e.startLineNumber&&t.endLineNumber<=e.endLineNumber+1)));return s}};oe=te([ie(1,a.p),ie(2,O.c_)],oe);var ne,re=i(5606),le=i(82005),de=i(24314),ce=i(40184),he=i(58722),ae=i(88191),ue=i(7448),_e=i(71705),ge=function(e,t,i,s){var o,n=arguments.length,r=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,i,r):o(t,i))||r);return n>3&&r&&Object.defineProperty(t,i,r),r},me=function(e,t){return function(i,s){t(i,s,e)}};let ye=ne=class extends h.JT{constructor(e,t,i,s,o,n,r){super(),this._editor=e,this._contextMenuService=t,this._languageFeaturesService=i,this._instaService=s,this._contextKeyService=r,this._sessionStore=new h.SL,this._foldingModel=null,this._maxStickyLines=Number.MAX_SAFE_INTEGER,this._candidateDefinitionsLength=-1,this._focusedStickyElementIndex=-1,this._enabled=!1,this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1,this._endLineNumbers=[],this._showEndForLine=null,this._stickyScrollWidget=new E(this._editor),this._stickyLineCandidateProvider=new oe(this._editor,i,o),this._register(this._stickyScrollWidget),this._register(this._stickyLineCandidateProvider),this._widgetState=new v([],[],0),this._onDidResize(),this._readConfiguration();const l=this._stickyScrollWidget.getDomNode();this._register(this._editor.onDidChangeConfiguration((e=>{this._readConfigurationChange(e)}))),this._register(u.nm(l,u.tw.CONTEXT_MENU,(async e=>{this._onContextMenu(u.Jj(l),e)}))),this._stickyScrollFocusedContextKey=c.u.stickyScrollFocused.bindTo(this._contextKeyService),this._stickyScrollVisibleContextKey=c.u.stickyScrollVisible.bindTo(this._contextKeyService);const d=this._register(u.go(l));this._register(d.onDidBlur((e=>{!1===this._positionRevealed&&0===l.clientHeight?(this._focusedStickyElementIndex=-1,this.focus()):this._disposeFocusStickyScrollStore()}))),this._register(d.onDidFocus((e=>{this.focus()}))),this._registerMouseListeners(),this._register(u.nm(l,u.tw.MOUSE_DOWN,(e=>{this._onMouseDown=!0})))}static get(e){return e.getContribution(ne.ID)}_disposeFocusStickyScrollStore(){var e;this._stickyScrollFocusedContextKey.set(!1),null===(e=this._focusDisposableStore)||void 0===e||e.dispose(),this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1}focus(){if(this._onMouseDown)return this._onMouseDown=!1,void this._editor.focus();!0!==this._stickyScrollFocusedContextKey.get()&&(this._focused=!0,this._focusDisposableStore=new h.SL,this._stickyScrollFocusedContextKey.set(!0),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumbers.length-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}focusNext(){this._focusedStickyElementIndex<this._stickyScrollWidget.lineNumberCount-1&&this._focusNav(!0)}focusPrevious(){this._focusedStickyElementIndex>0&&this._focusNav(!1)}selectEditor(){this._editor.focus()}_focusNav(e){this._focusedStickyElementIndex=e?this._focusedStickyElementIndex+1:this._focusedStickyElementIndex-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex)}goToFocused(){const e=this._stickyScrollWidget.lineNumbers;this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:e[this._focusedStickyElementIndex],column:1})}_revealPosition(e){this._reveaInEditor(e,(()=>this._editor.revealPosition(e)))}_revealLineInCenterIfOutsideViewport(e){this._reveaInEditor(e,(()=>this._editor.revealLineInCenterIfOutsideViewport(e.lineNumber,0)))}_reveaInEditor(e,t){this._focused&&this._disposeFocusStickyScrollStore(),this._positionRevealed=!0,t(),this._editor.setSelection(de.e.fromPositions(e)),this._editor.focus()}_registerMouseListeners(){const e=this._register(new h.SL),t=this._register(new le.yN(this._editor,{extractLineNumberFromMouseEvent:e=>{const t=this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);return t?t.lineNumber:0}})),i=e=>{if(!this._editor.hasModel())return null;if(12!==e.target.type||e.target.detail!==this._stickyScrollWidget.getId())return null;const t=e.target.element;if(!t||t.innerText!==t.innerHTML)return null;const i=this._stickyScrollWidget.getEditorPositionFromNode(t);return i?{range:new de.e(i.lineNumber,i.column,i.lineNumber,i.column+t.innerText.length),textElement:t}:null},s=this._stickyScrollWidget.getDomNode();this._register(u.mu(s,u.tw.CLICK,(e=>{if(e.ctrlKey||e.altKey||e.metaKey)return;if(!e.leftButton)return;if(e.shiftKey){const t=this._stickyScrollWidget.getLineIndexFromChildDomNode(e.target);if(null===t)return;const i=new f.L(this._endLineNumbers[t],1);return void this._revealLineInCenterIfOutsideViewport(i)}if(this._stickyScrollWidget.isInFoldingIconDomNode(e.target)){const t=this._stickyScrollWidget.getLineNumberFromChildDomNode(e.target);return void this._toggleFoldingRegionForLine(t)}if(!this._stickyScrollWidget.isInStickyLine(e.target))return;let t=this._stickyScrollWidget.getEditorPositionFromNode(e.target);if(!t){const i=this._stickyScrollWidget.getLineNumberFromChildDomNode(e.target);if(null===i)return;t=new f.L(i,1)}this._revealPosition(t)}))),this._register(u.mu(s,u.tw.MOUSE_MOVE,(e=>{if(e.shiftKey){const t=this._stickyScrollWidget.getLineIndexFromChildDomNode(e.target);if(null===t||null!==this._showEndForLine&&this._showEndForLine===t)return;return this._showEndForLine=t,void this._renderStickyScroll()}null!==this._showEndForLine&&(this._showEndForLine=null,this._renderStickyScroll())}))),this._register(u.nm(s,u.tw.MOUSE_LEAVE,(e=>{null!==this._showEndForLine&&(this._showEndForLine=null,this._renderStickyScroll())}))),this._register(t.onMouseMoveOrRelevantKeyDown((([t,s])=>{const o=i(t);if(!o||!t.hasTriggerModifier||!this._editor.hasModel())return void e.clear();const{range:n,textElement:r}=o;if(n.equalsRange(this._stickyRangeProjectedOnEditor)){if("underline"===r.style.textDecoration)return}else this._stickyRangeProjectedOnEditor=n,e.clear();const l=new w.AU;let d;e.add((0,h.OF)((()=>l.dispose(!0)))),(0,ce.nD)(this._languageFeaturesService.definitionProvider,this._editor.getModel(),new f.L(n.startLineNumber,n.startColumn+1),l.token).then((t=>{if(!l.token.isCancellationRequested)if(0!==t.length){this._candidateDefinitionsLength=t.length;const i=r;d!==i?(e.clear(),d=i,d.style.textDecoration="underline",e.add((0,h.OF)((()=>{d.style.textDecoration="none"})))):d||(d=i,d.style.textDecoration="underline",e.add((0,h.OF)((()=>{d.style.textDecoration="none"}))))}else e.clear()}))}))),this._register(t.onCancel((()=>{e.clear()}))),this._register(t.onExecute((async e=>{if(12!==e.target.type||e.target.detail!==this._stickyScrollWidget.getId())return;const t=this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);t&&this._editor.hasModel()&&this._stickyRangeProjectedOnEditor&&(this._candidateDefinitionsLength>1&&(this._focused&&this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:t.lineNumber,column:1})),this._instaService.invokeFunction(he.K,e,this._editor,{uri:this._editor.getModel().uri,range:this._stickyRangeProjectedOnEditor}))})))}_onContextMenu(e,t){const i=new ue.n(e,t);this._contextMenuService.showContextMenu({menuId:r.eH.StickyScrollContext,getAnchor:()=>i})}_toggleFoldingRegionForLine(e){if(!this._foldingModel||null===e)return;const t=this._stickyScrollWidget.getRenderedStickyLine(e),i=null==t?void 0:t.foldingIcon;if(!i)return;(0,_e.d8)(this._foldingModel,Number.MAX_VALUE,[e]),i.isCollapsed=!i.isCollapsed;const s=(i.isCollapsed?this._editor.getTopForLineNumber(i.foldingEndLine):this._editor.getTopForLineNumber(i.foldingStartLine))-this._editor.getOption(67)*t.index+1;this._editor.setScrollTop(s),this._renderStickyScroll(e)}_readConfiguration(){const e=this._editor.getOption(115);if(!1===e.enabled)return this._editor.removeOverlayWidget(this._stickyScrollWidget),this._sessionStore.clear(),void(this._enabled=!1);e.enabled&&!this._enabled&&(this._editor.addOverlayWidget(this._stickyScrollWidget),this._sessionStore.add(this._editor.onDidScrollChange((e=>{e.scrollTopChanged&&(this._showEndForLine=null,this._renderStickyScroll())}))),this._sessionStore.add(this._editor.onDidLayoutChange((()=>this._onDidResize()))),this._sessionStore.add(this._editor.onDidChangeModelTokens((e=>this._onTokensChange(e)))),this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll((()=>{this._showEndForLine=null,this._renderStickyScroll()}))),this._enabled=!0);2===this._editor.getOption(68).renderType&&this._sessionStore.add(this._editor.onDidChangeCursorPosition((()=>{this._showEndForLine=null,this._renderStickyScroll(0)})))}_readConfigurationChange(e){(e.hasChanged(115)||e.hasChanged(73)||e.hasChanged(67)||e.hasChanged(110)||e.hasChanged(68))&&this._readConfiguration(),e.hasChanged(68)&&this._renderStickyScroll(0)}_needsUpdate(e){const t=this._stickyScrollWidget.getCurrentLines();for(const i of t)for(const t of e.ranges)if(i>=t.fromLineNumber&&i<=t.toLineNumber)return!0;return!1}_onTokensChange(e){this._needsUpdate(e)&&this._renderStickyScroll(0)}_onDidResize(){const e=this._editor.getLayoutInfo().height/this._editor.getOption(67);this._maxStickyLines=Math.round(.25*e)}async _renderStickyScroll(e){var t,i;const s=this._editor.getModel();if(!s||s.isTooLargeForTokenization())return this._foldingModel=null,void this._stickyScrollWidget.setState(void 0,null);const o=this._stickyLineCandidateProvider.getVersionId();if(void 0===o||o===s.getVersionId())if(this._foldingModel=null!==(i=await(null===(t=R.f.get(this._editor))||void 0===t?void 0:t.getFoldingModel()))&&void 0!==i?i:null,this._widgetState=this.findScrollWidgetState(),this._stickyScrollVisibleContextKey.set(!(0===this._widgetState.startLineNumbers.length)),this._focused)if(-1===this._focusedStickyElementIndex)this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,e),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1,-1!==this._focusedStickyElementIndex&&this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);else{const t=this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];if(this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,e),0===this._stickyScrollWidget.lineNumberCount)this._focusedStickyElementIndex=-1;else{this._stickyScrollWidget.lineNumbers.includes(t)||(this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1),this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex)}}else this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,e)}findScrollWidgetState(){const e=this._editor.getOption(67),t=Math.min(this._maxStickyLines,this._editor.getOption(115).maxLineCount),i=this._editor.getScrollTop();let s=0;const o=[],n=[],r=this._editor.getVisibleRanges();if(0!==r.length){const l=new H(r[0].startLineNumber,r[r.length-1].endLineNumber),d=this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(l);for(const r of d){const l=r.startLineNumber,d=r.endLineNumber,c=r.nestingDepth;if(d-l>0){const r=(c-1)*e,h=c*e,a=this._editor.getBottomForLineNumber(l)-i,u=this._editor.getTopForLineNumber(d)-i,_=this._editor.getBottomForLineNumber(d)-i;if(r>u&&r<=_){o.push(l),n.push(d+1),s=_-h;break}if(h>a&&h<=_&&(o.push(l),n.push(d+1)),o.length===t)break}}}return this._endLineNumbers=n,new v(o,n,s,this._showEndForLine)}dispose(){super.dispose(),this._sessionStore.dispose()}};ye.ID="store.contrib.stickyScrollController",ye=ne=ge([me(1,re.i),me(2,a.p),me(3,q.TG),me(4,O.c_),me(5,ae.A),me(6,d.i6)],ye);class Se extends r.Ke{constructor(){super({id:"editor.action.toggleStickyScroll",title:{...(0,o.vv)("toggleEditorStickyScroll","Toggle Editor Sticky Scroll"),mnemonicTitle:(0,o.NC)({key:"mitoggleStickyScroll",comment:["&& denotes a mnemonic"]},"&&Toggle Editor Sticky Scroll")},metadata:{description:(0,o.vv)("toggleEditorStickyScroll.description","Toggle/enable the editor sticky scroll which shows the nested scopes at the top of the viewport")},category:n.R.View,toggled:{condition:d.Ao.equals("config.editor.stickyScroll.enabled",!0),title:(0,o.NC)("stickyScroll","Sticky Scroll"),mnemonicTitle:(0,o.NC)({key:"miStickyScroll",comment:["&& denotes a mnemonic"]},"&&Sticky Scroll")},menu:[{id:r.eH.CommandPalette},{id:r.eH.MenubarAppearanceMenu,group:"4_editor",order:3},{id:r.eH.StickyScrollContext}]})}async run(e){const t=e.get(l.Ui),i=!t.getValue("editor.stickyScroll.enabled");return t.updateValue("editor.stickyScroll.enabled",i)}}const fe=100;class pe extends s.x1{constructor(){super({id:"editor.action.focusStickyScroll",title:{...(0,o.vv)("focusStickyScroll","Focus on the editor sticky scroll"),mnemonicTitle:(0,o.NC)({key:"mifocusStickyScroll",comment:["&& denotes a mnemonic"]},"&&Focus Sticky Scroll")},precondition:d.Ao.and(d.Ao.has("config.editor.stickyScroll.enabled"),c.u.stickyScrollVisible),menu:[{id:r.eH.CommandPalette}]})}runEditorCommand(e,t){var i;null===(i=ye.get(t))||void 0===i||i.focus()}}class Le extends s.x1{constructor(){super({id:"editor.action.selectNextStickyScrollLine",title:(0,o.vv)("selectNextStickyScrollLine.title","Select the next editor sticky scroll line"),precondition:c.u.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:fe,primary:18}})}runEditorCommand(e,t){var i;null===(i=ye.get(t))||void 0===i||i.focusNext()}}class ke extends s.x1{constructor(){super({id:"editor.action.selectPreviousStickyScrollLine",title:(0,o.vv)("selectPreviousStickyScrollLine.title","Select the previous sticky scroll line"),precondition:c.u.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:fe,primary:16}})}runEditorCommand(e,t){var i;null===(i=ye.get(t))||void 0===i||i.focusPrevious()}}class Ne extends s.x1{constructor(){super({id:"editor.action.goToFocusedStickyScrollLine",title:(0,o.vv)("goToFocusedStickyScrollLine.title","Go to the focused sticky scroll line"),precondition:c.u.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:fe,primary:3}})}runEditorCommand(e,t){var i;null===(i=ye.get(t))||void 0===i||i.goToFocused()}}class ve extends s.x1{constructor(){super({id:"editor.action.selectEditor",title:(0,o.vv)("selectEditor.title","Select Editor"),precondition:c.u.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:fe,primary:9}})}runEditorCommand(e,t){var i;null===(i=ye.get(t))||void 0===i||i.selectEditor()}}(0,s._K)(ye.ID,ye,1),(0,r.r1)(Se),(0,r.r1)(pe),(0,r.r1)(ke),(0,r.r1)(Le),(0,r.r1)(Ne),(0,r.r1)(ve)}}]);