"use strict";(self.webpackChunkui_react=self.webpackChunkui_react||[]).push([[9070],{25079:(e,t,i)=>{i.d(t,{N:()=>E});var n=i(65321),s=i(38626),o=i(93911),a=i(5976),r=i(1432),h=i(97295),l=i(37208),d=i(86130),m=i(64141),c=i(24314),u=i(89636),g=i(89743),p=i(1118),_=i(82992),C=i(3860),L=i(10553);const f=(()=>{const e=[];for(let t=32;t<=126;t++)e.push(t);return e.push(65533),e})();var D=i(85427);class b{constructor(e,t){this.scale=t,this._minimapCharRendererBrand=void 0,this.charDataNormal=b.soften(e,.8),this.charDataLight=b.soften(e,50/60)}static soften(e,t){const i=new Uint8ClampedArray(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=(0,D.K)(e[n]*t);return i}renderChar(e,t,i,n,s,o,a,r,h,l,d){const m=1*this.scale,c=2*this.scale,u=d?1:c;if(t+m>e.width||i+u>e.height)return;const g=l?this.charDataLight:this.charDataNormal,p=((e,t)=>(e-=32)<0||e>96?t<=2?(e+96)%96:95:e)(n,h),_=4*e.width,C=a.r,L=a.g,f=a.b,D=s.r-C,b=s.g-L,A=s.b-f,N=Math.max(o,r),v=e.data;let B=p*m*c,S=i*_+4*t;for(let e=0;e<u;e++){let e=S;for(let t=0;t<m;t++){const t=g[B++]/255*(o/255);v[e++]=C+D*t,v[e++]=L+b*t,v[e++]=f+A*t,v[e++]=N}S+=_}}blockRenderChar(e,t,i,n,s,o,a,r){const h=1*this.scale,l=2*this.scale,d=r?1:l;if(t+h>e.width||i+d>e.height)return;const m=4*e.width,c=s/255*.5,u=o.r,g=o.g,p=o.b,_=u+(n.r-u)*c,C=g+(n.g-g)*c,L=p+(n.b-p)*c,f=Math.max(s,a),D=e.data;let b=i*m+4*t;for(let e=0;e<d;e++){let e=b;for(let t=0;t<h;t++)D[e++]=_,D[e++]=C,D[e++]=L,D[e++]=f;b+=m}}}var A=i(88289);const N={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15},v=e=>{const t=new Uint8ClampedArray(e.length/2);for(let i=0;i<e.length;i+=2)t[i>>1]=N[e[i]]<<4|15&N[e[i+1]];return t},B={1:(0,A.M)((()=>v("0000511D6300CF609C709645A78432005642574171487021003C451900274D35D762755E8B629C5BA856AF57BA649530C167D1512A272A3F6038604460398526BCA2A968DB6F8957C768BE5FBE2FB467CF5D8D5B795DC7625B5DFF50DE64C466DB2FC47CD860A65E9A2EB96CB54CE06DA763AB2EA26860524D3763536601005116008177A8705E53AB738E6A982F88BAA35B5F5B626D9C636B449B737E5B7B678598869A662F6B5B8542706C704C80736A607578685B70594A49715A4522E792"))),2:(0,A.M)((()=>v("000000000000000055394F383D2800008B8B1F210002000081B1CBCBCC820000847AAF6B9AAF2119BE08B8881AD60000A44FD07DCCF107015338130C00000000385972265F390B406E2437634B4B48031B12B8A0847000001E15B29A402F0000000000004B33460B00007A752C2A0000000000004D3900000084394B82013400ABA5CFC7AD9C0302A45A3E5A98AB000089A43382D97900008BA54AA087A70A0248A6A7AE6DBE0000BF6F94987EA40A01A06DCFA7A7A9030496C32F77891D0000A99FB1A0AFA80603B29AB9CA75930D010C0948354D3900000C0948354F37460D0028BE673D8400000000AF9D7B6E00002B007AA8933400007AA642675C2700007984CFB9C3985B768772A8A6B7B20000CAAECAAFC4B700009F94A6009F840009D09F9BA4CA9C0000CC8FC76DC87F0000C991C472A2000000A894A48CA7B501079BA2C9C69BA20000B19A5D3FA89000005CA6009DA2960901B0A7F0669FB200009D009E00B7890000DAD0F5D092820000D294D4C48BD10000B5A7A4A3B1A50402CAB6CBA6A2000000B5A7A4A3B1A8044FCDADD19D9CB00000B7778F7B8AAE0803C9AB5D3F5D3F00009EA09EA0BAB006039EA0989A8C7900009B9EF4D6B7C00000A9A7816CACA80000ABAC84705D3F000096DA635CDC8C00006F486F266F263D4784006124097B00374F6D2D6D2D6D4A3A95872322000000030000000000008D8939130000000000002E22A5C9CBC70600AB25C0B5C9B400061A2DB04CA67001082AA6BEBEBFC606002321DACBC19E03087AA08B6768380000282FBAC0B8CA7A88AD25BBA5A29900004C396C5894A6000040485A6E356E9442A32CD17EADA70000B4237923628600003E2DE9C1D7B500002F25BBA5A2990000231DB6AFB4A804023025C0B5CAB588062B2CBDBEC0C706882435A75CA20000002326BD6A82A908048B4B9A5A668000002423A09CB4BB060025259C9D8A7900001C1FCAB2C7C700002A2A9387ABA200002626A4A47D6E9D14333163A0C87500004B6F9C2D643A257049364936493647358A34438355497F1A0000A24C1D590000D38DFFBDD4CD3126")))};class S{static create(e,t){if(this.lastCreated&&e===this.lastCreated.scale&&t===this.lastFontFamily)return this.lastCreated;let i;return i=B[e]?new b(B[e](),e):S.createFromSampleData(S.createSampleData(t).data,e),this.lastFontFamily=t,this.lastCreated=i,i}static createSampleData(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.style.height="16px",t.height=16,t.width=960,t.style.width="960px",i.fillStyle="#ffffff",i.font=`bold 16px ${e}`,i.textBaseline="middle";let n=0;for(const e of f)i.fillText(String.fromCharCode(e),n,8),n+=10;return i.getImageData(0,0,960,16)}static createFromSampleData(e,t){if(61440!==e.length)throw new Error("Unexpected source in MinimapCharRenderer");const i=S._downsample(e,t);return new b(i,t)}static _downsampleChar(e,t,i,n,s){const o=1*s,a=2*s;let r=n,h=0;for(let n=0;n<a;n++){const s=n/a*16,l=(n+1)/a*16;for(let n=0;n<o;n++){const a=n/o*10,d=(n+1)/o*10;let m=0,c=0;for(let i=s;i<l;i++){const n=t+3840*Math.floor(i),s=1-(i-Math.floor(i));for(let t=a;t<d;t++){const i=1-(t-Math.floor(t)),o=n+4*Math.floor(t),a=i*s;c+=a,m+=e[o]*e[o+3]/255*a}}const u=m/c;h=Math.max(h,u),i[r++]=(0,D.K)(u)}}return h}static _downsample(e,t){const i=2*t*1*t,n=96*i,s=new Uint8ClampedArray(n);let o=0,a=0,r=0;for(let n=0;n<96;n++)r=Math.max(r,this._downsampleChar(e,a,s,o,t)),o+=i,a+=40;if(r>0){const e=255/r;for(let t=0;t<n;t++)s[t]*=e}return s}}var M=i(43702),w=i(26611);class H{constructor(e,t,i){const n=e.options,s=n.get(143),o=n.get(145),a=o.minimap,r=n.get(50),h=n.get(73);this.renderMinimap=a.renderMinimap,this.size=h.size,this.minimapHeightIsEditorHeight=a.minimapHeightIsEditorHeight,this.scrollBeyondLastLine=n.get(105),this.paddingTop=n.get(84).top,this.paddingBottom=n.get(84).bottom,this.showSlider=h.showSlider,this.autohide=h.autohide,this.pixelRatio=s,this.typicalHalfwidthCharacterWidth=r.typicalHalfwidthCharacterWidth,this.lineHeight=n.get(67),this.minimapLeft=a.minimapLeft,this.minimapWidth=a.minimapWidth,this.minimapHeight=o.height,this.canvasInnerWidth=a.minimapCanvasInnerWidth,this.canvasInnerHeight=a.minimapCanvasInnerHeight,this.canvasOuterWidth=a.minimapCanvasOuterWidth,this.canvasOuterHeight=a.minimapCanvasOuterHeight,this.isSampling=a.minimapIsSampling,this.editorHeight=o.height,this.fontScale=a.minimapScale,this.minimapLineHeight=a.minimapLineHeight,this.minimapCharWidth=1*this.fontScale,this.sectionHeaderFontFamily=w.r,this.sectionHeaderFontSize=h.sectionHeaderFontSize*s,this.sectionHeaderLetterSpacing=h.sectionHeaderLetterSpacing,this.sectionHeaderFontColor=H._getSectionHeaderColor(t,i.getColor(1)),this.charRenderer=(0,A.M)((()=>S.create(this.fontScale,r.fontFamily))),this.defaultBackgroundColor=i.getColor(2),this.backgroundColor=H._getMinimapBackground(t,this.defaultBackgroundColor),this.foregroundAlpha=H._getMinimapForegroundOpacity(t)}static _getMinimapBackground(e,t){const i=e.getColor(_.kVY);return i?new u.h(i.rgba.r,i.rgba.g,i.rgba.b,Math.round(255*i.rgba.a)):t}static _getMinimapForegroundOpacity(e){const t=e.getColor(_.Itd);return t?u.h._clamp(Math.round(255*t.rgba.a)):255}static _getSectionHeaderColor(e,t){const i=e.getColor(_.NOs);return i?new u.h(i.rgba.r,i.rgba.g,i.rgba.b,Math.round(255*i.rgba.a)):t}equals(e){return this.renderMinimap===e.renderMinimap&&this.size===e.size&&this.minimapHeightIsEditorHeight===e.minimapHeightIsEditorHeight&&this.scrollBeyondLastLine===e.scrollBeyondLastLine&&this.paddingTop===e.paddingTop&&this.paddingBottom===e.paddingBottom&&this.showSlider===e.showSlider&&this.autohide===e.autohide&&this.pixelRatio===e.pixelRatio&&this.typicalHalfwidthCharacterWidth===e.typicalHalfwidthCharacterWidth&&this.lineHeight===e.lineHeight&&this.minimapLeft===e.minimapLeft&&this.minimapWidth===e.minimapWidth&&this.minimapHeight===e.minimapHeight&&this.canvasInnerWidth===e.canvasInnerWidth&&this.canvasInnerHeight===e.canvasInnerHeight&&this.canvasOuterWidth===e.canvasOuterWidth&&this.canvasOuterHeight===e.canvasOuterHeight&&this.isSampling===e.isSampling&&this.editorHeight===e.editorHeight&&this.fontScale===e.fontScale&&this.minimapLineHeight===e.minimapLineHeight&&this.minimapCharWidth===e.minimapCharWidth&&this.sectionHeaderFontSize===e.sectionHeaderFontSize&&this.sectionHeaderLetterSpacing===e.sectionHeaderLetterSpacing&&this.defaultBackgroundColor&&this.defaultBackgroundColor.equals(e.defaultBackgroundColor)&&this.backgroundColor&&this.backgroundColor.equals(e.backgroundColor)&&this.foregroundAlpha===e.foregroundAlpha}}class F{constructor(e,t,i,n,s,o,a,r,h){this.scrollTop=e,this.scrollHeight=t,this.sliderNeeded=i,this._computedSliderRatio=n,this.sliderTop=s,this.sliderHeight=o,this.topPaddingLineCount=a,this.startLineNumber=r,this.endLineNumber=h}getDesiredScrollTopFromDelta(e){return Math.round(this.scrollTop+e/this._computedSliderRatio)}getDesiredScrollTopFromTouchLocation(e){return Math.round((e-this.sliderHeight/2)/this._computedSliderRatio)}intersectWithViewport(e){const t=Math.max(this.startLineNumber,e.startLineNumber),i=Math.min(this.endLineNumber,e.endLineNumber);return t>i?null:[t,i]}getYForLineNumber(e,t){return+(e-this.startLineNumber+this.topPaddingLineCount)*t}static create(e,t,i,n,s,o,a,r,h,l,d){const m=e.pixelRatio,c=e.minimapLineHeight,u=Math.floor(e.canvasInnerHeight/c),g=e.lineHeight;if(e.minimapHeightIsEditorHeight){let t=r*e.lineHeight+e.paddingTop+e.paddingBottom;e.scrollBeyondLastLine&&(t+=Math.max(0,s-e.lineHeight-e.paddingBottom));const i=Math.max(1,Math.floor(s*s/t)),n=Math.max(0,e.minimapHeight-i),o=n/(l-s),d=h*o,m=n>0,c=Math.floor(e.canvasInnerHeight/e.minimapLineHeight),u=Math.floor(e.paddingTop/e.lineHeight);return new F(h,l,m,o,d,i,u,1,Math.min(a,c))}let p;if(o&&i!==a){const e=i-t+1;p=Math.floor(e*c/m)}else{const e=s/g;p=Math.floor(e*c/m)}const _=Math.floor(e.paddingTop/g);let C,L=Math.floor(e.paddingBottom/g);if(e.scrollBeyondLastLine){const e=s/g;L=Math.max(L,e-1)}if(L>0){C=(_+a+L-s/g-1)*c/m}else C=Math.max(0,(_+a)*c/m-p);C=Math.min(e.minimapHeight-p,C);const f=C/(l-s),D=h*f;if(u>=_+a+L){return new F(h,l,C>0,f,D,p,_,1,a)}{let i,s;i=t>1?t+_:Math.max(1,h/g);let o=Math.max(1,Math.floor(i-D*m/c));o<_?(s=_-o+1,o=1):(s=0,o=Math.max(1,o-_)),d&&d.scrollHeight===l&&(d.scrollTop>h&&(o=Math.min(o,d.startLineNumber),s=Math.max(s,d.topPaddingLineCount)),d.scrollTop<h&&(o=Math.max(o,d.startLineNumber),s=Math.min(s,d.topPaddingLineCount)));const r=Math.min(a,o-s+u-1),C=(h-n)/g;let L;return L=h>=e.paddingTop?(t-o+s+C)*c/m:h/e.paddingTop*(s+C)*c/m,new F(h,l,!0,f,L,p,s,o,r)}}}class T{constructor(e){this.dy=e}onContentChanged(){this.dy=-1}onTokensChanged(){this.dy=-1}}T.INVALID=new T(-1);class y{constructor(e,t,i){this.renderedLayout=e,this._imageData=t,this._renderedLines=new l.F((()=>T.INVALID)),this._renderedLines._set(e.startLineNumber,i)}linesEquals(e){if(!this.scrollEquals(e))return!1;const t=this._renderedLines._get().lines;for(let e=0,i=t.length;e<i;e++)if(-1===t[e].dy)return!1;return!0}scrollEquals(e){return this.renderedLayout.startLineNumber===e.startLineNumber&&this.renderedLayout.endLineNumber===e.endLineNumber}_get(){const e=this._renderedLines._get();return{imageData:this._imageData,rendLineNumberStart:e.rendLineNumberStart,lines:e.lines}}onLinesChanged(e,t){return this._renderedLines.onLinesChanged(e,t)}onLinesDeleted(e,t){this._renderedLines.onLinesDeleted(e,t)}onLinesInserted(e,t){this._renderedLines.onLinesInserted(e,t)}onTokensChanged(e){return this._renderedLines.onTokensChanged(e)}}class x{constructor(e,t,i,n){this._backgroundFillData=x._createBackgroundFillData(t,i,n),this._buffers=[e.createImageData(t,i),e.createImageData(t,i)],this._lastUsedBuffer=0}getBuffer(){this._lastUsedBuffer=1-this._lastUsedBuffer;const e=this._buffers[this._lastUsedBuffer];return e.data.set(this._backgroundFillData),e}static _createBackgroundFillData(e,t,i){const n=i.r,s=i.g,o=i.b,a=i.a,r=new Uint8ClampedArray(e*t*4);let h=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++)r[h]=n,r[h+1]=s,r[h+2]=o,r[h+3]=a,h+=4;return r}}class R{static compute(e,t,i){if(0===e.renderMinimap||!e.isSampling)return[null,[]];const{minimapLineCount:n}=m.gk.computeContainedMinimapLineCount({viewLineCount:t,scrollBeyondLastLine:e.scrollBeyondLastLine,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,height:e.editorHeight,lineHeight:e.lineHeight,pixelRatio:e.pixelRatio}),s=t/n,o=s/2;if(!i||0===i.minimapLines.length){const e=[];if(e[0]=1,n>1){for(let t=0,i=n-1;t<i;t++)e[t]=Math.round(t*s+o);e[n-1]=t}return[new R(s,e),[]]}const a=i.minimapLines,r=a.length,h=[];let l=0,d=0,c=1;let u=[],g=null;for(let e=0;e<n;e++){const i=Math.max(c,Math.round(e*s)),m=Math.max(i,Math.round((e+1)*s));for(;l<r&&a[l]<i;){if(u.length<10){const e=l+1+d;g&&"deleted"===g.type&&g._oldIndex===l-1?g.deleteToLineNumber++:(g={type:"deleted",_oldIndex:l,deleteFromLineNumber:e,deleteToLineNumber:e},u.push(g)),d--}l++}let p;if(l<r&&a[l]<=m)p=a[l],l++;else if(p=0===e?1:e+1===n?t:Math.round(e*s+o),u.length<10){const t=l+1+d;g&&"inserted"===g.type&&g._i===e-1?g.insertToLineNumber++:(g={type:"inserted",_i:e,insertFromLineNumber:t,insertToLineNumber:t},u.push(g)),d++}h[e]=p,c=p}if(u.length<10)for(;l<r;){const e=l+1+d;g&&"deleted"===g.type&&g._oldIndex===l-1?g.deleteToLineNumber++:(g={type:"deleted",_oldIndex:l,deleteFromLineNumber:e,deleteToLineNumber:e},u.push(g)),d--,l++}else u=[{type:"flush"}];return[new R(s,h),u]}constructor(e,t){this.samplingRatio=e,this.minimapLines=t}modelLineToMinimapLine(e){return Math.min(this.minimapLines.length,Math.max(1,Math.round(e/this.samplingRatio)))}modelLineRangeToMinimapLineRange(e,t){let i=this.modelLineToMinimapLine(e)-1;for(;i>0&&this.minimapLines[i-1]>=e;)i--;let n=this.modelLineToMinimapLine(t)-1;for(;n+1<this.minimapLines.length&&this.minimapLines[n+1]<=t;)n++;if(i===n){const n=this.minimapLines[i];if(n<e||n>t)return null}return[i+1,n+1]}decorationLineRangeToMinimapLineRange(e,t){let i=this.modelLineToMinimapLine(e),n=this.modelLineToMinimapLine(t);return e!==t&&n===i&&(n===this.minimapLines.length?i>1&&i--:n++),[i,n]}onLinesDeleted(e){const t=e.toLineNumber-e.fromLineNumber+1;let i=this.minimapLines.length,n=0;for(let s=this.minimapLines.length-1;s>=0&&!(this.minimapLines[s]<e.fromLineNumber);s--)this.minimapLines[s]<=e.toLineNumber?(this.minimapLines[s]=Math.max(1,e.fromLineNumber-1),i=Math.min(i,s),n=Math.max(n,s)):this.minimapLines[s]-=t;return[i,n]}onLinesInserted(e){const t=e.toLineNumber-e.fromLineNumber+1;for(let i=this.minimapLines.length-1;i>=0&&!(this.minimapLines[i]<e.fromLineNumber);i--)this.minimapLines[i]+=t}}class E extends d.E{constructor(e){super(e),this._sectionHeaderCache=new M.z6(10,1.5),this.tokensColorTracker=g.E.getInstance(),this._selections=[],this._minimapSelections=null,this.options=new H(this._context.configuration,this._context.theme,this.tokensColorTracker);const[t]=R.compute(this.options,this._context.viewModel.getLineCount(),null);this._samplingState=t,this._shouldCheckSampling=!1,this._actual=new I(e.theme,this)}dispose(){this._actual.dispose(),super.dispose()}getDomNode(){return this._actual.getDomNode()}_onOptionsMaybeChanged(){const e=new H(this._context.configuration,this._context.theme,this.tokensColorTracker);return!this.options.equals(e)&&(this.options=e,this._recreateLineSampling(),this._actual.onDidChangeOptions(),!0)}onConfigurationChanged(e){return this._onOptionsMaybeChanged()}onCursorStateChanged(e){return this._selections=e.selections,this._minimapSelections=null,this._actual.onSelectionChanged()}onDecorationsChanged(e){return!!e.affectsMinimap&&this._actual.onDecorationsChanged()}onFlushed(e){return this._samplingState&&(this._shouldCheckSampling=!0),this._actual.onFlushed()}onLinesChanged(e){if(this._samplingState){const t=this._samplingState.modelLineRangeToMinimapLineRange(e.fromLineNumber,e.fromLineNumber+e.count-1);return!!t&&this._actual.onLinesChanged(t[0],t[1]-t[0]+1)}return this._actual.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){if(this._samplingState){const[t,i]=this._samplingState.onLinesDeleted(e);return t<=i&&this._actual.onLinesChanged(t+1,i-t+1),this._shouldCheckSampling=!0,!0}return this._actual.onLinesDeleted(e.fromLineNumber,e.toLineNumber)}onLinesInserted(e){return this._samplingState?(this._samplingState.onLinesInserted(e),this._shouldCheckSampling=!0,!0):this._actual.onLinesInserted(e.fromLineNumber,e.toLineNumber)}onScrollChanged(e){return this._actual.onScrollChanged()}onThemeChanged(e){return this._actual.onThemeChanged(),this._onOptionsMaybeChanged(),!0}onTokensChanged(e){if(this._samplingState){const t=[];for(const i of e.ranges){const e=this._samplingState.modelLineRangeToMinimapLineRange(i.fromLineNumber,i.toLineNumber);e&&t.push({fromLineNumber:e[0],toLineNumber:e[1]})}return!!t.length&&this._actual.onTokensChanged(t)}return this._actual.onTokensChanged(e.ranges)}onTokensColorsChanged(e){return this._onOptionsMaybeChanged(),this._actual.onTokensColorsChanged()}onZonesChanged(e){return this._actual.onZonesChanged()}prepareRender(e){this._shouldCheckSampling&&(this._shouldCheckSampling=!1,this._recreateLineSampling())}render(e){let t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber;this._samplingState&&(t=this._samplingState.modelLineToMinimapLine(t),i=this._samplingState.modelLineToMinimapLine(i));const n={viewportContainsWhitespaceGaps:e.viewportData.whitespaceViewportData.length>0,scrollWidth:e.scrollWidth,scrollHeight:e.scrollHeight,viewportStartLineNumber:t,viewportEndLineNumber:i,viewportStartLineNumberVerticalOffset:e.getVerticalOffsetForLineNumber(t),scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,viewportWidth:e.viewportWidth,viewportHeight:e.viewportHeight};this._actual.render(n)}_recreateLineSampling(){this._minimapSelections=null;const e=Boolean(this._samplingState),[t,i]=R.compute(this.options,this._context.viewModel.getLineCount(),this._samplingState);if(this._samplingState=t,e&&this._samplingState)for(const e of i)switch(e.type){case"deleted":this._actual.onLinesDeleted(e.deleteFromLineNumber,e.deleteToLineNumber);break;case"inserted":this._actual.onLinesInserted(e.insertFromLineNumber,e.insertToLineNumber);break;case"flush":this._actual.onFlushed()}}getLineCount(){return this._samplingState?this._samplingState.minimapLines.length:this._context.viewModel.getLineCount()}getRealLineCount(){return this._context.viewModel.getLineCount()}getLineContent(e){return this._samplingState?this._context.viewModel.getLineContent(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineContent(e)}getLineMaxColumn(e){return this._samplingState?this._context.viewModel.getLineMaxColumn(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineMaxColumn(e)}getMinimapLinesRenderingData(e,t,i){if(this._samplingState){const n=[];for(let s=0,o=t-e+1;s<o;s++)i[s]?n[s]=this._context.viewModel.getViewLineData(this._samplingState.minimapLines[e+s-1]):n[s]=null;return n}return this._context.viewModel.getMinimapLinesRenderingData(e,t,i).data}getSelections(){if(null===this._minimapSelections)if(this._samplingState){this._minimapSelections=[];for(const e of this._selections){const[t,i]=this._samplingState.decorationLineRangeToMinimapLineRange(e.startLineNumber,e.endLineNumber);this._minimapSelections.push(new C.Y(t,e.startColumn,i,e.endColumn))}}else this._minimapSelections=this._selections;return this._minimapSelections}getMinimapDecorationsInViewport(e,t){const i=this._getMinimapDecorationsInViewport(e,t).filter((e=>{var t;return!(null===(t=e.options.minimap)||void 0===t?void 0:t.sectionHeaderStyle)}));if(this._samplingState){const e=[];for(const t of i){if(!t.options.minimap)continue;const i=t.range,n=this._samplingState.modelLineToMinimapLine(i.startLineNumber),s=this._samplingState.modelLineToMinimapLine(i.endLineNumber);e.push(new p.$l(new c.e(n,i.startColumn,s,i.endColumn),t.options))}return e}return i}getSectionHeaderDecorationsInViewport(e,t){const i=this.options.minimapLineHeight,n=this.options.sectionHeaderFontSize/i;return e=Math.floor(Math.max(1,e-n)),this._getMinimapDecorationsInViewport(e,t).filter((e=>{var t;return!!(null===(t=e.options.minimap)||void 0===t?void 0:t.sectionHeaderStyle)}))}_getMinimapDecorationsInViewport(e,t){let i;if(this._samplingState){const n=this._samplingState.minimapLines[e-1],s=this._samplingState.minimapLines[t-1];i=new c.e(n,1,s,this._context.viewModel.getLineMaxColumn(s))}else i=new c.e(e,1,t,this._context.viewModel.getLineMaxColumn(t));return this._context.viewModel.getMinimapDecorationsInRange(i)}getSectionHeaderText(e,t){var i;const n=null===(i=e.options.minimap)||void 0===i?void 0:i.sectionHeaderText;if(!n)return null;const s=this._sectionHeaderCache.get(n);if(s)return s;const o=t(n);return this._sectionHeaderCache.set(n,o),o}getOptions(){return this._context.viewModel.model.getOptions()}revealLineNumber(e){this._samplingState&&(e=this._samplingState.minimapLines[e-1]),this._context.viewModel.revealRange("mouse",!1,new c.e(e,1,e,1),1,0)}setScrollTop(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e},1)}}class I extends a.JT{constructor(e,t){super(),this._renderDecorations=!1,this._gestureInProgress=!1,this._theme=e,this._model=t,this._lastRenderData=null,this._buffers=null,this._selectionColor=this._theme.getColor(_.ov3),this._domNode=(0,s.X)(document.createElement("div")),d.K.write(this._domNode,9),this._domNode.setClassName(this._getMinimapDomNodeClassName()),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._shadow=(0,s.X)(document.createElement("div")),this._shadow.setClassName("minimap-shadow-hidden"),this._domNode.appendChild(this._shadow),this._canvas=(0,s.X)(document.createElement("canvas")),this._canvas.setPosition("absolute"),this._canvas.setLeft(0),this._domNode.appendChild(this._canvas),this._decorationsCanvas=(0,s.X)(document.createElement("canvas")),this._decorationsCanvas.setPosition("absolute"),this._decorationsCanvas.setClassName("minimap-decorations-layer"),this._decorationsCanvas.setLeft(0),this._domNode.appendChild(this._decorationsCanvas),this._slider=(0,s.X)(document.createElement("div")),this._slider.setPosition("absolute"),this._slider.setClassName("minimap-slider"),this._slider.setLayerHinting(!0),this._slider.setContain("strict"),this._domNode.appendChild(this._slider),this._sliderHorizontal=(0,s.X)(document.createElement("div")),this._sliderHorizontal.setPosition("absolute"),this._sliderHorizontal.setClassName("minimap-slider-horizontal"),this._slider.appendChild(this._sliderHorizontal),this._applyLayout(),this._pointerDownListener=n.mu(this._domNode.domNode,n.tw.POINTER_DOWN,(e=>{e.preventDefault();if(0===this._model.options.renderMinimap)return;if(!this._lastRenderData)return;if("proportional"!==this._model.options.size){if(0===e.button&&this._lastRenderData){const t=n.i(this._slider.domNode),i=t.top+t.height/2;this._startSliderDragging(e,i,this._lastRenderData.renderedLayout)}return}const t=this._model.options.minimapLineHeight,i=this._model.options.canvasInnerHeight/this._model.options.canvasOuterHeight*e.offsetY;let s=Math.floor(i/t)+this._lastRenderData.renderedLayout.startLineNumber-this._lastRenderData.renderedLayout.topPaddingLineCount;s=Math.min(s,this._model.getLineCount()),this._model.revealLineNumber(s)})),this._sliderPointerMoveMonitor=new o.C,this._sliderPointerDownListener=n.mu(this._slider.domNode,n.tw.POINTER_DOWN,(e=>{e.preventDefault(),e.stopPropagation(),0===e.button&&this._lastRenderData&&this._startSliderDragging(e,e.pageY,this._lastRenderData.renderedLayout)})),this._gestureDisposable=L.o.addTarget(this._domNode.domNode),this._sliderTouchStartListener=n.nm(this._domNode.domNode,L.t.Start,(e=>{e.preventDefault(),e.stopPropagation(),this._lastRenderData&&(this._slider.toggleClassName("active",!0),this._gestureInProgress=!0,this.scrollDueToTouchEvent(e))}),{passive:!1}),this._sliderTouchMoveListener=n.nm(this._domNode.domNode,L.t.Change,(e=>{e.preventDefault(),e.stopPropagation(),this._lastRenderData&&this._gestureInProgress&&this.scrollDueToTouchEvent(e)}),{passive:!1}),this._sliderTouchEndListener=n.mu(this._domNode.domNode,L.t.End,(e=>{e.preventDefault(),e.stopPropagation(),this._gestureInProgress=!1,this._slider.toggleClassName("active",!1)}))}_startSliderDragging(e,t,i){if(!(e.target&&e.target instanceof Element))return;const s=e.pageX;this._slider.toggleClassName("active",!0);const o=(e,o)=>{const a=n.i(this._domNode.domNode),h=Math.min(Math.abs(o-s),Math.abs(o-a.left),Math.abs(o-a.left-a.width));if(r.ED&&h>140)return void this._model.setScrollTop(i.scrollTop);const l=e-t;this._model.setScrollTop(i.getDesiredScrollTopFromDelta(l))};e.pageY!==t&&o(e.pageY,s),this._sliderPointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,(e=>o(e.pageY,e.pageX)),(()=>{this._slider.toggleClassName("active",!1)}))}scrollDueToTouchEvent(e){const t=this._domNode.domNode.getBoundingClientRect().top,i=this._lastRenderData.renderedLayout.getDesiredScrollTopFromTouchLocation(e.pageY-t);this._model.setScrollTop(i)}dispose(){this._pointerDownListener.dispose(),this._sliderPointerMoveMonitor.dispose(),this._sliderPointerDownListener.dispose(),this._gestureDisposable.dispose(),this._sliderTouchStartListener.dispose(),this._sliderTouchMoveListener.dispose(),this._sliderTouchEndListener.dispose(),super.dispose()}_getMinimapDomNodeClassName(){const e=["minimap"];return"always"===this._model.options.showSlider?e.push("slider-always"):e.push("slider-mouseover"),this._model.options.autohide&&e.push("autohide"),e.join(" ")}getDomNode(){return this._domNode}_applyLayout(){this._domNode.setLeft(this._model.options.minimapLeft),this._domNode.setWidth(this._model.options.minimapWidth),this._domNode.setHeight(this._model.options.minimapHeight),this._shadow.setHeight(this._model.options.minimapHeight),this._canvas.setWidth(this._model.options.canvasOuterWidth),this._canvas.setHeight(this._model.options.canvasOuterHeight),this._canvas.domNode.width=this._model.options.canvasInnerWidth,this._canvas.domNode.height=this._model.options.canvasInnerHeight,this._decorationsCanvas.setWidth(this._model.options.canvasOuterWidth),this._decorationsCanvas.setHeight(this._model.options.canvasOuterHeight),this._decorationsCanvas.domNode.width=this._model.options.canvasInnerWidth,this._decorationsCanvas.domNode.height=this._model.options.canvasInnerHeight,this._slider.setWidth(this._model.options.minimapWidth)}_getBuffer(){return this._buffers||this._model.options.canvasInnerWidth>0&&this._model.options.canvasInnerHeight>0&&(this._buffers=new x(this._canvas.domNode.getContext("2d"),this._model.options.canvasInnerWidth,this._model.options.canvasInnerHeight,this._model.options.backgroundColor)),this._buffers?this._buffers.getBuffer():null}onDidChangeOptions(){this._lastRenderData=null,this._buffers=null,this._applyLayout(),this._domNode.setClassName(this._getMinimapDomNodeClassName())}onSelectionChanged(){return this._renderDecorations=!0,!0}onDecorationsChanged(){return this._renderDecorations=!0,!0}onFlushed(){return this._lastRenderData=null,!0}onLinesChanged(e,t){return!!this._lastRenderData&&this._lastRenderData.onLinesChanged(e,t)}onLinesDeleted(e,t){var i;return null===(i=this._lastRenderData)||void 0===i||i.onLinesDeleted(e,t),!0}onLinesInserted(e,t){var i;return null===(i=this._lastRenderData)||void 0===i||i.onLinesInserted(e,t),!0}onScrollChanged(){return this._renderDecorations=!0,!0}onThemeChanged(){return this._selectionColor=this._theme.getColor(_.ov3),this._renderDecorations=!0,!0}onTokensChanged(e){return!!this._lastRenderData&&this._lastRenderData.onTokensChanged(e)}onTokensColorsChanged(){return this._lastRenderData=null,this._buffers=null,!0}onZonesChanged(){return this._lastRenderData=null,!0}render(e){if(0===this._model.options.renderMinimap)return this._shadow.setClassName("minimap-shadow-hidden"),this._sliderHorizontal.setWidth(0),void this._sliderHorizontal.setHeight(0);e.scrollLeft+e.viewportWidth>=e.scrollWidth?this._shadow.setClassName("minimap-shadow-hidden"):this._shadow.setClassName("minimap-shadow-visible");const t=F.create(this._model.options,e.viewportStartLineNumber,e.viewportEndLineNumber,e.viewportStartLineNumberVerticalOffset,e.viewportHeight,e.viewportContainsWhitespaceGaps,this._model.getLineCount(),this._model.getRealLineCount(),e.scrollTop,e.scrollHeight,this._lastRenderData?this._lastRenderData.renderedLayout:null);this._slider.setDisplay(t.sliderNeeded?"block":"none"),this._slider.setTop(t.sliderTop),this._slider.setHeight(t.sliderHeight),this._sliderHorizontal.setLeft(0),this._sliderHorizontal.setWidth(this._model.options.minimapWidth),this._sliderHorizontal.setTop(0),this._sliderHorizontal.setHeight(t.sliderHeight),this.renderDecorations(t),this._lastRenderData=this.renderLines(t)}renderDecorations(e){if(this._renderDecorations){this._renderDecorations=!1;const t=this._model.getSelections();t.sort(c.e.compareRangesUsingStarts);const i=this._model.getMinimapDecorationsInViewport(e.startLineNumber,e.endLineNumber);i.sort(((e,t)=>(e.options.zIndex||0)-(t.options.zIndex||0)));const{canvasInnerWidth:n,canvasInnerHeight:s}=this._model.options,o=this._model.options.minimapLineHeight,a=this._model.options.minimapCharWidth,r=this._model.getOptions().tabSize,h=this._decorationsCanvas.domNode.getContext("2d");h.clearRect(0,0,n,s);const l=new k(e.startLineNumber,e.endLineNumber,!1);this._renderSelectionLineHighlights(h,t,l,e,o),this._renderDecorationsLineHighlights(h,i,l,e,o);const d=new k(e.startLineNumber,e.endLineNumber,null);this._renderSelectionsHighlights(h,t,d,e,o,r,a,n),this._renderDecorationsHighlights(h,i,d,e,o,r,a,n),this._renderSectionHeaders(e)}}_renderSelectionLineHighlights(e,t,i,n,s){if(!this._selectionColor||this._selectionColor.isTransparent())return;e.fillStyle=this._selectionColor.transparent(.5).toString();let o=0,a=0;for(const r of t){const t=n.intersectWithViewport(r);if(!t)continue;const[h,l]=t;for(let e=h;e<=l;e++)i.set(e,!0);const d=n.getYForLineNumber(h,s),c=n.getYForLineNumber(l,s);a>=d||(a>o&&e.fillRect(m.y0,o,e.canvas.width,a-o),o=d),a=c}a>o&&e.fillRect(m.y0,o,e.canvas.width,a-o)}_renderDecorationsLineHighlights(e,t,i,n,s){const o=new Map;for(let a=t.length-1;a>=0;a--){const r=t[a],h=r.options.minimap;if(!h||1!==h.position)continue;const l=n.intersectWithViewport(r.range);if(!l)continue;const[d,c]=l,u=h.getColor(this._theme.value);if(!u||u.isTransparent())continue;let g=o.get(u.toString());g||(g=u.transparent(.5).toString(),o.set(u.toString(),g)),e.fillStyle=g;for(let t=d;t<=c;t++){if(i.has(t))continue;i.set(t,!0);const o=n.getYForLineNumber(d,s);e.fillRect(m.y0,o,e.canvas.width,s)}}}_renderSelectionsHighlights(e,t,i,n,s,o,a,r){if(this._selectionColor&&!this._selectionColor.isTransparent())for(const h of t){const t=n.intersectWithViewport(h);if(!t)continue;const[l,d]=t;for(let t=l;t<=d;t++)this.renderDecorationOnLine(e,i,h,this._selectionColor,n,t,s,s,o,a,r)}}_renderDecorationsHighlights(e,t,i,n,s,o,a,r){for(const h of t){const t=h.options.minimap;if(!t)continue;const l=n.intersectWithViewport(h.range);if(!l)continue;const[d,m]=l,c=t.getColor(this._theme.value);if(c&&!c.isTransparent())for(let l=d;l<=m;l++)switch(t.position){case 1:this.renderDecorationOnLine(e,i,h.range,c,n,l,s,s,o,a,r);continue;case 2:{const t=n.getYForLineNumber(l,s),i=2;this.renderDecoration(e,c,i,t,2,s);continue}}}}renderDecorationOnLine(e,t,i,n,s,o,a,r,h,l,d){const m=s.getYForLineNumber(o,r);if(m+a<0||m>this._model.options.canvasInnerHeight)return;const{startLineNumber:c,endLineNumber:u}=i,g=c===o?i.startColumn:1,p=u===o?i.endColumn:this._model.getLineMaxColumn(o),_=this.getXOffsetForPosition(t,o,g,h,l,d),C=this.getXOffsetForPosition(t,o,p,h,l,d);this.renderDecoration(e,n,_,m,C-_,a)}getXOffsetForPosition(e,t,i,n,s,o){if(1===i)return m.y0;if((i-1)*s>=o)return o;let a=e.get(t);if(!a){const i=this._model.getLineContent(t);a=[m.y0];let r=m.y0;for(let e=1;e<i.length+1;e++){const t=i.charCodeAt(e-1),l=r+(9===t?n*s:h.K7(t)?2*s:s);if(l>=o){a[e]=o;break}a[e]=l,r=l}e.set(t,a)}return i-1<a.length?a[i-1]:o}renderDecoration(e,t,i,n,s,o){e.fillStyle=t&&t.toString()||"",e.fillRect(i,n,s,o)}_renderSectionHeaders(e){var t;const i=this._model.options.minimapLineHeight,n=this._model.options.sectionHeaderFontSize,s=this._model.options.sectionHeaderLetterSpacing,o=1.5*n,{canvasInnerWidth:a}=this._model.options,r=this._model.options.backgroundColor,h=`rgb(${r.r} ${r.g} ${r.b} / .7)`,l=this._model.options.sectionHeaderFontColor,d=`rgb(${l.r} ${l.g} ${l.b})`,c=d,u=this._decorationsCanvas.domNode.getContext("2d");u.letterSpacing=s+"px",u.font="500 "+n+"px "+this._model.options.sectionHeaderFontFamily,u.strokeStyle=c,u.lineWidth=.2;const g=this._model.getSectionHeaderDecorationsInViewport(e.startLineNumber,e.endLineNumber);g.sort(((e,t)=>e.range.startLineNumber-t.range.startLineNumber));const p=I._fitSectionHeader.bind(null,u,a-m.y0);for(const s of g){const r=e.getYForLineNumber(s.range.startLineNumber,i)+n,l=r-n,m=l+2,c=this._model.getSectionHeaderText(s,p);I._renderSectionLabel(u,c,2===(null===(t=s.options.minimap)||void 0===t?void 0:t.sectionHeaderStyle),h,d,a,l,o,r,m)}}static _fitSectionHeader(e,t,i){if(!i)return i;const n=e.measureText(i).width,s=e.measureText("…").width;if(n<=t||n<=s)return i;const o=i.length,a=n/i.length,r=Math.floor((t-s)/a)-1;let h=Math.ceil(r/2);for(;h>0&&/\s/.test(i[h-1]);)--h;return i.substring(0,h)+"…"+i.substring(o-(r-h))}static _renderSectionLabel(e,t,i,n,s,o,a,r,h,l){t&&(e.fillStyle=n,e.fillRect(0,a,o,r),e.fillStyle=s,e.fillText(t,m.y0,h)),i&&(e.beginPath(),e.moveTo(0,l),e.lineTo(o,l),e.closePath(),e.stroke())}renderLines(e){const t=e.startLineNumber,i=e.endLineNumber,n=this._model.options.minimapLineHeight;if(this._lastRenderData&&this._lastRenderData.linesEquals(e)){const t=this._lastRenderData._get();return new y(e,t.imageData,t.lines)}const s=this._getBuffer();if(!s)return null;const[o,a,r]=I._renderUntouchedLines(s,e.topPaddingLineCount,t,i,n,this._lastRenderData),h=this._model.getMinimapLinesRenderingData(t,i,r),l=this._model.getOptions().tabSize,d=this._model.options.defaultBackgroundColor,m=this._model.options.backgroundColor,c=this._model.options.foregroundAlpha,g=this._model.tokensColorTracker,p=g.backgroundIsLight(),_=this._model.options.renderMinimap,C=this._model.options.charRenderer(),L=this._model.options.fontScale,f=this._model.options.minimapCharWidth,D=(1===_?2:3)*L,b=n>D?Math.floor((n-D)/2):0,A=m.a/255,N=new u.h(Math.round((m.r-d.r)*A+d.r),Math.round((m.g-d.g)*A+d.g),Math.round((m.b-d.b)*A+d.b),255);let v=e.topPaddingLineCount*n;const B=[];for(let e=0,o=i-t+1;e<o;e++)r[e]&&I._renderLine(s,N,m.a,p,_,f,g,c,C,v,b,l,h[e],L,n),B[e]=new T(v),v+=n;const S=-1===o?0:o,M=(-1===a?s.height:a)-S;return this._canvas.domNode.getContext("2d").putImageData(s,0,0,0,S,s.width,M),new y(e,s,B)}static _renderUntouchedLines(e,t,i,n,s,o){const a=[];if(!o){for(let e=0,t=n-i+1;e<t;e++)a[e]=!0;return[-1,-1,a]}const r=o._get(),h=r.imageData.data,l=r.rendLineNumberStart,d=r.lines,m=d.length,c=e.width,u=e.data,g=(n-i+1)*s*c*4;let p=-1,_=-1,C=-1,L=-1,f=-1,D=-1,b=t*s;for(let e=i;e<=n;e++){const t=e-i,n=e-l,o=n>=0&&n<m?d[n].dy:-1;if(-1===o){a[t]=!0,b+=s;continue}const r=o*c*4,A=(o+s)*c*4,N=b*c*4,v=(b+s)*c*4;L===r&&D===N?(L=A,D=v):(-1!==C&&(u.set(h.subarray(C,L),f),-1===p&&0===C&&C===f&&(p=L),-1===_&&L===g&&C===f&&(_=C)),C=r,L=A,f=N,D=v),a[t]=!1,b+=s}-1!==C&&(u.set(h.subarray(C,L),f),-1===p&&0===C&&C===f&&(p=L),-1===_&&L===g&&C===f&&(_=C));return[-1===p?-1:p/(4*c),-1===_?-1:_/(4*c),a]}static _renderLine(e,t,i,n,s,o,a,r,l,d,c,u,g,p,_){const C=g.content,L=g.tokens,f=e.width-o,D=1===_;let b=m.y0,A=0,N=0;for(let m=0,g=L.getCount();m<g;m++){const g=L.getEndOffset(m),_=L.getForeground(m),v=a.getColor(_);for(;A<g;A++){if(b>f)return;const a=C.charCodeAt(A);if(9===a){const e=u-(A+N)%u;N+=e-1,b+=e*o}else if(32===a)b+=o;else{const m=h.K7(a)?2:1;for(let h=0;h<m;h++)if(2===s?l.blockRenderChar(e,b,d+c,v,r,t,i,D):l.renderChar(e,b,d+c,a,v,r,t,i,p,n,D),b+=o,b>f)return}}}}}class k{constructor(e,t,i){this._startLineNumber=e,this._endLineNumber=t,this._defaultValue=i,this._values=[];for(let e=0,t=this._endLineNumber-this._startLineNumber+1;e<t;e++)this._values[e]=i}has(e){return this.get(e)!==this._defaultValue}set(e,t){e<this._startLineNumber||e>this._endLineNumber||(this._values[e-this._startLineNumber]=t)}get(e){return e<this._startLineNumber||e>this._endLineNumber?this._defaultValue:this._values[e-this._startLineNumber]}}}}]);