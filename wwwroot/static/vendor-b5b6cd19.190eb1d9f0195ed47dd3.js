"use strict";(self.webpackChunkui_react=self.webpackChunkui_react||[]).push([[1144],{26987:(t,e,n)=>{n.d(e,{gD:()=>o});var i=n(35146),s=n(50187),r=n(84973);class o{constructor(t,e,n,i,s){this.injectionOffsets=t,this.injectionOptions=e,this.breakOffsets=n,this.breakOffsetsVisibleColumn=i,this.wrappedTextIndentLength=s}getOutputLineCount(){return this.breakOffsets.length}getMinOutputOffset(t){return t>0?this.wrappedTextIndentLength:0}getLineLength(t){const e=t>0?this.breakOffsets[t-1]:0;let n=this.breakOffsets[t]-e;return t>0&&(n+=this.wrappedTextIndentLength),n}getMaxOutputOffset(t){return this.getLineLength(t)}translateToInputOffset(t,e){t>0&&(e=Math.max(0,e-this.wrappedTextIndentLength));let n=0===t?e:this.breakOffsets[t-1]+e;if(null!==this.injectionOffsets)for(let t=0;t<this.injectionOffsets.length&&n>this.injectionOffsets[t];t++)n<this.injectionOffsets[t]+this.injectionOptions[t].content.length?n=this.injectionOffsets[t]:n-=this.injectionOptions[t].content.length;return n}translateToOutputPosition(t,e=2){let n=t;if(null!==this.injectionOffsets)for(let i=0;i<this.injectionOffsets.length&&!(t<this.injectionOffsets[i])&&(1===e||t!==this.injectionOffsets[i]);i++)n+=this.injectionOptions[i].content.length;return this.offsetInInputWithInjectionsToOutputPosition(n,e)}offsetInInputWithInjectionsToOutputPosition(t,e=2){let n=0,i=this.breakOffsets.length-1,s=0,r=0;for(;n<=i;){s=n+(i-n)/2|0;const o=this.breakOffsets[s];if(r=s>0?this.breakOffsets[s-1]:0,0===e)if(t<=r)i=s-1;else{if(!(t>o))break;n=s+1}else if(t<r)i=s-1;else{if(!(t>=o))break;n=s+1}}let o=t-r;return s>0&&(o+=this.wrappedTextIndentLength),new l(s,o)}normalizeOutputPosition(t,e,n){if(null!==this.injectionOffsets){const i=this.outputPositionToOffsetInInputWithInjections(t,e),s=this.normalizeOffsetInInputWithInjectionsAroundInjections(i,n);if(s!==i)return this.offsetInInputWithInjectionsToOutputPosition(s,n)}if(0===n){if(t>0&&e===this.getMinOutputOffset(t))return new l(t-1,this.getMaxOutputOffset(t-1))}else if(1===n){if(t<this.getOutputLineCount()-1&&e===this.getMaxOutputOffset(t))return new l(t+1,this.getMinOutputOffset(t+1))}return new l(t,e)}outputPositionToOffsetInInputWithInjections(t,e){t>0&&(e=Math.max(0,e-this.wrappedTextIndentLength));return(t>0?this.breakOffsets[t-1]:0)+e}normalizeOffsetInInputWithInjectionsAroundInjections(t,e){const n=this.getInjectedTextAtOffset(t);if(!n)return t;if(2===e){if(t===n.offsetInInputWithInjections+n.length&&a(this.injectionOptions[n.injectedTextIndex].cursorStops))return n.offsetInInputWithInjections+n.length;{let t=n.offsetInInputWithInjections;if(h(this.injectionOptions[n.injectedTextIndex].cursorStops))return t;let e=n.injectedTextIndex-1;for(;e>=0&&this.injectionOffsets[e]===this.injectionOffsets[n.injectedTextIndex]&&!a(this.injectionOptions[e].cursorStops)&&(t-=this.injectionOptions[e].content.length,!h(this.injectionOptions[e].cursorStops));)e--;return t}}if(1===e||4===e){let t=n.offsetInInputWithInjections+n.length,e=n.injectedTextIndex;for(;e+1<this.injectionOffsets.length&&this.injectionOffsets[e+1]===this.injectionOffsets[e];)t+=this.injectionOptions[e+1].content.length,e++;return t}if(0===e||3===e){let t=n.offsetInInputWithInjections,e=n.injectedTextIndex;for(;e-1>=0&&this.injectionOffsets[e-1]===this.injectionOffsets[e];)t-=this.injectionOptions[e-1].content.length,e--;return t}(0,i.vE)(e)}getInjectedText(t,e){const n=this.outputPositionToOffsetInInputWithInjections(t,e),i=this.getInjectedTextAtOffset(n);return i?{options:this.injectionOptions[i.injectedTextIndex]}:null}getInjectedTextAtOffset(t){const e=this.injectionOffsets,n=this.injectionOptions;if(null!==e){let i=0;for(let s=0;s<e.length;s++){const r=n[s].content.length,o=e[s]+i,a=e[s]+i+r;if(o>t)break;if(t<=a)return{injectedTextIndex:s,offsetInInputWithInjections:o,length:r};i+=r}}}}function a(t){return null==t||(t===r.RM.Right||t===r.RM.Both)}function h(t){return null==t||(t===r.RM.Left||t===r.RM.Both)}class l{constructor(t,e){this.outputLineIndex=t,this.outputOffset=e}toString(){return`${this.outputLineIndex}:${this.outputOffset}`}toPosition(t){return new s.L(t+this.outputLineIndex,this.outputOffset+1)}}},8243:(t,e,n)=>{n.d(e,{Q:()=>w});var i=n(9488),s=n(4669),r=n(5976),o=n(24314),a=n(19111),h=n(34302),l=n(25650),u=n(2442),c=n(35382),d=n(45035),g=n(13883),f=n(61761),k=n(6735),m=n(41574);class p extends r.JT{didLanguageChange(t){return this.brackets.didLanguageChange(t)}constructor(t,e){if(super(),this.textModel=t,this.getLanguageConfiguration=e,this.didChangeEmitter=new s.Q5,this.denseKeyProvider=new f.FE,this.brackets=new c.Z(this.denseKeyProvider,this.getLanguageConfiguration),this.onDidChange=this.didChangeEmitter.event,this.queuedTextEditsForInitialAstWithoutTokens=[],this.queuedTextEdits=[],t.tokenization.hasTokens)2===t.tokenization.backgroundTokenizationState?(this.initialAstWithoutTokens=void 0,this.astWithTokens=this.parseDocumentFromTextBuffer([],void 0,!1)):(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer([],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens);else{const t=this.brackets.getSingleLanguageBracketTokens(this.textModel.getLanguageId()),e=new k.g(this.textModel.getValue(),t);this.initialAstWithoutTokens=(0,g.w)(e,[],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens}}handleDidChangeBackgroundTokenizationState(){if(2===this.textModel.tokenization.backgroundTokenizationState){const t=void 0===this.initialAstWithoutTokens;this.initialAstWithoutTokens=void 0,t||this.didChangeEmitter.fire()}}handleDidChangeTokens({ranges:t}){const e=t.map((t=>new u.Q((0,d.Hg)(t.fromLineNumber-1,0),(0,d.Hg)(t.toLineNumber,0),(0,d.Hg)(t.toLineNumber-t.fromLineNumber+1,0))));this.handleEdits(e,!0),this.initialAstWithoutTokens||this.didChangeEmitter.fire()}handleContentChanged(t){const e=u.Q.fromModelContentChanges(t.changes);this.handleEdits(e,!1)}handleEdits(t,e){const n=(0,m.o)(this.queuedTextEdits,t);this.queuedTextEdits=n,this.initialAstWithoutTokens&&!e&&(this.queuedTextEditsForInitialAstWithoutTokens=(0,m.o)(this.queuedTextEditsForInitialAstWithoutTokens,t))}flushQueue(){this.queuedTextEdits.length>0&&(this.astWithTokens=this.parseDocumentFromTextBuffer(this.queuedTextEdits,this.astWithTokens,!1),this.queuedTextEdits=[]),this.queuedTextEditsForInitialAstWithoutTokens.length>0&&(this.initialAstWithoutTokens&&(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer(this.queuedTextEditsForInitialAstWithoutTokens,this.initialAstWithoutTokens,!1)),this.queuedTextEditsForInitialAstWithoutTokens=[])}parseDocumentFromTextBuffer(t,e,n){const i=e,s=new k.xH(this.textModel,this.brackets);return(0,g.w)(s,t,i,n)}getBracketsInRange(t,e){this.flushQueue();const n=(0,d.Hg)(t.startLineNumber-1,t.startColumn-1),s=(0,d.Hg)(t.endLineNumber-1,t.endColumn-1);return new i.W$((t=>{const i=this.initialAstWithoutTokens||this.astWithTokens;x(i,d.xl,i.length,n,s,t,0,0,new Map,e)}))}getBracketPairsInRange(t,e){this.flushQueue();const n=(0,d.PZ)(t.getStartPosition()),s=(0,d.PZ)(t.getEndPosition());return new i.W$((t=>{const i=this.initialAstWithoutTokens||this.astWithTokens,r=new O(t,e,this.textModel);T(i,d.xl,i.length,n,s,r,0,new Map)}))}getFirstBracketAfter(t){this.flushQueue();const e=this.initialAstWithoutTokens||this.astWithTokens;return I(e,d.xl,e.length,(0,d.PZ)(t))}getFirstBracketBefore(t){this.flushQueue();const e=this.initialAstWithoutTokens||this.astWithTokens;return C(e,d.xl,e.length,(0,d.PZ)(t))}}function C(t,e,n,i){if(4===t.kind||2===t.kind){const s=[];for(const i of t.children)n=(0,d.Ii)(e,i.length),s.push({nodeOffsetStart:e,nodeOffsetEnd:n}),e=n;for(let e=s.length-1;e>=0;e--){const{nodeOffsetStart:n,nodeOffsetEnd:r}=s[e];if((0,d.VR)(n,i)){const s=C(t.children[e],n,r,i);if(s)return s}}return null}if(3===t.kind)return null;if(1===t.kind){const i=(0,d.Qw)(e,n);return{bracketInfo:t.bracketInfo,range:i}}return null}function I(t,e,n,i){if(4===t.kind||2===t.kind){for(const s of t.children){if(n=(0,d.Ii)(e,s.length),(0,d.VR)(i,n)){const t=I(s,e,n,i);if(t)return t}e=n}return null}if(3===t.kind)return null;if(1===t.kind){const i=(0,d.Qw)(e,n);return{bracketInfo:t.bracketInfo,range:i}}return null}function x(t,e,n,i,s,r,o,a,h,u,c=!1){if(o>200)return!0;t:for(;;)switch(t.kind){case 4:{const a=t.childrenLength;for(let l=0;l<a;l++){const a=t.getChild(l);if(a){if(n=(0,d.Ii)(e,a.length),(0,d.By)(e,s)&&(0,d.Zq)(n,i)){if((0,d.Zq)(n,s)){t=a;continue t}if(!x(a,e,n,i,s,r,o,0,h,u))return!1}e=n}}return!0}case 2:{const l=!u||!t.closingBracket||t.closingBracket.bracketInfo.closesColorized(t.openingBracket.bracketInfo);let c=0;if(h){let e=h.get(t.openingBracket.text);void 0===e&&(e=0),c=e,l&&(e++,h.set(t.openingBracket.text,e))}const g=t.childrenLength;for(let f=0;f<g;f++){const g=t.getChild(f);if(g){if(n=(0,d.Ii)(e,g.length),(0,d.By)(e,s)&&(0,d.Zq)(n,i)){if((0,d.Zq)(n,s)&&1!==g.kind){t=g,l?(o++,a=c+1):a=c;continue t}if(l||1!==g.kind||!t.closingBracket){if(!x(g,e,n,i,s,r,l?o+1:o,l?c+1:c,h,u,!t.closingBracket))return!1}}e=n}}return null==h||h.set(t.openingBracket.text,c),!0}case 3:{const t=(0,d.Qw)(e,n);return r(new l.M$(t,o-1,0,!0))}case 1:{const t=(0,d.Qw)(e,n);return r(new l.M$(t,o-1,a-1,c))}case 0:return!0}}class O{constructor(t,e,n){this.push=t,this.includeMinIndentation=e,this.textModel=n}}function T(t,e,n,i,s,r,o,a){var h;if(o>200)return!0;let u=!0;if(2===t.kind){let c=0;if(a){let e=a.get(t.openingBracket.text);void 0===e&&(e=0),c=e,e++,a.set(t.openingBracket.text,e)}const g=(0,d.Ii)(e,t.openingBracket.length);let f=-1;if(r.includeMinIndentation&&(f=t.computeMinIndentation(e,r.textModel)),u=r.push(new l.YA((0,d.Qw)(e,n),(0,d.Qw)(e,g),t.closingBracket?(0,d.Qw)((0,d.Ii)(g,(null===(h=t.child)||void 0===h?void 0:h.length)||d.xl),n):void 0,o,c,t,f)),e=g,u&&t.child){const h=t.child;if(n=(0,d.Ii)(e,h.length),(0,d.By)(e,s)&&(0,d.Zq)(n,i)&&(u=T(h,e,n,i,s,r,o+1,a),!u))return!1}null==a||a.set(t.openingBracket.text,c)}else{let n=e;for(const e of t.children){const t=n;if(n=(0,d.Ii)(n,e.length),(0,d.By)(t,s)&&(0,d.By)(i,n)&&(u=T(e,t,n,i,s,r,o,a),!u))return!1}}return u}class w extends r.JT{get canBuildAST(){return this.textModel.getValueLength()<=5e6}constructor(t,e){super(),this.textModel=t,this.languageConfigurationService=e,this.bracketPairsTree=this._register(new r.XK),this.onDidChangeEmitter=new s.Q5,this.onDidChange=this.onDidChangeEmitter.event,this.bracketsRequested=!1,this._register(this.languageConfigurationService.onDidChange((t=>{var e;t.languageId&&!(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.didLanguageChange(t.languageId))||(this.bracketPairsTree.clear(),this.updateBracketPairsTree())})))}handleDidChangeOptions(t){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeLanguage(t){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeContent(t){var e;null===(e=this.bracketPairsTree.value)||void 0===e||e.object.handleContentChanged(t)}handleDidChangeBackgroundTokenizationState(){var t;null===(t=this.bracketPairsTree.value)||void 0===t||t.object.handleDidChangeBackgroundTokenizationState()}handleDidChangeTokens(t){var e;null===(e=this.bracketPairsTree.value)||void 0===e||e.object.handleDidChangeTokens(t)}updateBracketPairsTree(){if(this.bracketsRequested&&this.canBuildAST){if(!this.bracketPairsTree.value){const n=new r.SL;this.bracketPairsTree.value=(t=n.add(new p(this.textModel,(t=>this.languageConfigurationService.getLanguageConfiguration(t)))),e=n,{object:t,dispose:()=>null==e?void 0:e.dispose()}),n.add(this.bracketPairsTree.value.object.onDidChange((t=>this.onDidChangeEmitter.fire(t)))),this.onDidChangeEmitter.fire()}}else this.bracketPairsTree.value&&(this.bracketPairsTree.clear(),this.onDidChangeEmitter.fire());var t,e}getBracketPairsInRange(t){var e;return this.bracketsRequested=!0,this.updateBracketPairsTree(),(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.getBracketPairsInRange(t,!1))||i.W$.empty}getBracketPairsInRangeWithMinIndentation(t){var e;return this.bracketsRequested=!0,this.updateBracketPairsTree(),(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.getBracketPairsInRange(t,!0))||i.W$.empty}getBracketsInRange(t,e=!1){var n;return this.bracketsRequested=!0,this.updateBracketPairsTree(),(null===(n=this.bracketPairsTree.value)||void 0===n?void 0:n.object.getBracketsInRange(t,e))||i.W$.empty}findMatchingBracketUp(t,e,n){const i=this.textModel.validatePosition(e),s=this.textModel.getLanguageIdAtPosition(i.lineNumber,i.column);if(this.canBuildAST){const n=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew.getClosingBracketInfo(t);if(!n)return null;const i=this.getBracketPairsInRange(o.e.fromPositions(e,e)).findLast((t=>n.closes(t.openingBracketInfo)));return i?i.openingBracketRange:null}{const e=t.toLowerCase(),r=this.languageConfigurationService.getLanguageConfiguration(s).brackets;if(!r)return null;const o=r.textIsBracket[e];return o?L(this._findMatchingBracketUp(o,i,B(n))):null}}matchBracket(t,e){if(this.canBuildAST){const e=this.getBracketPairsInRange(o.e.fromPositions(t,t)).filter((e=>void 0!==e.closingBracketRange&&(e.openingBracketRange.containsPosition(t)||e.closingBracketRange.containsPosition(t)))).findLastMaxBy((0,i.tT)((e=>e.openingBracketRange.containsPosition(t)?e.openingBracketRange:e.closingBracketRange),o.e.compareRangesUsingStarts));return e?[e.openingBracketRange,e.closingBracketRange]:null}{const n=B(e);return this._matchBracket(this.textModel.validatePosition(t),n)}}_establishBracketSearchOffsets(t,e,n,i){const s=e.getCount(),r=e.getLanguageId(i);let o=Math.max(0,t.column-1-n.maxBracketLength);for(let t=i-1;t>=0;t--){const n=e.getEndOffset(t);if(n<=o)break;if((0,a.Bu)(e.getStandardTokenType(t))||e.getLanguageId(t)!==r){o=n;break}}let h=Math.min(e.getLineContent().length,t.column-1+n.maxBracketLength);for(let t=i+1;t<s;t++){const n=e.getStartOffset(t);if(n>=h)break;if((0,a.Bu)(e.getStandardTokenType(t))||e.getLanguageId(t)!==r){h=n;break}}return{searchStartOffset:o,searchEndOffset:h}}_matchBracket(t,e){const n=t.lineNumber,i=this.textModel.tokenization.getLineTokens(n),s=this.textModel.getLineContent(n),r=i.findTokenIndexAtOffset(t.column-1);if(r<0)return null;const o=this.languageConfigurationService.getLanguageConfiguration(i.getLanguageId(r)).brackets;if(o&&!(0,a.Bu)(i.getStandardTokenType(r))){let{searchStartOffset:a,searchEndOffset:l}=this._establishBracketSearchOffsets(t,i,o,r),u=null;for(;;){const i=h.Vr.findNextBracketInRange(o.forwardRegex,n,s,a,l);if(!i)break;if(i.startColumn<=t.column&&t.column<=i.endColumn){const t=s.substring(i.startColumn-1,i.endColumn-1).toLowerCase(),n=this._matchFoundBracket(i,o.textIsBracket[t],o.textIsOpenBracket[t],e);if(n){if(n instanceof b)return null;u=n}}a=i.endColumn-1}if(u)return u}if(r>0&&i.getStartOffset(r)===t.column-1){const o=r-1,l=this.languageConfigurationService.getLanguageConfiguration(i.getLanguageId(o)).brackets;if(l&&!(0,a.Bu)(i.getStandardTokenType(o))){const{searchStartOffset:r,searchEndOffset:a}=this._establishBracketSearchOffsets(t,i,l,o),u=h.Vr.findPrevBracketInRange(l.reversedRegex,n,s,r,a);if(u&&u.startColumn<=t.column&&t.column<=u.endColumn){const t=s.substring(u.startColumn-1,u.endColumn-1).toLowerCase(),n=this._matchFoundBracket(u,l.textIsBracket[t],l.textIsOpenBracket[t],e);if(n)return n instanceof b?null:n}}}return null}_matchFoundBracket(t,e,n,i){if(!e)return null;const s=n?this._findMatchingBracketDown(e,t.getEndPosition(),i):this._findMatchingBracketUp(e,t.getStartPosition(),i);return s?s instanceof b?s:[t,s]:null}_findMatchingBracketUp(t,e,n){const i=t.languageId,s=t.reversedRegex;let r=-1,o=0;const l=(e,i,a,l)=>{for(;;){if(n&&++o%100==0&&!n())return b.INSTANCE;const u=h.Vr.findPrevBracketInRange(s,e,i,a,l);if(!u)break;const c=i.substring(u.startColumn-1,u.endColumn-1).toLowerCase();if(t.isOpen(c)?r++:t.isClose(c)&&r--,0===r)return u;l=u.startColumn-1}return null};for(let t=e.lineNumber;t>=1;t--){const n=this.textModel.tokenization.getLineTokens(t),s=n.getCount(),r=this.textModel.getLineContent(t);let o=s-1,h=r.length,u=r.length;t===e.lineNumber&&(o=n.findTokenIndexAtOffset(e.column-1),h=e.column-1,u=e.column-1);let c=!0;for(;o>=0;o--){const e=n.getLanguageId(o)===i&&!(0,a.Bu)(n.getStandardTokenType(o));if(e)c?h=n.getStartOffset(o):(h=n.getStartOffset(o),u=n.getEndOffset(o));else if(c&&h!==u){const e=l(t,r,h,u);if(e)return e}c=e}if(c&&h!==u){const e=l(t,r,h,u);if(e)return e}}return null}_findMatchingBracketDown(t,e,n){const i=t.languageId,s=t.forwardRegex;let r=1,o=0;const l=(e,i,a,l)=>{for(;;){if(n&&++o%100==0&&!n())return b.INSTANCE;const u=h.Vr.findNextBracketInRange(s,e,i,a,l);if(!u)break;const c=i.substring(u.startColumn-1,u.endColumn-1).toLowerCase();if(t.isOpen(c)?r++:t.isClose(c)&&r--,0===r)return u;a=u.endColumn-1}return null},u=this.textModel.getLineCount();for(let t=e.lineNumber;t<=u;t++){const n=this.textModel.tokenization.getLineTokens(t),s=n.getCount(),r=this.textModel.getLineContent(t);let o=0,h=0,u=0;t===e.lineNumber&&(o=n.findTokenIndexAtOffset(e.column-1),h=e.column-1,u=e.column-1);let c=!0;for(;o<s;o++){const e=n.getLanguageId(o)===i&&!(0,a.Bu)(n.getStandardTokenType(o));if(e)c||(h=n.getStartOffset(o)),u=n.getEndOffset(o);else if(c&&h!==u){const e=l(t,r,h,u);if(e)return e}c=e}if(c&&h!==u){const e=l(t,r,h,u);if(e)return e}}return null}findPrevBracket(t){var e;const n=this.textModel.validatePosition(t);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.getFirstBracketBefore(n))||null;let i=null,s=null,r=null;for(let t=n.lineNumber;t>=1;t--){const e=this.textModel.tokenization.getLineTokens(t),o=e.getCount(),l=this.textModel.getLineContent(t);let u=o-1,c=l.length,d=l.length;if(t===n.lineNumber){u=e.findTokenIndexAtOffset(n.column-1),c=n.column-1,d=n.column-1;const t=e.getLanguageId(u);i!==t&&(i=t,s=this.languageConfigurationService.getLanguageConfiguration(i).brackets,r=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew)}let g=!0;for(;u>=0;u--){const n=e.getLanguageId(u);if(i!==n){if(s&&r&&g&&c!==d){const e=h.Vr.findPrevBracketInRange(s.reversedRegex,t,l,c,d);if(e)return this._toFoundBracket(r,e);g=!1}i=n,s=this.languageConfigurationService.getLanguageConfiguration(i).brackets,r=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew}const o=!!s&&!(0,a.Bu)(e.getStandardTokenType(u));if(o)g?c=e.getStartOffset(u):(c=e.getStartOffset(u),d=e.getEndOffset(u));else if(r&&s&&g&&c!==d){const e=h.Vr.findPrevBracketInRange(s.reversedRegex,t,l,c,d);if(e)return this._toFoundBracket(r,e)}g=o}if(r&&s&&g&&c!==d){const e=h.Vr.findPrevBracketInRange(s.reversedRegex,t,l,c,d);if(e)return this._toFoundBracket(r,e)}}return null}findNextBracket(t){var e;const n=this.textModel.validatePosition(t);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.getFirstBracketAfter(n))||null;const i=this.textModel.getLineCount();let s=null,r=null,o=null;for(let t=n.lineNumber;t<=i;t++){const e=this.textModel.tokenization.getLineTokens(t),i=e.getCount(),l=this.textModel.getLineContent(t);let u=0,c=0,d=0;if(t===n.lineNumber){u=e.findTokenIndexAtOffset(n.column-1),c=n.column-1,d=n.column-1;const t=e.getLanguageId(u);s!==t&&(s=t,r=this.languageConfigurationService.getLanguageConfiguration(s).brackets,o=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew)}let g=!0;for(;u<i;u++){const n=e.getLanguageId(u);if(s!==n){if(o&&r&&g&&c!==d){const e=h.Vr.findNextBracketInRange(r.forwardRegex,t,l,c,d);if(e)return this._toFoundBracket(o,e);g=!1}s=n,r=this.languageConfigurationService.getLanguageConfiguration(s).brackets,o=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew}const i=!!r&&!(0,a.Bu)(e.getStandardTokenType(u));if(i)g||(c=e.getStartOffset(u)),d=e.getEndOffset(u);else if(o&&r&&g&&c!==d){const e=h.Vr.findNextBracketInRange(r.forwardRegex,t,l,c,d);if(e)return this._toFoundBracket(o,e)}g=i}if(o&&r&&g&&c!==d){const e=h.Vr.findNextBracketInRange(r.forwardRegex,t,l,c,d);if(e)return this._toFoundBracket(o,e)}}return null}findEnclosingBrackets(t,e){const n=this.textModel.validatePosition(t);if(this.canBuildAST){const t=o.e.fromPositions(n),e=this.getBracketPairsInRange(o.e.fromPositions(n,n)).findLast((e=>void 0!==e.closingBracketRange&&e.range.strictContainsRange(t)));return e?[e.openingBracketRange,e.closingBracketRange]:null}const i=B(e),s=this.textModel.getLineCount(),r=new Map;let l=[];const u=(t,e)=>{if(!r.has(t)){const n=[];for(let t=0,i=e?e.brackets.length:0;t<i;t++)n[t]=0;r.set(t,n)}l=r.get(t)};let c=0;const d=(t,e,n,s,r)=>{for(;;){if(i&&++c%100==0&&!i())return b.INSTANCE;const o=h.Vr.findNextBracketInRange(t.forwardRegex,e,n,s,r);if(!o)break;const a=n.substring(o.startColumn-1,o.endColumn-1).toLowerCase(),u=t.textIsBracket[a];if(u&&(u.isOpen(a)?l[u.index]++:u.isClose(a)&&l[u.index]--,-1===l[u.index]))return this._matchFoundBracket(o,u,!1,i);s=o.endColumn-1}return null};let g=null,f=null;for(let t=n.lineNumber;t<=s;t++){const e=this.textModel.tokenization.getLineTokens(t),i=e.getCount(),s=this.textModel.getLineContent(t);let r=0,o=0,h=0;if(t===n.lineNumber){r=e.findTokenIndexAtOffset(n.column-1),o=n.column-1,h=n.column-1;const t=e.getLanguageId(r);g!==t&&(g=t,f=this.languageConfigurationService.getLanguageConfiguration(g).brackets,u(g,f))}let l=!0;for(;r<i;r++){const n=e.getLanguageId(r);if(g!==n){if(f&&l&&o!==h){const e=d(f,t,s,o,h);if(e)return L(e);l=!1}g=n,f=this.languageConfigurationService.getLanguageConfiguration(g).brackets,u(g,f)}const i=!!f&&!(0,a.Bu)(e.getStandardTokenType(r));if(i)l||(o=e.getStartOffset(r)),h=e.getEndOffset(r);else if(f&&l&&o!==h){const e=d(f,t,s,o,h);if(e)return L(e)}l=i}if(f&&l&&o!==h){const e=d(f,t,s,o,h);if(e)return L(e)}}return null}_toFoundBracket(t,e){if(!e)return null;let n=this.textModel.getValueInRange(e);n=n.toLowerCase();const i=t.getBracketInfo(n);return i?{range:e,bracketInfo:i}:null}}function B(t){if(void 0===t)return()=>!0;{const e=Date.now();return()=>Date.now()-e<=t}}class b{constructor(){this._searchCanceledBrand=void 0}}function L(t){return t instanceof b?null:t}b.INSTANCE=new b},41720:(t,e,n)=>{n.d(e,{BH:()=>m,Dm:()=>C,Kd:()=>h,Y0:()=>l,n2:()=>p});var i=n(17301),s=n(7988),r=n(45035),o=n(61761);class a{get length(){return this._length}constructor(t){this._length=t}}class h extends a{static create(t,e,n){let i=t.length;return e&&(i=(0,r.Ii)(i,e.length)),n&&(i=(0,r.Ii)(i,n.length)),new h(i,t,e,n,e?e.missingOpeningBracketIds:o.tS.getEmpty())}get kind(){return 2}get listHeight(){return 0}get childrenLength(){return 3}getChild(t){switch(t){case 0:return this.openingBracket;case 1:return this.child;case 2:return this.closingBracket}throw new Error("Invalid child index")}get children(){const t=[];return t.push(this.openingBracket),this.child&&t.push(this.child),this.closingBracket&&t.push(this.closingBracket),t}constructor(t,e,n,i,s){super(t),this.openingBracket=e,this.child=n,this.closingBracket=i,this.missingOpeningBracketIds=s}canBeReused(t){return null!==this.closingBracket&&!t.intersects(this.missingOpeningBracketIds)}deepClone(){return new h(this.length,this.openingBracket.deepClone(),this.child&&this.child.deepClone(),this.closingBracket&&this.closingBracket.deepClone(),this.missingOpeningBracketIds)}computeMinIndentation(t,e){return this.child?this.child.computeMinIndentation((0,r.Ii)(t,this.openingBracket.length),e):Number.MAX_SAFE_INTEGER}}class l extends a{static create23(t,e,n,i=!1){let s=t.length,o=t.missingOpeningBracketIds;if(t.listHeight!==e.listHeight)throw new Error("Invalid list heights");if(s=(0,r.Ii)(s,e.length),o=o.merge(e.missingOpeningBracketIds),n){if(t.listHeight!==n.listHeight)throw new Error("Invalid list heights");s=(0,r.Ii)(s,n.length),o=o.merge(n.missingOpeningBracketIds)}return i?new c(s,t.listHeight+1,t,e,n,o):new u(s,t.listHeight+1,t,e,n,o)}static getEmpty(){return new g(r.xl,0,[],o.tS.getEmpty())}get kind(){return 4}get missingOpeningBracketIds(){return this._missingOpeningBracketIds}constructor(t,e,n){super(t),this.listHeight=e,this._missingOpeningBracketIds=n,this.cachedMinIndentation=-1}throwIfImmutable(){}makeLastElementMutable(){this.throwIfImmutable();const t=this.childrenLength;if(0===t)return;const e=this.getChild(t-1),n=4===e.kind?e.toMutable():e;return e!==n&&this.setChild(t-1,n),n}makeFirstElementMutable(){this.throwIfImmutable();if(0===this.childrenLength)return;const t=this.getChild(0),e=4===t.kind?t.toMutable():t;return t!==e&&this.setChild(0,e),e}canBeReused(t){if(t.intersects(this.missingOpeningBracketIds))return!1;if(0===this.childrenLength)return!1;let e=this;for(;4===e.kind;){const t=e.childrenLength;if(0===t)throw new i.he;e=e.getChild(t-1)}return e.canBeReused(t)}handleChildrenChanged(){this.throwIfImmutable();const t=this.childrenLength;let e=this.getChild(0).length,n=this.getChild(0).missingOpeningBracketIds;for(let i=1;i<t;i++){const t=this.getChild(i);e=(0,r.Ii)(e,t.length),n=n.merge(t.missingOpeningBracketIds)}this._length=e,this._missingOpeningBracketIds=n,this.cachedMinIndentation=-1}computeMinIndentation(t,e){if(-1!==this.cachedMinIndentation)return this.cachedMinIndentation;let n=Number.MAX_SAFE_INTEGER,i=t;for(let t=0;t<this.childrenLength;t++){const s=this.getChild(t);s&&(n=Math.min(n,s.computeMinIndentation(i,e)),i=(0,r.Ii)(i,s.length))}return this.cachedMinIndentation=n,n}}class u extends l{get childrenLength(){return null!==this._item3?3:2}getChild(t){switch(t){case 0:return this._item1;case 1:return this._item2;case 2:return this._item3}throw new Error("Invalid child index")}setChild(t,e){switch(t){case 0:return void(this._item1=e);case 1:return void(this._item2=e);case 2:return void(this._item3=e)}throw new Error("Invalid child index")}get children(){return this._item3?[this._item1,this._item2,this._item3]:[this._item1,this._item2]}get item1(){return this._item1}get item2(){return this._item2}get item3(){return this._item3}constructor(t,e,n,i,s,r){super(t,e,r),this._item1=n,this._item2=i,this._item3=s}deepClone(){return new u(this.length,this.listHeight,this._item1.deepClone(),this._item2.deepClone(),this._item3?this._item3.deepClone():null,this.missingOpeningBracketIds)}appendChildOfSameHeight(t){if(this._item3)throw new Error("Cannot append to a full (2,3) tree node");this.throwIfImmutable(),this._item3=t,this.handleChildrenChanged()}unappendChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const t=this._item3;return this._item3=null,this.handleChildrenChanged(),t}prependChildOfSameHeight(t){if(this._item3)throw new Error("Cannot prepend to a full (2,3) tree node");this.throwIfImmutable(),this._item3=this._item2,this._item2=this._item1,this._item1=t,this.handleChildrenChanged()}unprependChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const t=this._item1;return this._item1=this._item2,this._item2=this._item3,this._item3=null,this.handleChildrenChanged(),t}toMutable(){return this}}class c extends u{toMutable(){return new u(this.length,this.listHeight,this.item1,this.item2,this.item3,this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}class d extends l{get childrenLength(){return this._children.length}getChild(t){return this._children[t]}setChild(t,e){this._children[t]=e}get children(){return this._children}constructor(t,e,n,i){super(t,e,i),this._children=n}deepClone(){const t=new Array(this._children.length);for(let e=0;e<this._children.length;e++)t[e]=this._children[e].deepClone();return new d(this.length,this.listHeight,t,this.missingOpeningBracketIds)}appendChildOfSameHeight(t){this.throwIfImmutable(),this._children.push(t),this.handleChildrenChanged()}unappendChild(){this.throwIfImmutable();const t=this._children.pop();return this.handleChildrenChanged(),t}prependChildOfSameHeight(t){this.throwIfImmutable(),this._children.unshift(t),this.handleChildrenChanged()}unprependChild(){this.throwIfImmutable();const t=this._children.shift();return this.handleChildrenChanged(),t}toMutable(){return this}}class g extends d{toMutable(){return new d(this.length,this.listHeight,[...this.children],this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}const f=[];class k extends a{get listHeight(){return 0}get childrenLength(){return 0}getChild(t){return null}get children(){return f}deepClone(){return this}}class m extends k{get kind(){return 0}get missingOpeningBracketIds(){return o.tS.getEmpty()}canBeReused(t){return!0}computeMinIndentation(t,e){const n=(0,r.Hw)(t),i=(0===n.columnCount?n.lineCount:n.lineCount+1)+1,o=(0,r.W9)((0,r.Ii)(t,this.length))+1;let a=Number.MAX_SAFE_INTEGER;for(let t=i;t<=o;t++){const n=e.getLineFirstNonWhitespaceColumn(t),i=e.getLineContent(t);if(0===n)continue;const r=s.i.visibleColumnFromColumn(i,n,e.getOptions().tabSize);a=Math.min(a,r)}return a}}class p extends k{static create(t,e,n){return new p(t,e,n)}get kind(){return 1}get missingOpeningBracketIds(){return o.tS.getEmpty()}constructor(t,e,n){super(t),this.bracketInfo=e,this.bracketIds=n}get text(){return this.bracketInfo.bracketText}get languageId(){return this.bracketInfo.languageId}canBeReused(t){return!1}computeMinIndentation(t,e){return Number.MAX_SAFE_INTEGER}}class C extends k{get kind(){return 3}constructor(t,e){super(e),this.missingOpeningBracketIds=t}canBeReused(t){return!t.intersects(this.missingOpeningBracketIds)}computeMinIndentation(t,e){return Number.MAX_SAFE_INTEGER}}},2442:(t,e,n)=>{n.d(e,{Q:()=>r,Y:()=>o});var i=n(24314),s=n(45035);class r{static fromModelContentChanges(t){return t.map((t=>{const e=i.e.lift(t.range);return new r((0,s.PZ)(e.getStartPosition()),(0,s.PZ)(e.getEndPosition()),(0,s.oR)(t.text))})).reverse()}constructor(t,e,n){this.startOffset=t,this.endOffset=e,this.newLength=n}toString(){return`[${(0,s.Hw)(this.startOffset)}...${(0,s.Hw)(this.endOffset)}) -> ${(0,s.Hw)(this.newLength)}`}}class o{constructor(t){this.nextEditIdx=0,this.deltaOldToNewLineCount=0,this.deltaOldToNewColumnCount=0,this.deltaLineIdxInOld=-1,this.edits=t.map((t=>a.from(t)))}getOffsetBeforeChange(t){return this.adjustNextEdit(t),this.translateCurToOld(t)}getDistanceToNextChange(t){this.adjustNextEdit(t);const e=this.edits[this.nextEditIdx],n=e?this.translateOldToCur(e.offsetObj):null;return null===n?null:(0,s.BE)(t,n)}translateOldToCur(t){return t.lineCount===this.deltaLineIdxInOld?(0,s.Hg)(t.lineCount+this.deltaOldToNewLineCount,t.columnCount+this.deltaOldToNewColumnCount):(0,s.Hg)(t.lineCount+this.deltaOldToNewLineCount,t.columnCount)}translateCurToOld(t){const e=(0,s.Hw)(t);return e.lineCount-this.deltaOldToNewLineCount===this.deltaLineIdxInOld?(0,s.Hg)(e.lineCount-this.deltaOldToNewLineCount,e.columnCount-this.deltaOldToNewColumnCount):(0,s.Hg)(e.lineCount-this.deltaOldToNewLineCount,e.columnCount)}adjustNextEdit(t){for(;this.nextEditIdx<this.edits.length;){const e=this.edits[this.nextEditIdx],n=this.translateOldToCur(e.endOffsetAfterObj);if(!(0,s.By)(n,t))break;{this.nextEditIdx++;const t=(0,s.Hw)(n),i=(0,s.Hw)(this.translateOldToCur(e.endOffsetBeforeObj)),r=t.lineCount-i.lineCount;this.deltaOldToNewLineCount+=r;const o=this.deltaLineIdxInOld===e.endOffsetBeforeObj.lineCount?this.deltaOldToNewColumnCount:0,a=t.columnCount-i.columnCount;this.deltaOldToNewColumnCount=o+a,this.deltaLineIdxInOld=e.endOffsetBeforeObj.lineCount}}}}class a{static from(t){return new a(t.startOffset,t.endOffset,t.newLength)}constructor(t,e,n){this.endOffsetBeforeObj=(0,s.Hw)(e),this.endOffsetAfterObj=(0,s.Hw)((0,s.Ii)(t,n)),this.offsetObj=(0,s.Hw)(t)}}},35382:(t,e,n)=>{n.d(e,{Z:()=>l});var i=n(97295),s=n(41720),r=n(45035),o=n(61761),a=n(6735);class h{static createFromLanguage(t,e){function n(t){return e.getKey(`${t.languageId}:::${t.bracketText}`)}const i=new Map;for(const e of t.bracketsNew.openingBrackets){const t=(0,r.Hg)(0,e.bracketText.length),h=n(e),l=o.tS.getEmpty().add(h,o.Qw);i.set(e.bracketText,new a.WU(t,1,h,l,s.n2.create(t,e,l)))}for(const e of t.bracketsNew.closingBrackets){const t=(0,r.Hg)(0,e.bracketText.length);let h=o.tS.getEmpty();const l=e.getOpeningBrackets();for(const t of l)h=h.add(n(t),o.Qw);i.set(e.bracketText,new a.WU(t,2,n(l[0]),h,s.n2.create(t,e,h)))}return new h(i)}constructor(t){this.map=t,this.hasRegExp=!1,this._regExpGlobal=null}getRegExpStr(){if(this.isEmpty)return null;{const t=[...this.map.keys()];return t.sort(),t.reverse(),t.map((t=>function(t){let e=(0,i.ec)(t);/^[\w ]+/.test(t)&&(e=`\\b${e}`);/[\w ]+$/.test(t)&&(e=`${e}\\b`);return e}(t))).join("|")}}get regExpGlobal(){if(!this.hasRegExp){const t=this.getRegExpStr();this._regExpGlobal=t?new RegExp(t,"gi"):null,this.hasRegExp=!0}return this._regExpGlobal}getToken(t){return this.map.get(t.toLowerCase())}findClosingTokenText(t){for(const[e,n]of this.map)if(2===n.kind&&n.bracketIds.intersects(t))return e}get isEmpty(){return 0===this.map.size}}class l{constructor(t,e){this.denseKeyProvider=t,this.getLanguageConfiguration=e,this.languageIdToBracketTokens=new Map}didLanguageChange(t){return this.languageIdToBracketTokens.has(t)}getSingleLanguageBracketTokens(t){let e=this.languageIdToBracketTokens.get(t);return e||(e=h.createFromLanguage(this.getLanguageConfiguration(t),this.denseKeyProvider),this.languageIdToBracketTokens.set(t,e)),e}}},41574:(t,e,n)=>{n.d(e,{o:()=>o});var i=n(9488),s=n(2442),r=n(45035);function o(t,e){if(0===t.length)return e;if(0===e.length)return t;const n=new i.H9(h(t)),o=h(e);o.push({modified:!1,lengthBefore:void 0,lengthAfter:void 0});let l=n.dequeue();function u(t){if(void 0===t){const t=n.takeWhile((t=>!0))||[];return l&&t.unshift(l),t}const e=[];for(;l&&!(0,r.xd)(t);){const[i,s]=l.splitAt(t);e.push(i),t=(0,r.BE)(i.lengthAfter,t),l=null!=s?s:n.dequeue()}return(0,r.xd)(t)||e.push(new a(!1,t,t)),e}const c=[];function d(t,e,n){if(c.length>0&&(0,r.rM)(c[c.length-1].endOffset,t)){const t=c[c.length-1];c[c.length-1]=new s.Q(t.startOffset,e,(0,r.Ii)(t.newLength,n))}else c.push({startOffset:t,endOffset:e,newLength:n})}let g=r.xl;for(const t of o){const e=u(t.lengthBefore);if(t.modified){const n=(0,r.tQ)(e,(t=>t.lengthBefore)),i=(0,r.Ii)(g,n);d(g,i,t.lengthAfter),g=i}else for(const t of e){const e=g;g=(0,r.Ii)(g,t.lengthBefore),t.modified&&d(e,g,t.lengthAfter)}}return c}class a{constructor(t,e,n){this.modified=t,this.lengthBefore=e,this.lengthAfter=n}splitAt(t){const e=(0,r.BE)(t,this.lengthAfter);return(0,r.rM)(e,r.xl)?[this,void 0]:this.modified?[new a(this.modified,this.lengthBefore,t),new a(this.modified,r.xl,e)]:[new a(this.modified,t,t),new a(this.modified,e,e)]}toString(){return`${this.modified?"M":"U"}:${(0,r.Hw)(this.lengthBefore)} -> ${(0,r.Hw)(this.lengthAfter)}`}}function h(t){const e=[];let n=r.xl;for(const i of t){const t=(0,r.BE)(n,i.startOffset);(0,r.xd)(t)||e.push(new a(!1,t,t));const s=(0,r.BE)(i.startOffset,i.endOffset);e.push(new a(!0,s,i.newLength)),n=i.endOffset}return e}},45035:(t,e,n)=>{n.d(e,{BE:()=>p,By:()=>I,F_:()=>g,Hg:()=>u,Hw:()=>c,Ii:()=>f,PZ:()=>O,Qw:()=>T,VR:()=>C,W9:()=>d,Zq:()=>x,av:()=>o,oR:()=>w,rM:()=>m,tQ:()=>k,xd:()=>h,xl:()=>a});var i=n(97295),s=n(24314),r=n(59722);function o(t,e,n,i){return t!==n?u(n-t,i):u(0,i-e)}const a=0;function h(t){return 0===t}const l=2**26;function u(t,e){return t*l+e}function c(t){const e=t,n=Math.floor(e/l),i=e-n*l;return new r.A(n,i)}function d(t){return Math.floor(t/l)}function g(t){return t}function f(t,e){let n=t+e;return e>=l&&(n-=t%l),n}function k(t,e){return t.reduce(((t,n)=>f(t,e(n))),a)}function m(t,e){return t===e}function p(t,e){const n=t,i=e;if(i-n<=0)return a;const s=Math.floor(n/l),r=Math.floor(i/l),o=i-r*l;if(s===r){return u(0,o-(n-s*l))}return u(r-s,o)}function C(t,e){return t<e}function I(t,e){return t<=e}function x(t,e){return t>=e}function O(t){return u(t.lineNumber-1,t.column-1)}function T(t,e){const n=t,i=Math.floor(n/l),r=n-i*l,o=e,a=Math.floor(o/l),h=o-a*l;return new s.e(i+1,r+1,a+1,h+1)}function w(t){const e=(0,i.uq)(t);return u(e.length-1,e[e.length-1].length)}},13883:(t,e,n)=>{n.d(e,{w:()=>g});var i=n(41720),s=n(2442),r=n(61761),o=n(45035);function a(t,e=!1){if(0===t.length)return null;if(1===t.length)return t[0];let n=t.length;for(;n>3;){const s=n>>1;for(let r=0;r<s;r++){const s=r<<1;t[r]=i.Y0.create23(t[s],t[s+1],s+3===n?t[s+2]:null,e)}n=s}return i.Y0.create23(t[0],t[1],n>=3?t[2]:null,e)}function h(t,e){return Math.abs(t.listHeight-e.listHeight)}function l(t,e){return t.listHeight===e.listHeight?i.Y0.create23(t,e,null,!1):t.listHeight>e.listHeight?function(t,e){let n=t=t.toMutable();const s=[];let r;for(;;){if(e.listHeight===n.listHeight){r=e;break}if(4!==n.kind)throw new Error("unexpected");s.push(n),n=n.makeLastElementMutable()}for(let t=s.length-1;t>=0;t--){const e=s[t];r?e.childrenLength>=3?r=i.Y0.create23(e.unappendChild(),r,null,!1):(e.appendChildOfSameHeight(r),r=void 0):e.handleChildrenChanged()}return r?i.Y0.create23(t,r,null,!1):t}(t,e):function(t,e){let n=t=t.toMutable();const s=[];for(;e.listHeight!==n.listHeight;){if(4!==n.kind)throw new Error("unexpected");s.push(n),n=n.makeFirstElementMutable()}let r=e;for(let t=s.length-1;t>=0;t--){const e=s[t];r?e.childrenLength>=3?r=i.Y0.create23(r,e.unprependChild(),null,!1):(e.prependChildOfSameHeight(r),r=void 0):e.handleChildrenChanged()}return r?i.Y0.create23(r,t,null,!1):t}(e,t)}class u{constructor(t){this.lastOffset=o.xl,this.nextNodes=[t],this.offsets=[o.xl],this.idxs=[]}readLongestNodeAt(t,e){if((0,o.VR)(t,this.lastOffset))throw new Error("Invalid offset");for(this.lastOffset=t;;){const n=d(this.nextNodes);if(!n)return;const i=d(this.offsets);if((0,o.VR)(t,i))return;if((0,o.VR)(i,t))if((0,o.Ii)(i,n.length)<=t)this.nextNodeAfterCurrent();else{const t=c(n);-1!==t?(this.nextNodes.push(n.getChild(t)),this.offsets.push(i),this.idxs.push(t)):this.nextNodeAfterCurrent()}else{if(e(n))return this.nextNodeAfterCurrent(),n;{const t=c(n);if(-1===t)return void this.nextNodeAfterCurrent();this.nextNodes.push(n.getChild(t)),this.offsets.push(i),this.idxs.push(t)}}}}nextNodeAfterCurrent(){for(;;){const t=d(this.offsets),e=d(this.nextNodes);if(this.nextNodes.pop(),this.offsets.pop(),0===this.idxs.length)break;const n=d(this.nextNodes),i=c(n,this.idxs[this.idxs.length-1]);if(-1!==i){this.nextNodes.push(n.getChild(i)),this.offsets.push((0,o.Ii)(t,e.length)),this.idxs[this.idxs.length-1]=i;break}this.idxs.pop()}}}function c(t,e=-1){for(;;){if(++e>=t.childrenLength)return-1;if(t.getChild(e))return e}}function d(t){return t.length>0?t[t.length-1]:void 0}function g(t,e,n,i){return new f(t,e,n,i).parseDocument()}class f{constructor(t,e,n,i){if(this.tokenizer=t,this.createImmutableLists=i,this._itemsConstructed=0,this._itemsFromCache=0,n&&i)throw new Error("Not supported");this.oldNodeReader=n?new u(n):void 0,this.positionMapper=new s.Y(e)}parseDocument(){this._itemsConstructed=0,this._itemsFromCache=0;let t=this.parseList(r.tS.getEmpty(),0);return t||(t=i.Y0.getEmpty()),t}parseList(t,e){const n=[];for(;;){let i=this.tryReadChildFromCache(t);if(!i){const n=this.tokenizer.peek();if(!n||2===n.kind&&n.bracketIds.intersects(t))break;i=this.parseChild(t,e+1)}4===i.kind&&0===i.childrenLength||n.push(i)}const i=this.oldNodeReader?function(t){if(0===t.length)return null;if(1===t.length)return t[0];let e=0;function n(){if(e>=t.length)return null;const n=e,i=t[n].listHeight;for(e++;e<t.length&&t[e].listHeight===i;)e++;return e-n>=2?a(0===n&&e===t.length?t:t.slice(n,e),!1):t[n]}let i=n(),s=n();if(!s)return i;for(let t=n();t;t=n())h(i,s)<=h(s,t)?(i=l(i,s),s=t):s=l(s,t);return l(i,s)}(n):a(n,this.createImmutableLists);return i}tryReadChildFromCache(t){if(this.oldNodeReader){const e=this.positionMapper.getDistanceToNextChange(this.tokenizer.offset);if(null===e||!(0,o.xd)(e)){const n=this.oldNodeReader.readLongestNodeAt(this.positionMapper.getOffsetBeforeChange(this.tokenizer.offset),(n=>{if(null!==e&&!(0,o.VR)(n.length,e))return!1;return n.canBeReused(t)}));if(n)return this._itemsFromCache++,this.tokenizer.skip(n.length),n}}}parseChild(t,e){this._itemsConstructed++;const n=this.tokenizer.read();switch(n.kind){case 2:return new i.Dm(n.bracketIds,n.length);case 0:return n.astNode;case 1:{if(e>300)return new i.BH(n.length);const s=t.merge(n.bracketIds),r=this.parseList(s,e+1),o=this.tokenizer.peek();return o&&2===o.kind&&(o.bracketId===n.bracketId||o.bracketIds.intersects(n.bracketIds))?(this.tokenizer.read(),i.Kd.create(n.astNode,r,o.astNode)):i.Kd.create(n.astNode,r,null)}default:throw new Error("unexpected")}}}},61761:(t,e,n)=>{n.d(e,{FE:()=>o,Qw:()=>r,tS:()=>s});const i=[];class s{static create(t,e){if(t<=128&&0===e.length){let n=s.cache[t];return n||(n=new s(t,e),s.cache[t]=n),n}return new s(t,e)}static getEmpty(){return this.empty}constructor(t,e){this.items=t,this.additionalItems=e}add(t,e){const n=e.getKey(t);let i=n>>5;if(0===i){const t=1<<n|this.items;return t===this.items?this:s.create(t,this.additionalItems)}i--;const r=this.additionalItems.slice(0);for(;r.length<i;)r.push(0);return r[i]|=1<<(31&n),s.create(this.items,r)}merge(t){const e=this.items|t.items;if(this.additionalItems===i&&t.additionalItems===i)return e===this.items?this:e===t.items?t:s.create(e,i);const n=[];for(let e=0;e<Math.max(this.additionalItems.length,t.additionalItems.length);e++){const i=this.additionalItems[e]||0,s=t.additionalItems[e]||0;n.push(i|s)}return s.create(e,n)}intersects(t){if(this.items&t.items)return!0;for(let e=0;e<Math.min(this.additionalItems.length,t.additionalItems.length);e++)if(this.additionalItems[e]&t.additionalItems[e])return!0;return!1}}s.cache=new Array(129),s.empty=s.create(0,i);const r={getKey:t=>t};class o{constructor(){this.items=new Map}getKey(t){let e=this.items.get(t);return void 0===e&&(e=this.items.size,this.items.set(t,e)),e}}},6735:(t,e,n)=>{n.d(e,{WU:()=>h,g:()=>c,xH:()=>l});var i=n(17301),s=n(45797),r=n(41720),o=n(45035),a=n(61761);class h{constructor(t,e,n,i,s){this.length=t,this.kind=e,this.bracketId=n,this.bracketIds=i,this.astNode=s}}class l{constructor(t,e){this.textModel=t,this.bracketTokens=e,this.reader=new u(this.textModel,this.bracketTokens),this._offset=o.xl,this.didPeek=!1,this.peeked=null,this.textBufferLineCount=t.getLineCount(),this.textBufferLastLineLength=t.getLineLength(this.textBufferLineCount)}get offset(){return this._offset}get length(){return(0,o.Hg)(this.textBufferLineCount-1,this.textBufferLastLineLength)}skip(t){this.didPeek=!1,this._offset=(0,o.Ii)(this._offset,t);const e=(0,o.Hw)(this._offset);this.reader.setPosition(e.lineCount,e.columnCount)}read(){let t;return this.peeked?(this.didPeek=!1,t=this.peeked):t=this.reader.read(),t&&(this._offset=(0,o.Ii)(this._offset,t.length)),t}peek(){return this.didPeek||(this.peeked=this.reader.read(),this.didPeek=!0),this.peeked}}class u{constructor(t,e){this.textModel=t,this.bracketTokens=e,this.lineIdx=0,this.line=null,this.lineCharOffset=0,this.lineTokens=null,this.lineTokenOffset=0,this.peekedToken=null,this.textBufferLineCount=t.getLineCount(),this.textBufferLastLineLength=t.getLineLength(this.textBufferLineCount)}setPosition(t,e){t===this.lineIdx?(this.lineCharOffset=e,null!==this.line&&(this.lineTokenOffset=0===this.lineCharOffset?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset))):(this.lineIdx=t,this.lineCharOffset=e,this.line=null),this.peekedToken=null}read(){if(this.peekedToken){const t=this.peekedToken;return this.peekedToken=null,this.lineCharOffset+=(0,o.F_)(t.length),t}if(this.lineIdx>this.textBufferLineCount-1||this.lineIdx===this.textBufferLineCount-1&&this.lineCharOffset>=this.textBufferLastLineLength)return null;null===this.line&&(this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.line=this.lineTokens.getLineContent(),this.lineTokenOffset=0===this.lineCharOffset?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset));const t=this.lineIdx,e=this.lineCharOffset;let n=0;for(;;){const i=this.lineTokens,r=i.getCount();let a=null;if(this.lineTokenOffset<r){const h=i.getMetadata(this.lineTokenOffset);for(;this.lineTokenOffset+1<r&&h===i.getMetadata(this.lineTokenOffset+1);)this.lineTokenOffset++;const l=0===s.N.getTokenType(h),u=s.N.containsBalancedBrackets(h),c=i.getEndOffset(this.lineTokenOffset);if(u&&l&&this.lineCharOffset<c){const t=i.getLanguageId(this.lineTokenOffset),e=this.line.substring(this.lineCharOffset,c),n=this.bracketTokens.getSingleLanguageBracketTokens(t),s=n.regExpGlobal;if(s){s.lastIndex=0;const t=s.exec(e);t&&(a=n.getToken(t[0]),a&&(this.lineCharOffset+=t.index))}}if(n+=c-this.lineCharOffset,a){if(t!==this.lineIdx||e!==this.lineCharOffset){this.peekedToken=a;break}return this.lineCharOffset+=(0,o.F_)(a.length),a}this.lineTokenOffset++,this.lineCharOffset=c}else{if(this.lineIdx===this.textBufferLineCount-1)break;if(this.lineIdx++,this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.lineTokenOffset=0,this.line=this.lineTokens.getLineContent(),this.lineCharOffset=0,n+=33,n>1e3)break}if(n>1500)break}const i=(0,o.av)(t,e,this.lineIdx,this.lineCharOffset);return new h(i,0,-1,a.tS.getEmpty(),new r.BH(i))}}class c{constructor(t,e){this.text=t,this._offset=o.xl,this.idx=0;const n=e.getRegExpStr(),i=n?new RegExp(n+"|\n","gi"):null,s=[];let l,u=0,c=0,d=0,g=0;const f=[];for(let t=0;t<60;t++)f.push(new h((0,o.Hg)(0,t),0,-1,a.tS.getEmpty(),new r.BH((0,o.Hg)(0,t))));const k=[];for(let t=0;t<60;t++)k.push(new h((0,o.Hg)(1,t),0,-1,a.tS.getEmpty(),new r.BH((0,o.Hg)(1,t))));if(i)for(i.lastIndex=0;null!==(l=i.exec(t));){const t=l.index,n=l[0];if("\n"===n)u++,c=t+1;else{if(d!==t){let e;if(g===u){const n=t-d;if(n<f.length)e=f[n];else{const t=(0,o.Hg)(0,n);e=new h(t,0,-1,a.tS.getEmpty(),new r.BH(t))}}else{const n=u-g,i=t-c;if(1===n&&i<k.length)e=k[i];else{const t=(0,o.Hg)(n,i);e=new h(t,0,-1,a.tS.getEmpty(),new r.BH(t))}}s.push(e)}s.push(e.getToken(n)),d=t+n.length,g=u}}const m=t.length;if(d!==m){const t=g===u?(0,o.Hg)(0,m-d):(0,o.Hg)(u-g,m-c);s.push(new h(t,0,-1,a.tS.getEmpty(),new r.BH(t)))}this.length=(0,o.Hg)(u,m-c),this.tokens=s}get offset(){return this._offset}read(){return this.tokens[this.idx++]||null}peek(){return this.tokens[this.idx]||null}skip(t){throw new i.B8}}},7447:(t,e,n)=>{n.d(e,{z:()=>h});var i=n(4669),s=n(5976),r=n(24314),o=n(8625),a=n(97781);class h extends s.JT{constructor(t){super(),this.textModel=t,this.colorProvider=new l,this.onDidChangeEmitter=new i.Q5,this.onDidChange=this.onDidChangeEmitter.event,this.colorizationOptions=t.getOptions().bracketPairColorizationOptions,this._register(t.bracketPairs.onDidChange((t=>{this.onDidChangeEmitter.fire()})))}handleDidChangeOptions(t){this.colorizationOptions=this.textModel.getOptions().bracketPairColorizationOptions}getDecorationsInRange(t,e,n,i){if(i)return[];if(void 0===e)return[];if(!this.colorizationOptions.enabled)return[];return this.textModel.bracketPairs.getBracketsInRange(t,!0).map((t=>({id:`bracket${t.range.toString()}-${t.nestingLevel}`,options:{description:"BracketPairColorization",inlineClassName:this.colorProvider.getInlineClassName(t,this.colorizationOptions.independentColorPoolPerBracketType)},ownerId:0,range:t.range}))).toArray()}getAllDecorations(t,e){return void 0===t?[]:this.colorizationOptions.enabled?this.getDecorationsInRange(new r.e(1,1,this.textModel.getLineCount(),1),t,e):[]}}class l{constructor(){this.unexpectedClosingBracketClassName="unexpected-closing-bracket"}getInlineClassName(t,e){return t.isInvalid?this.unexpectedClosingBracketClassName:this.getInlineClassNameOfLevel(e?t.nestingLevelOfEqualBracketType:t.nestingLevel)}getInlineClassNameOfLevel(t){return"bracket-highlighting-"+t%30}}(0,a.Ic)(((t,e)=>{const n=[o.zJ,o.Vs,o.CE,o.UP,o.r0,o.m1],i=new l;e.addRule(`.monaco-editor .${i.unexpectedClosingBracketClassName} { color: ${t.getColor(o.ts)}; }`);const s=n.map((e=>t.getColor(e))).filter((t=>!!t)).filter((t=>!t.isTransparent()));for(let t=0;t<30;t++){const n=s[t%s.length];e.addRule(`.monaco-editor .${i.getInlineClassNameOfLevel(t)} { color: ${n}; }`)}}))},87494:(t,e,n)=>{n.d(e,{r:()=>h});var i=n(35382),s=n(45035),r=n(13883),o=n(61761),a=n(6735);function h(t,e){const n=new o.FE,h=new i.Z(n,(t=>e.getLanguageConfiguration(t))),u=new a.xH(new l([t]),h),c=(0,r.w)(u,[],void 0,!0);let d="";const g=t.getLineContent();return function t(e,n){if(2===e.kind)if(t(e.openingBracket,n),n=(0,s.Ii)(n,e.openingBracket.length),e.child&&(t(e.child,n),n=(0,s.Ii)(n,e.child.length)),e.closingBracket)t(e.closingBracket,n),n=(0,s.Ii)(n,e.closingBracket.length);else{const t=h.getSingleLanguageBracketTokens(e.openingBracket.languageId).findClosingTokenText(e.openingBracket.bracketIds);d+=t}else if(3===e.kind);else if(0===e.kind||1===e.kind)d+=g.substring((0,s.F_)(n),(0,s.F_)((0,s.Ii)(n,e.length)));else if(4===e.kind)for(const i of e.children)t(i,n),n=(0,s.Ii)(n,i.length)}(c,s.xl),d}class l{constructor(t){this.lines=t,this.tokenization={getLineTokens:t=>this.lines[t-1]}}getLineCount(){return this.lines.length}getLineLength(t){return this.lines[t-1].getLineContent().length}}},95215:(t,e,n)=>{n.d(e,{NL:()=>m,e9:()=>k});var i=n(63580),s=n(17301),r=n(3860),o=n(70666),a=n(93033),h=n(53060),l=n(95935);function u(t){return t.toString()}class c{static create(t,e){const n=t.getAlternativeVersionId(),i=f(t);return new c(n,n,i,i,e,e,[])}constructor(t,e,n,i,s,r,o){this.beforeVersionId=t,this.afterVersionId=e,this.beforeEOL=n,this.afterEOL=i,this.beforeCursorState=s,this.afterCursorState=r,this.changes=o}append(t,e,n,i,s){e.length>0&&(this.changes=(0,a.b)(this.changes,e)),this.afterEOL=n,this.afterVersionId=i,this.afterCursorState=s}static _writeSelectionsSize(t){return 4+16*(t?t.length:0)}static _writeSelections(t,e,n){if(h.T4(t,e?e.length:0,n),n+=4,e)for(const i of e)h.T4(t,i.selectionStartLineNumber,n),n+=4,h.T4(t,i.selectionStartColumn,n),n+=4,h.T4(t,i.positionLineNumber,n),n+=4,h.T4(t,i.positionColumn,n),n+=4;return n}static _readSelections(t,e,n){const i=h.Ag(t,e);e+=4;for(let s=0;s<i;s++){const i=h.Ag(t,e);e+=4;const s=h.Ag(t,e);e+=4;const o=h.Ag(t,e);e+=4;const a=h.Ag(t,e);e+=4,n.push(new r.Y(i,s,o,a))}return e}serialize(){let t=10+c._writeSelectionsSize(this.beforeCursorState)+c._writeSelectionsSize(this.afterCursorState)+4;for(const e of this.changes)t+=e.writeSize();const e=new Uint8Array(t);let n=0;h.T4(e,this.beforeVersionId,n),n+=4,h.T4(e,this.afterVersionId,n),n+=4,h.Cg(e,this.beforeEOL,n),n+=1,h.Cg(e,this.afterEOL,n),n+=1,n=c._writeSelections(e,this.beforeCursorState,n),n=c._writeSelections(e,this.afterCursorState,n),h.T4(e,this.changes.length,n),n+=4;for(const t of this.changes)n=t.write(e,n);return e.buffer}static deserialize(t){const e=new Uint8Array(t);let n=0;const i=h.Ag(e,n);n+=4;const s=h.Ag(e,n);n+=4;const r=h.Q$(e,n);n+=1;const o=h.Q$(e,n);n+=1;const l=[];n=c._readSelections(e,n,l);const u=[];n=c._readSelections(e,n,u);const d=h.Ag(e,n);n+=4;const g=[];for(let t=0;t<d;t++)n=a.q.read(e,n,g);return new c(i,s,r,o,l,u,g)}}class d{get type(){return 0}get resource(){return o.o.isUri(this.model)?this.model:this.model.uri}constructor(t,e,n,i){this.label=t,this.code=e,this.model=n,this._data=c.create(n,i)}toString(){return(this._data instanceof c?this._data:c.deserialize(this._data)).changes.map((t=>t.toString())).join(", ")}matchesResource(t){return(o.o.isUri(this.model)?this.model:this.model.uri).toString()===t.toString()}setModel(t){this.model=t}canAppend(t){return this.model===t&&this._data instanceof c}append(t,e,n,i,s){this._data instanceof c&&this._data.append(t,e,n,i,s)}close(){this._data instanceof c&&(this._data=this._data.serialize())}open(){this._data instanceof c||(this._data=c.deserialize(this._data))}undo(){if(o.o.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof c&&(this._data=this._data.serialize());const t=c.deserialize(this._data);this.model._applyUndo(t.changes,t.beforeEOL,t.beforeVersionId,t.beforeCursorState)}redo(){if(o.o.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof c&&(this._data=this._data.serialize());const t=c.deserialize(this._data);this.model._applyRedo(t.changes,t.afterEOL,t.afterVersionId,t.afterCursorState)}heapSize(){return this._data instanceof c&&(this._data=this._data.serialize()),this._data.byteLength+168}}class g{get resources(){return this._editStackElementsArr.map((t=>t.resource))}constructor(t,e,n){this.label=t,this.code=e,this.type=1,this._isOpen=!0,this._editStackElementsArr=n.slice(0),this._editStackElementsMap=new Map;for(const t of this._editStackElementsArr){const e=u(t.resource);this._editStackElementsMap.set(e,t)}this._delegate=null}prepareUndoRedo(){if(this._delegate)return this._delegate.prepareUndoRedo(this)}matchesResource(t){const e=u(t);return this._editStackElementsMap.has(e)}setModel(t){const e=u(o.o.isUri(t)?t:t.uri);this._editStackElementsMap.has(e)&&this._editStackElementsMap.get(e).setModel(t)}canAppend(t){if(!this._isOpen)return!1;const e=u(t.uri);if(this._editStackElementsMap.has(e)){return this._editStackElementsMap.get(e).canAppend(t)}return!1}append(t,e,n,i,s){const r=u(t.uri);this._editStackElementsMap.get(r).append(t,e,n,i,s)}close(){this._isOpen=!1}open(){}undo(){this._isOpen=!1;for(const t of this._editStackElementsArr)t.undo()}redo(){for(const t of this._editStackElementsArr)t.redo()}heapSize(t){const e=u(t);if(this._editStackElementsMap.has(e)){return this._editStackElementsMap.get(e).heapSize()}return 0}split(){return this._editStackElementsArr}toString(){const t=[];for(const e of this._editStackElementsArr)t.push(`${(0,l.EZ)(e.resource)}: ${e}`);return`{${t.join(", ")}}`}}function f(t){return"\n"===t.getEOL()?0:1}function k(t){return!!t&&(t instanceof d||t instanceof g)}class m{constructor(t,e){this._model=t,this._undoRedoService=e}pushStackElement(){const t=this._undoRedoService.getLastElement(this._model.uri);k(t)&&t.close()}popStackElement(){const t=this._undoRedoService.getLastElement(this._model.uri);k(t)&&t.open()}clear(){this._undoRedoService.removeElements(this._model.uri)}_getOrCreateEditStackElement(t,e){const n=this._undoRedoService.getLastElement(this._model.uri);if(k(n)&&n.canAppend(this._model))return n;const s=new d(i.NC("edit","Typing"),"undoredo.textBufferEdit",this._model,t);return this._undoRedoService.pushElement(s,e),s}pushEOL(t){const e=this._getOrCreateEditStackElement(null,void 0);this._model.setEOL(t),e.append(this._model,[],f(this._model),this._model.getAlternativeVersionId(),null)}pushEditOperation(t,e,n,i){const s=this._getOrCreateEditStackElement(t,i),r=this._model.applyEdits(e,!0),o=m._computeCursorState(n,r),a=r.map(((t,e)=>({index:e,textChange:t.textChange})));return a.sort(((t,e)=>t.textChange.oldPosition===e.textChange.oldPosition?t.index-e.index:t.textChange.oldPosition-e.textChange.oldPosition)),s.append(this._model,a.map((t=>t.textChange)),f(this._model),this._model.getAlternativeVersionId(),o),o}static _computeCursorState(t,e){try{return t?t(e):null}catch(t){return(0,s.dL)(t),null}}}}}]);