"use strict";(self.webpackChunkui_react=self.webpackChunkui_react||[]).push([[920],{91385:(e,t,i)=>{var n=i(85152),s=i(15393),o=i(71050),a=i(17301),r=i(59365),d=i(5976),l=i(98401),h=i(70666),u=i(16830),c=i(66007),p=i(11640),m=i(50187),_=i(24314),g=i(29102),v=i(71204),b=i(71922),f=i(71765),C=i(16467),y=i(27753),w=i(63580),S=i(84144),N=i(23193),R=i(93983),I=i(72065),W=i(43557),x=i(59422),P=i(90535),k=i(89872),F=i(10829),E=i(65321),A=i(36513),L=i(21661),B=i(97759),D=i(56811),H=i(43799),O=i(9488),T=i(32429),j=i(4669),V=i(84013),M=i(52136),$=i(91847),q=i(86253),K=i(82992),G=i(97781),U=function(e,t,i,n){var s,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(a=(o<3?s(a):o>3?s(t,i,a):s(t,i))||a);return o>3&&a&&Object.defineProperty(t,i,a),a},z=function(e,t){return function(i,n){t(i,n,e)}};const J=new R.uy("renameInputVisible",!1,(0,w.NC)("renameInputVisible","Whether the rename input widget is visible"));new R.uy("renameInputFocused",!1,(0,w.NC)("renameInputFocused","Whether the rename input widget is focused"));let Z=class{constructor(e,t,i,n,s,o){this._editor=e,this._acceptKeybindings=t,this._themeService=i,this._keybindingService=n,this._logService=o,this.allowEditorOverflow=!0,this._disposables=new d.SL,this._visibleContextKey=J.bindTo(s),this._isEditingRenameCandidate=!1,this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,this._candidates=new Set,this._beforeFirstInputFieldEditSW=new V.G,this._inputWithButton=new Y,this._disposables.add(this._inputWithButton),this._editor.addContentWidget(this),this._disposables.add(this._editor.onDidChangeConfiguration((e=>{e.hasChanged(50)&&this._updateFont()}))),this._disposables.add(i.onDidColorThemeChange(this._updateStyles,this))}dispose(){this._disposables.dispose(),this._editor.removeContentWidget(this)}getId(){return"__renameInputWidget"}getDomNode(){return this._domNode||(this._domNode=document.createElement("div"),this._domNode.className="monaco-editor rename-box",this._domNode.appendChild(this._inputWithButton.domNode),this._renameCandidateListView=this._disposables.add(new Q(this._domNode,{fontInfo:this._editor.getOption(50),onFocusChange:e=>{this._inputWithButton.input.value=e,this._isEditingRenameCandidate=!1},onSelectionChange:()=>{this._isEditingRenameCandidate=!1,this.acceptInput(!1)}})),this._disposables.add(this._inputWithButton.onDidInputChange((()=>{var e,t,i,n;void 0!==(null===(e=this._renameCandidateListView)||void 0===e?void 0:e.focusedCandidate)&&(this._isEditingRenameCandidate=!0),null!==(t=this._timeBeforeFirstInputFieldEdit)&&void 0!==t||(this._timeBeforeFirstInputFieldEdit=this._beforeFirstInputFieldEditSW.elapsed()),!1===(null===(i=this._renameCandidateProvidersCts)||void 0===i?void 0:i.token.isCancellationRequested)&&this._renameCandidateProvidersCts.cancel(),null===(n=this._renameCandidateListView)||void 0===n||n.clearFocus()}))),this._label=document.createElement("div"),this._label.className="rename-label",this._domNode.appendChild(this._label),this._updateFont(),this._updateStyles(this._themeService.getColorTheme())),this._domNode}_updateStyles(e){var t,i,n,s,o;if(!this._domNode)return;const a=e.getColor(K.rh),r=e.getColor(K.A42);this._domNode.style.backgroundColor=String(null!==(t=e.getColor(K.D0T))&&void 0!==t?t:""),this._domNode.style.boxShadow=a?` 0 0 8px 2px ${a}`:"",this._domNode.style.border=r?`1px solid ${r}`:"",this._domNode.style.color=String(null!==(i=e.getColor(K.zJb))&&void 0!==i?i:"");const d=e.getColor(K.dt_);this._inputWithButton.domNode.style.backgroundColor=String(null!==(n=e.getColor(K.sEe))&&void 0!==n?n:""),this._inputWithButton.input.style.backgroundColor=String(null!==(s=e.getColor(K.sEe))&&void 0!==s?s:""),this._inputWithButton.domNode.style.borderWidth=d?"1px":"0px",this._inputWithButton.domNode.style.borderStyle=d?"solid":"none",this._inputWithButton.domNode.style.borderColor=null!==(o=null==d?void 0:d.toString())&&void 0!==o?o:"none"}_updateFont(){if(void 0===this._domNode)return;(0,l.p_)(void 0!==this._label,"RenameWidget#_updateFont: _label must not be undefined given _domNode is defined"),this._editor.applyFontInfo(this._inputWithButton.input);const e=this._editor.getOption(50);this._label.style.fontSize=`${this._computeLabelFontSize(e.fontSize)}px`}_computeLabelFontSize(e){return.8*e}getPosition(){if(!this._visible)return null;if(!this._editor.hasModel()||!this._editor.getDomNode())return null;const e=E.D6(this.getDomNode().ownerDocument.body),t=E.i(this._editor.getDomNode()),i=this._getTopForPosition();this._nPxAvailableAbove=i+t.top,this._nPxAvailableBelow=e.height-this._nPxAvailableAbove;const n=this._editor.getOption(67),{totalHeight:s}=X.getLayoutInfo({lineHeight:n}),o=this._nPxAvailableBelow>6*s?[2,1]:[1,2];return{position:this._position,preference:o}}beforeRender(){var e,t;const[i,n]=this._acceptKeybindings;return this._label.innerText=(0,w.NC)({key:"label",comment:['placeholders are keybindings, e.g "F2 to Rename, Shift+F2 to Preview"']},"{0} to Rename, {1} to Preview",null===(e=this._keybindingService.lookupKeybinding(i))||void 0===e?void 0:e.getLabel(),null===(t=this._keybindingService.lookupKeybinding(n))||void 0===t?void 0:t.getLabel()),this._domNode.style.minWidth="200px",null}afterRender(e){if(this._trace("invoking afterRender, position: ",e?"not null":"null"),null===e)return void this.cancelInput(!0,"afterRender (because position is null)");if(!this._editor.hasModel()||!this._editor.getDomNode())return;(0,l.p_)(this._renameCandidateListView),(0,l.p_)(void 0!==this._nPxAvailableAbove),(0,l.p_)(void 0!==this._nPxAvailableBelow);const t=E.wn(this._inputWithButton.domNode),i=E.wn(this._label);let n;n=2===e?this._nPxAvailableBelow:this._nPxAvailableAbove,this._renameCandidateListView.layout({height:n-i-t,width:E.w(this._inputWithButton.domNode)})}acceptInput(e){var t;this._trace("invoking acceptInput"),null===(t=this._currentAcceptInput)||void 0===t||t.call(this,e)}cancelInput(e,t){var i;this._trace(`invoking cancelInput, caller: ${t}, _currentCancelInput: ${this._currentAcceptInput?"not undefined":"undefined"}`),null===(i=this._currentCancelInput)||void 0===i||i.call(this,e)}focusNextRenameSuggestion(){var e;(null===(e=this._renameCandidateListView)||void 0===e?void 0:e.focusNext())||(this._inputWithButton.input.value=this._currentName)}focusPreviousRenameSuggestion(){var e;(null===(e=this._renameCandidateListView)||void 0===e?void 0:e.focusPrevious())||(this._inputWithButton.input.value=this._currentName)}getInput(e,t,i,n,o){const{start:a,end:r}=this._getSelection(e,t);this._renameCts=o;const h=new d.SL;this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,void 0===n?this._inputWithButton.button.style.display="none":(this._inputWithButton.button.style.display="flex",this._requestRenameCandidatesOnce=n,this._requestRenameCandidates(t,!1),h.add(E.nm(this._inputWithButton.button,"click",(()=>this._requestRenameCandidates(t,!0)))),h.add(E.nm(this._inputWithButton.button,E.tw.KEY_DOWN,(e=>{const i=new A.y(e);(i.equals(3)||i.equals(10))&&(i.stopPropagation(),i.preventDefault(),this._requestRenameCandidates(t,!0))})))),this._isEditingRenameCandidate=!1,this._domNode.classList.toggle("preview",i),this._position=new m.L(e.startLineNumber,e.startColumn),this._currentName=t,this._inputWithButton.input.value=t,this._inputWithButton.input.setAttribute("selectionStart",a.toString()),this._inputWithButton.input.setAttribute("selectionEnd",r.toString()),this._inputWithButton.input.size=Math.max(1.1*(e.endColumn-e.startColumn),20),this._beforeFirstInputFieldEditSW.reset(),h.add((0,d.OF)((()=>{this._renameCts=void 0,o.dispose(!0)}))),h.add((0,d.OF)((()=>{void 0!==this._renameCandidateProvidersCts&&(this._renameCandidateProvidersCts.dispose(!0),this._renameCandidateProvidersCts=void 0)}))),h.add((0,d.OF)((()=>this._candidates.clear())));const u=new s.CR;return u.p.finally((()=>{h.dispose(),this._hide()})),this._currentCancelInput=e=>{var t;return this._trace("invoking _currentCancelInput"),this._currentAcceptInput=void 0,this._currentCancelInput=void 0,null===(t=this._renameCandidateListView)||void 0===t||t.clearCandidates(),u.complete(e),!0},this._currentAcceptInput=e=>{this._trace("invoking _currentAcceptInput"),(0,l.p_)(void 0!==this._renameCandidateListView);const n=this._renameCandidateListView.nCandidates;let s,o;const a=this._renameCandidateListView.focusedCandidate;void 0!==a?(this._trace("using new name from renameSuggestion"),s=a,o={k:"renameSuggestion"}):(this._trace("using new name from inputField"),s=this._inputWithButton.input.value,o=this._isEditingRenameCandidate?{k:"userEditedRenameSuggestion"}:{k:"inputField"}),s!==t&&0!==s.trim().length?(this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView.clearCandidates(),u.complete({newName:s,wantsPreview:i&&e,stats:{source:o,nRenameSuggestions:n,timeBeforeFirstInputFieldEdit:this._timeBeforeFirstInputFieldEdit,nRenameSuggestionsInvocations:this._nRenameSuggestionsInvocations,hadAutomaticRenameSuggestionsInvocation:this._hadAutomaticRenameSuggestionsInvocation}})):this.cancelInput(!0,"_currentAcceptInput (because newName === value || newName.trim().length === 0)")},h.add(o.token.onCancellationRequested((()=>this.cancelInput(!0,"cts.token.onCancellationRequested")))),h.add(this._editor.onDidBlurEditorWidget((()=>{var e;return this.cancelInput(!(null===(e=this._domNode)||void 0===e?void 0:e.ownerDocument.hasFocus()),"editor.onDidBlurEditorWidget")}))),this._show(),u.p}_requestRenameCandidates(e,t){if(void 0!==this._requestRenameCandidatesOnce&&(void 0!==this._renameCandidateProvidersCts&&this._renameCandidateProvidersCts.dispose(!0),(0,l.p_)(this._renameCts),"stop"!==this._inputWithButton.buttonState)){this._renameCandidateProvidersCts=new o.AU;const i=t?v.Ll.Invoke:v.Ll.Automatic,n=this._requestRenameCandidatesOnce(i,this._renameCandidateProvidersCts.token);if(0===n.length)return void this._inputWithButton.setSparkleButton();t||(this._hadAutomaticRenameSuggestionsInvocation=!0),this._nRenameSuggestionsInvocations+=1,this._inputWithButton.setStopButton(),this._updateRenameCandidates(n,e,this._renameCts.token)}}_getSelection(e,t){(0,l.p_)(this._editor.hasModel());const i=this._editor.getSelection();let n=0,s=t.length;return _.e.isEmpty(i)||_.e.spansMultipleLines(i)||!_.e.containsRange(e,i)||(n=Math.max(0,i.startColumn-e.startColumn),s=Math.min(e.endColumn,i.endColumn)-e.startColumn),{start:n,end:s}}_show(){this._trace("invoking _show"),this._editor.revealLineInCenterIfOutsideViewport(this._position.lineNumber,0),this._visible=!0,this._visibleContextKey.set(!0),this._editor.layoutContentWidget(this),setTimeout((()=>{this._inputWithButton.input.focus(),this._inputWithButton.input.setSelectionRange(parseInt(this._inputWithButton.input.getAttribute("selectionStart")),parseInt(this._inputWithButton.input.getAttribute("selectionEnd")))}),100)}async _updateRenameCandidates(e,t,i){const n=(...e)=>this._trace("_updateRenameCandidates",...e);n("start");const o=await(0,s.eP)(Promise.allSettled(e),i);if(this._inputWithButton.setSparkleButton(),void 0===o)return void n("returning early - received updateRenameCandidates results - undefined");const a=o.flatMap((e=>"fulfilled"===e.status&&(0,l.$K)(e.value)?e.value:[]));n(`received updateRenameCandidates results - total (unfiltered) ${a.length} candidates.`);const r=O.EB(a,(e=>e.newSymbolName));n(`distinct candidates - ${r.length} candidates.`);const d=r.filter((({newSymbolName:e})=>e.trim().length>0&&e!==this._inputWithButton.input.value&&e!==t&&!this._candidates.has(e)));n(`valid distinct candidates - ${a.length} candidates.`),d.forEach((e=>this._candidates.add(e.newSymbolName))),d.length<1?n("returning early - no valid distinct candidates"):(n("setting candidates"),this._renameCandidateListView.setCandidates(d),n("asking editor to re-layout"),this._editor.layoutContentWidget(this))}_hide(){this._trace("invoked _hide"),this._visible=!1,this._visibleContextKey.reset(),this._editor.layoutContentWidget(this)}_getTopForPosition(){const e=this._editor.getVisibleRanges();let t;return e.length>0?t=e[0].startLineNumber:(this._logService.warn("RenameWidget#_getTopForPosition: this should not happen - visibleRanges is empty"),t=Math.max(1,this._position.lineNumber-5)),this._editor.getTopForLineNumber(this._position.lineNumber)-this._editor.getTopForLineNumber(t)}_trace(...e){this._logService.trace("RenameWidget",...e)}};Z=U([z(2,G.XE),z(3,$.d),z(4,R.i6),z(5,W.VZ)],Z);class Q{constructor(e,t){this._disposables=new d.SL,this._availableHeight=0,this._minimumWidth=0,this._lineHeight=t.fontInfo.lineHeight,this._typicalHalfwidthCharacterWidth=t.fontInfo.typicalHalfwidthCharacterWidth,this._listContainer=document.createElement("div"),this._listContainer.className="rename-box rename-candidate-list-container",e.appendChild(this._listContainer),this._listWidget=Q._createListWidget(this._listContainer,this._candidateViewHeight,t.fontInfo),this._listWidget.onDidChangeFocus((e=>{1===e.elements.length&&t.onFocusChange(e.elements[0].newSymbolName)}),this._disposables),this._listWidget.onDidChangeSelection((e=>{1===e.elements.length&&t.onSelectionChange()}),this._disposables),this._disposables.add(this._listWidget.onDidBlur((e=>{this._listWidget.setFocus([])}))),this._listWidget.style((0,q.TU)({listInactiveFocusForeground:K.NPS,listInactiveFocusBackground:K.Vqd}))}dispose(){this._listWidget.dispose(),this._disposables.dispose()}layout({height:e,width:t}){this._availableHeight=e,this._minimumWidth=t}setCandidates(e){this._listWidget.splice(0,0,e);const t=this._pickListHeight(this._listWidget.length),i=this._pickListWidth(e);this._listWidget.layout(t,i),this._listContainer.style.height=`${t}px`,this._listContainer.style.width=`${i}px`,n.i7((0,w.NC)("renameSuggestionsReceivedAria","Received {0} rename suggestions",e.length))}clearCandidates(){this._listContainer.style.height="0px",this._listContainer.style.width="0px",this._listWidget.splice(0,this._listWidget.length,[])}get nCandidates(){return this._listWidget.length}get focusedCandidate(){if(0===this._listWidget.length)return;const e=this._listWidget.getSelectedElements()[0];if(void 0!==e)return e.newSymbolName;const t=this._listWidget.getFocusedElements()[0];return void 0!==t?t.newSymbolName:void 0}focusNext(){if(0===this._listWidget.length)return!1;const e=this._listWidget.getFocus();if(0===e.length)return this._listWidget.focusFirst(),this._listWidget.reveal(0),!0;if(e[0]===this._listWidget.length-1)return this._listWidget.setFocus([]),this._listWidget.reveal(0),!1;{this._listWidget.focusNext();const e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}}focusPrevious(){if(0===this._listWidget.length)return!1;const e=this._listWidget.getFocus();if(0===e.length){this._listWidget.focusLast();const e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}if(0===e[0])return this._listWidget.setFocus([]),!1;{this._listWidget.focusPrevious();const e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}}clearFocus(){this._listWidget.setFocus([])}get _candidateViewHeight(){const{totalHeight:e}=X.getLayoutInfo({lineHeight:this._lineHeight});return e}_pickListHeight(e){const t=this._candidateViewHeight*e;return Math.min(t,this._availableHeight,7*this._candidateViewHeight)}_pickListWidth(e){const t=Math.ceil(Math.max(...e.map((e=>e.newSymbolName.length)))*this._typicalHalfwidthCharacterWidth);return Math.max(this._minimumWidth,25+t+10)}static _createListWidget(e,t,i){const n=new class{getTemplateId(e){return"candidate"}getHeight(e){return t}},s=new class{constructor(){this.templateId="candidate"}renderTemplate(e){return new X(e,i)}renderElement(e,t,i){i.populate(e)}disposeTemplate(e){e.dispose()}};return new H.aV("NewSymbolNameCandidates",e,n,[s],{keyboardSupport:!1,mouseSupport:!0,multipleSelectionSupport:!1})}}class Y{constructor(){this._onDidInputChange=new j.Q5,this.onDidInputChange=this._onDidInputChange.event,this._disposables=new d.SL}get domNode(){return this._domNode||(this._domNode=document.createElement("div"),this._domNode.className="rename-input-with-button",this._domNode.style.display="flex",this._domNode.style.flexDirection="row",this._domNode.style.alignItems="center",this._inputNode=document.createElement("input"),this._inputNode.className="rename-input",this._inputNode.type="text",this._inputNode.style.border="none",this._inputNode.setAttribute("aria-label",(0,w.NC)("renameAriaLabel","Rename input. Type new name and press Enter to commit.")),this._domNode.appendChild(this._inputNode),this._buttonNode=document.createElement("div"),this._buttonNode.className="rename-suggestions-button",this._buttonNode.setAttribute("tabindex","0"),this._buttonGenHoverText=w.NC("generateRenameSuggestionsButton","Generate new name suggestions"),this._buttonCancelHoverText=w.NC("cancelRenameSuggestionsButton","Cancel"),this._buttonHover=(0,L.B)().setupUpdatableHover((0,B.tM)("element"),this._buttonNode,this._buttonGenHoverText),this._disposables.add(this._buttonHover),this._domNode.appendChild(this._buttonNode),this._disposables.add(E.nm(this.input,E.tw.INPUT,(()=>this._onDidInputChange.fire()))),this._disposables.add(E.nm(this.input,E.tw.KEY_DOWN,(e=>{const t=new A.y(e);15!==t.keyCode&&17!==t.keyCode||this._onDidInputChange.fire()}))),this._disposables.add(E.nm(this.input,E.tw.CLICK,(()=>this._onDidInputChange.fire()))),this._disposables.add(E.nm(this.input,E.tw.FOCUS,(()=>{this.domNode.style.outlineWidth="1px",this.domNode.style.outlineStyle="solid",this.domNode.style.outlineOffset="-1px",this.domNode.style.outlineColor="var(--vscode-focusBorder)"}))),this._disposables.add(E.nm(this.input,E.tw.BLUR,(()=>{this.domNode.style.outline="none"})))),this._domNode}get input(){return(0,l.p_)(this._inputNode),this._inputNode}get button(){return(0,l.p_)(this._buttonNode),this._buttonNode}get buttonState(){return this._buttonState}setSparkleButton(){var e,t;this._buttonState="sparkle",null!==(e=this._sparkleIcon)&&void 0!==e||(this._sparkleIcon=(0,D.h)(T.l.sparkle)),E.PO(this.button),this.button.appendChild(this._sparkleIcon),this.button.setAttribute("aria-label","Generating new name suggestions"),null===(t=this._buttonHover)||void 0===t||t.update(this._buttonGenHoverText),this.input.focus()}setStopButton(){var e,t;this._buttonState="stop",null!==(e=this._stopIcon)&&void 0!==e||(this._stopIcon=(0,D.h)(T.l.primitiveSquare)),E.PO(this.button),this.button.appendChild(this._stopIcon),this.button.setAttribute("aria-label","Cancel generating new name suggestions"),null===(t=this._buttonHover)||void 0===t||t.update(this._buttonCancelHoverText),this.input.focus()}dispose(){this._disposables.dispose()}}class X{constructor(e,t){this._domNode=document.createElement("div"),this._domNode.className="rename-box rename-candidate",this._domNode.style.display="flex",this._domNode.style.columnGap="5px",this._domNode.style.alignItems="center",this._domNode.style.height=`${t.lineHeight}px`,this._domNode.style.padding=`${X._PADDING}px`;const i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.width=i.style.height=.8*t.lineHeight+"px",this._domNode.appendChild(i),this._icon=(0,D.h)(T.l.sparkle),this._icon.style.display="none",i.appendChild(this._icon),this._label=document.createElement("div"),M.N(this._label,t),this._domNode.appendChild(this._label),e.appendChild(this._domNode)}populate(e){this._updateIcon(e),this._updateLabel(e)}_updateIcon(e){var t;const i=!!(null===(t=e.tags)||void 0===t?void 0:t.includes(v.w.AIGenerated));this._icon.style.display=i?"inherit":"none"}_updateLabel(e){this._label.innerText=e.newSymbolName}static getLayoutInfo({lineHeight:e}){return{totalHeight:e+2*X._PADDING}}dispose(){}}X._PADDING=2;var ee,te=function(e,t,i,n){var s,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(a=(o<3?s(a):o>3?s(t,i,a):s(t,i))||a);return o>3&&a&&Object.defineProperty(t,i,a),a},ie=function(e,t){return function(i,n){t(i,n,e)}};class ne{constructor(e,t,i){this.model=e,this.position=t,this._providerRenameIdx=0,this._providers=i.ordered(e)}hasProvider(){return this._providers.length>0}async resolveRenameLocation(e){const t=[];for(this._providerRenameIdx=0;this._providerRenameIdx<this._providers.length;this._providerRenameIdx++){const i=this._providers[this._providerRenameIdx];if(!i.resolveRenameLocation)break;const n=await i.resolveRenameLocation(this.model,this.position,e);if(n){if(!n.rejectReason)return n;t.push(n.rejectReason)}}this._providerRenameIdx=0;const i=this.model.getWordAtPosition(this.position);return i?{range:new _.e(this.position.lineNumber,i.startColumn,this.position.lineNumber,i.endColumn),text:i.word,rejectReason:t.length>0?t.join("\n"):void 0}:{range:_.e.fromPositions(this.position),text:"",rejectReason:t.length>0?t.join("\n"):void 0}}async provideRenameEdits(e,t){return this._provideRenameEdits(e,this._providerRenameIdx,[],t)}async _provideRenameEdits(e,t,i,n){const s=this._providers[t];if(!s)return{edits:[],rejectReason:i.join("\n")};const o=await s.provideRenameEdits(this.model,this.position,e,n);return o?o.rejectReason?this._provideRenameEdits(e,t+1,i.concat(o.rejectReason),n):o:this._provideRenameEdits(e,t+1,i.concat(w.NC("no result","No result.")),n)}}let se=ee=class{static get(e){return e.getContribution(ee.ID)}constructor(e,t,i,n,s,a,r,l,h){this.editor=e,this._instaService=t,this._notificationService=i,this._bulkEditService=n,this._progressService=s,this._logService=a,this._configService=r,this._languageFeaturesService=l,this._telemetryService=h,this._disposableStore=new d.SL,this._cts=new o.AU,this._renameWidget=this._disposableStore.add(this._instaService.createInstance(Z,this.editor,["acceptRenameInput","acceptRenameInputWithPreview"]))}dispose(){this._disposableStore.dispose(),this._cts.dispose(!0)}async run(){var e,t;const i=this._logService.trace.bind(this._logService,"[rename]");if(this._cts.dispose(!0),this._cts=new o.AU,!this.editor.hasModel())return void i("editor has no model");const d=this.editor.getPosition(),l=new ne(this.editor.getModel(),d,this._languageFeaturesService.renameProvider);if(!l.hasProvider())return void i("skeleton has no provider");const h=new C.Dl(this.editor,5,void 0,this._cts.token);let u;try{i("resolving rename location");const e=l.resolveRenameLocation(h.token);this._progressService.showWhile(e,250),u=await e,i("resolved rename location")}catch(t){return void(t instanceof a.FU?i("resolve rename location cancelled",JSON.stringify(t,null,"\t")):(i("resolve rename location failed",t instanceof Error?t:JSON.stringify(t,null,"\t")),("string"==typeof t||(0,r.Fr)(t))&&(null===(e=y.O.get(this.editor))||void 0===e||e.showMessage(t||w.NC("resolveRenameLocationFailed","An unknown error occurred while resolving rename location"),d))))}finally{h.dispose()}if(!u)return void i("returning early - no loc");if(u.rejectReason)return i(`returning early - rejected with reason: ${u.rejectReason}`,u.rejectReason),void(null===(t=y.O.get(this.editor))||void 0===t||t.showMessage(u.rejectReason,d));if(h.token.isCancellationRequested)return void i("returning early - cts1 cancelled");const c=new C.Dl(this.editor,5,u.range,this._cts.token),p=this.editor.getModel(),m=this._languageFeaturesService.newSymbolNamesProvider.all(p),g=await Promise.all(m.map((async e=>{var t;return[e,null!==(t=await e.supportsAutomaticNewSymbolNamesTriggerKind)&&void 0!==t&&t]})));i("creating rename input field and awaiting its result");const b=this._bulkEditService.hasPreviewHandler()&&this._configService.getValue(this.editor.getModel().uri,"editor.rename.enablePreview"),f=await this._renameWidget.getInput(u.range,u.text,b,m.length>0?(e,t)=>{let i=g.slice();return e===v.Ll.Automatic&&(i=i.filter((([e,t])=>t))),i.map((([i])=>i.provideNewSymbolNames(p,u.range,e,t)))}:void 0,c);if(i("received response from rename input field"),m.length>0&&this._reportTelemetry(m.length,p.getLanguageId(),f),"boolean"==typeof f)return i(`returning early - rename input field response - ${f}`),f&&this.editor.focus(),void c.dispose();this.editor.focus(),i("requesting rename edits");const S=(0,s.eP)(l.provideRenameEdits(f.newName,c.token),c.token).then((async e=>{if(e)if(this.editor.hasModel()){if(e.rejectReason)return i(`returning early - rejected with reason: ${e.rejectReason}`),void this._notificationService.info(e.rejectReason);this.editor.setSelection(_.e.fromPositions(this.editor.getSelection().getPosition())),i("applying edits"),this._bulkEditService.apply(e,{editor:this.editor,showPreview:f.wantsPreview,label:w.NC("label","Renaming '{0}' to '{1}'",null==u?void 0:u.text,f.newName),code:"undoredo.rename",quotableLabel:w.NC("quotableLabel","Renaming {0} to {1}",null==u?void 0:u.text,f.newName),respectAutoSaveConfig:!0}).then((e=>{i("edits applied"),e.ariaSummary&&(0,n.Z9)(w.NC("aria","Successfully renamed '{0}' to '{1}'. Summary: {2}",u.text,f.newName,e.ariaSummary))})).catch((e=>{i(`error when applying edits ${JSON.stringify(e,null,"\t")}`),this._notificationService.error(w.NC("rename.failedApply","Rename failed to apply edits")),this._logService.error(e)}))}else i("returning early - no model after rename edits are provided");else i("returning early - no rename edits result")}),(e=>{i("error when providing rename edits",JSON.stringify(e,null,"\t")),this._notificationService.error(w.NC("rename.failed","Rename failed to compute edits")),this._logService.error(e)})).finally((()=>{c.dispose()}));return i("returning rename operation"),this._progressService.showWhile(S,250),S}acceptRenameInput(e){this._renameWidget.acceptInput(e)}cancelRenameInput(){this._renameWidget.cancelInput(!0,"cancelRenameInput command")}focusNextRenameSuggestion(){this._renameWidget.focusNextRenameSuggestion()}focusPreviousRenameSuggestion(){this._renameWidget.focusPreviousRenameSuggestion()}_reportTelemetry(e,t,i){const n="boolean"==typeof i?{kind:"cancelled",languageId:t,nRenameSuggestionProviders:e}:{kind:"accepted",languageId:t,nRenameSuggestionProviders:e,source:i.stats.source.k,nRenameSuggestions:i.stats.nRenameSuggestions,timeBeforeFirstInputFieldEdit:i.stats.timeBeforeFirstInputFieldEdit,wantsPreview:i.wantsPreview,nRenameSuggestionsInvocations:i.stats.nRenameSuggestionsInvocations,hadAutomaticRenameSuggestionsInvocation:i.stats.hadAutomaticRenameSuggestionsInvocation};this._telemetryService.publicLog2("renameInvokedEvent",n)}};se.ID="editor.contrib.renameController",se=ee=te([ie(1,I.TG),ie(2,x.lT),ie(3,c.vu),ie(4,P.ek),ie(5,W.VZ),ie(6,f.V),ie(7,b.p),ie(8,F.b)],se);class oe extends u.R6{constructor(){super({id:"editor.action.rename",label:w.NC("rename.label","Rename Symbol"),alias:"Rename Symbol",precondition:R.Ao.and(g.u.writable,g.u.hasRenameProvider),kbOpts:{kbExpr:g.u.editorTextFocus,primary:60,weight:100},contextMenuOpts:{group:"1_modification",order:1.1}})}runCommand(e,t){const i=e.get(p.$),[n,s]=Array.isArray(t)&&t||[void 0,void 0];return h.o.isUri(n)&&m.L.isIPosition(s)?i.openCodeEditor({resource:n},i.getActiveCodeEditor()).then((e=>{e&&(e.setPosition(s),e.invokeWithinContext((t=>(this.reportTelemetry(t,e),this.run(t,e)))))}),a.dL):super.runCommand(e,t)}run(e,t){const i=e.get(W.VZ),n=se.get(t);return n?(i.trace("[RenameAction] got controller, running..."),n.run()):(i.trace("[RenameAction] returning early - controller missing"),Promise.resolve())}}(0,u._K)(se.ID,se,4),(0,u.Qr)(oe);const ae=u._l.bindToContribution(se.get);(0,u.fK)(new ae({id:"acceptRenameInput",precondition:J,handler:e=>e.acceptRenameInput(!1),kbOpts:{weight:199,kbExpr:R.Ao.and(g.u.focus,R.Ao.not("isComposing")),primary:3}})),(0,u.fK)(new ae({id:"acceptRenameInputWithPreview",precondition:R.Ao.and(J,R.Ao.has("config.editor.rename.enablePreview")),handler:e=>e.acceptRenameInput(!0),kbOpts:{weight:199,kbExpr:R.Ao.and(g.u.focus,R.Ao.not("isComposing")),primary:2051}})),(0,u.fK)(new ae({id:"cancelRenameInput",precondition:J,handler:e=>e.cancelRenameInput(),kbOpts:{weight:199,kbExpr:g.u.focus,primary:9,secondary:[1033]}})),(0,S.r1)(class extends S.Ke{constructor(){super({id:"focusNextRenameSuggestion",title:{...w.vv("focusNextRenameSuggestion","Focus Next Rename Suggestion")},precondition:J,keybinding:[{primary:18,weight:199}]})}run(e){const t=e.get(p.$).getFocusedCodeEditor();if(!t)return;const i=se.get(t);i&&i.focusNextRenameSuggestion()}}),(0,S.r1)(class extends S.Ke{constructor(){super({id:"focusPreviousRenameSuggestion",title:{...w.vv("focusPreviousRenameSuggestion","Focus Previous Rename Suggestion")},precondition:J,keybinding:[{primary:16,weight:199}]})}run(e){const t=e.get(p.$).getFocusedCodeEditor();if(!t)return;const i=se.get(t);i&&i.focusPreviousRenameSuggestion()}}),(0,u.sb)("_executeDocumentRenameProvider",(function(e,t,i,...n){const[s]=n;(0,l.p_)("string"==typeof s);const{renameProvider:a}=e.get(b.p);return async function(e,t,i,n){const s=new ne(t,i,e),a=await s.resolveRenameLocation(o.Ts.None);return(null==a?void 0:a.rejectReason)?{edits:[],rejectReason:a.rejectReason}:s.provideRenameEdits(n,o.Ts.None)}(a,t,i,s)})),(0,u.sb)("_executePrepareRename",(async function(e,t,i){const{renameProvider:n}=e.get(b.p),s=new ne(t,i,n),a=await s.resolveRenameLocation(o.Ts.None);if(null==a?void 0:a.rejectReason)throw new Error(a.rejectReason);return a})),k.B.as(N.IP.Configuration).registerConfiguration({id:"editor",properties:{"editor.rename.enablePreview":{scope:5,description:w.NC("enablePreview","Enable/disable the ability to preview changes before renaming"),default:!0,type:"boolean"}}})}}]);